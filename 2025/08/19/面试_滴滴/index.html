<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>面试_滴滴 | Joie's Blog</title><meta name="keywords" content="面试"><meta name="author" content="Joie"><meta name="copyright" content="Joie"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="面试_滴滴"><meta name="application-name" content="面试_滴滴"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="面试_滴滴"><meta property="og:url" content="http://example.com/2025/08/19/%E9%9D%A2%E8%AF%95_%E6%BB%B4%E6%BB%B4/index.html"><meta property="og:site_name" content="Joie's Blog"><meta property="og:description" content="面试问题与答案1. Java 优先队列的实现原理答案：Java的PriorityQueue基于堆（Heap）数据结构实现，默认是小顶堆。 核心原理：  使用数组存储完全二叉树 通过compareTo()或Comparator比较元素大小 插入时向上调整（上浮） 删除时向下调整（下沉）  关键方法："><meta property="og:locale" content="en"><meta property="og:image" content="https://origin.picgo.net/2025/08/07/202012111639381648986755c150cff23.png"><meta property="article:author" content="Joie"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://origin.picgo.net/2025/08/07/202012111639381648986755c150cff23.png"><meta name="description" content="面试问题与答案1. Java 优先队列的实现原理答案：Java的PriorityQueue基于堆（Heap）数据结构实现，默认是小顶堆。 核心原理：  使用数组存储完全二叉树 通过compareTo()或Comparator比较元素大小 插入时向上调整（上浮） 删除时向下调整（下沉）  关键方法："><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/08/19/%E9%9D%A2%E8%AF%95_%E6%BB%B4%E6%BB%B4/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"Here","backTitle":"Welcome"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":"api","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"Author: Joie","link":"Link: ","source":"Source: Joie's Blog","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.","copySuccess":"Copy success, copy and reprint please mark the address of this article"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Joie\'s Blog',
  title: '面试_滴滴',
  postAI: '',
  pageFillDescription: '面试问题与答案, 1. Java 优先队列的实现原理, 2. Redis分布式锁原理, 3. 如何用数据库实现一个分布式锁, 4. ThreadLocal 的数据结构原理？, 5. ThreadLocal 如何跨线程通信, 6. MQ 数据是怎么存储的？, 7. 消费者如何消费MQ 中的消息？, 8. 线程池参数详解, 9. 线程池队列什么时候往里加元素？, 10. Spring Boot 和 Spring Cloud 的区别？, 11. 类加载机制？, 12. JVM 垃圾回收机制？, 13. HashMap 原理, 14. ConcurrentHashMap 原理, 15. 详细讲一下大模型怎么用的？, 16. SQL 优化方式？越详细越好, 18. 活跃用户如何定义？, 19. 有没有关注缓存命中情况？, 20. Spring 单例管理怎么做的？, 21. Nacos 特性？, 22. 如何实现高性能的分布式配置中心？面试问题与答案优先队列的实现原理答案的基于堆数据结构实现默认是小顶堆核心原理使用数组存储完全二叉树通过或比较元素大小插入时向上调整上浮删除时向下调整下沉关键方法插入元素向上调整时间复杂度插入删除查找最小值分布式锁原理答案分布式锁通过命令的不存在才设置和过期时间参数实现核心实现关键特性原子性是原子操作过期时间防止死锁唯一性只有第一个客户端能获得锁完整实现示例注意事项必须设置过期时间防止死锁释放锁时要验证锁的持有者考虑锁的续期机制如何用数据库实现一个分布式锁答案可以通过数据库的唯一索引和事务特性实现分布式锁方案一基于唯一索引创建锁表获取锁方案二基于行锁使用执行业务逻辑优缺点优点实现简单利用数据库事务特性缺点性能较低不适合高并发场景的数据结构原理答案通过存储数据每个线程都有独立的实例核心结构的值用于在中定位获取当前线程的结构弱引用指向内存泄漏问题被弱引用可能被回收但的是强引用可能导致内存泄漏使用完后要调用方法如何跨线程通信答案本身无法跨线程通信但可以通过以下方式实现方案一在创建子线程时自动传递值使用示例子线程可以获取到父线程的值输出方案二手动传递在子线程中手动设置方案三使用子线程创建时会自动继承父线程的值数据是怎么存储的答案不同的存储机制不同以为例存储机制分区存储每个分为多个分段存储每个分为多个文件文件结构消息数据文件偏移量索引文件时间索引文件存储目录结构消息存储格式其他存储方式基于的数据库基于文件系统支持多种存储引擎分层存储热数据在内存冷数据在消费者如何消费中的消息答案消费者通过拉取或推送方式消费消息以为例拉取模式处理消息业务逻辑处理手动提交偏移量异常处理消费消息失败批量消费批量处理消费者配置消费策略顺序消费单分区单消费者并行消费多分区多消费者批量消费提高吞吐量异步消费非阻塞处理线程池参数详解答案线程池的核心参数包括核心参数核心线程数最大线程数线程空闲时间时间单位工作队列线程工厂拒绝策略参数详解核心线程数线程池中会维护的最小线程数即使这些线程空闲也不会被回收建议密集型任务核心数密集型任务核心数最大线程数线程池中允许的最大线程数当工作队列满了且当前线程数小于最大线程数时会创建新线程线程空闲时间当线程数大于核心线程数时多余线程的空闲时间超过这个时间多余线程会被回收工作队列存储等待执行的任务的阻塞队列当所有核心线程都在工作时新任务会放入队列线程池工作流程当前线程数创建新线程执行任务当前线程数任务放入队列队列满了且当前线程数创建新线程执行任务队列满了且当前线程数执行拒绝策略常用线程池固定大小线程池可缓存线程池单线程池定时任务线程池线程池队列什么时候往里加元素答案线程池队列在以下情况下会添加元素添加元素的时机当前线程数新任务会先尝试放入队列队列未满任务直接放入队列等待执行所有核心线程都在工作新任务必须排队队列类型及特点有界队列固定大小的数组队列特点有界适合内存敏感场景使用场景任务量可预测内存有限无界队列基于链表的无界队列特点无界内存占用较大使用场景任务量不可预测内存充足同步队列不存储元素的阻塞队列特点不存储元素每个插入操作必须等待另一个线程的移除操作使用场景要求任务立即执行不允许排队优先级队列基于优先级的无界阻塞队列特点基于优先级排序无界使用场景任务有优先级要求队列选择建议密集型避免过多线程切换密集型提高并发度实时性要求高任务立即执行任务有优先级和的区别答案和是两个不同层次的技术定位快速构建应用的脚手架功能自动配置内嵌服务器生产就绪特性范围单个应用服务定位分布式系统开发工具集功能服务发现配置管理熔断器网关等范围微服务架构详细对比特性定位应用开发框架微服务治理框架依赖配置服务注册无配置中心无负载均衡无熔断器无网关无使用场景应用应用服务发现服务调用关系基于构建提供基础能力提供分布式能力可以单独使用但不能单独使用类加载机制答案类加载机制包括加载验证准备解析初始化五个阶段类加载过程加载通过类名获取类的二进制数据将二进制数据转换为方法区内的运行时数据结构在内存中生成对象验证文件格式验证魔数版本号等元数据验证语义分析字节码验证程序逻辑验证符号引用验证符号引用转换为直接引用准备为类变量分配内存设置类变量的初始值零值解析将符号引用转换为直接引用符号引用以符号形式描述所引用的目标直接引用指向目标的指针相对偏移量等初始化执行类构造器方法为类变量赋初始值执行静态代码块类加载器层次启动类加载器扩展类加载器应用类加载器自定义类加载器双亲委派模型检查是否已经加载委派给父加载器父加载器无法加载自己尝试加载破坏双亲委派的情况机制如驱动加载热部署如自定义类加载器重写方法垃圾回收机制答案垃圾回收机制包括垃圾识别垃圾回收算法垃圾收集器等垃圾识别算法引用计数法每个对象维护一个引用计数器引用为时立即回收缺点无法解决循环引用问题可达性分析从开始标记所有可达对象未被标记的对象即为垃圾包括栈中局部变量静态变量常量本地方法栈等垃圾回收算法标记清除标记阶段标记所有可达对象清除阶段回收未标记对象复制将内存分为两块每次只使用一块垃圾回收时将存活对象复制到另一块优点效率高无碎片缺点内存利用率低标记整理标记阶段同标记清除整理阶段将存活对象向一端移动优点无碎片内存利用率高缺点效率较低分代收集新生代复制算法老年代标记整理或标记清除垃圾收集器收集器单线程收集器适合客户端应用收集器多线程收集器适合服务器应用收集器并发标记清除低停顿时间收集器区域化内存布局可预测的停顿时间收集器低延迟垃圾收集器停顿时间不超过调优参数堆内存大小新生代大小垃圾收集器选择日志原理答案基于数组链表红黑树的数据结构实现核心数据结构存储键值对的数组键值对数量扩容阈值负载因子链表节点工作原理计算值确定数组索引是数组长度插入元素数组为空初始化计算索引位置处理冲突链表插入扩容检查扩容机制阈值翻倍创建新数组重新重新分配元素链表重新分配红黑树转换当链表长度且数组长度时链表转换为红黑树当红黑树节点数时红黑树转换为链表性能特点平均时间复杂度最坏时间复杂度所有元素冲突空间复杂度原理答案是线程安全的基于实现核心数据结构存储键值对的数组扩容时的临时数组基础计数器扩容控制节点类型线程安全机制操作使用更新值使用更新其他线程正在初始化锁对数组元素加锁链表操作红黑树操作操作流程初始化计算索引位置插入新节点处理冲突链表操作红黑树操作更新计数扩容机制支持多线程并发扩容使用标记正在扩容的节点其他线程可以参与扩容过程性能特点读操作无锁性能高写操作使用分段锁减少锁竞争支持高并发读写详细讲一下大模型怎么用的答案大模型的应用方式多样主要包括以下几种直接调用使用本地部署模型使用加载模型生成文本你好请介绍一下自己微调训练使用进行微调配置应用训练参数训练实际应用场景代码生成请根据以下需求生成代码需求要求代码要规范有注释包含异常处理遵循设计模式请对以下代码进行代码审查请指出潜在的问题性能优化建议代码规范问题文档生成请为以下方法生成文档请包含方法说明参数说明返回值说明使用示例集成到开发流程代码提交后自动生成文档自动代码审查发送通知请为以下方法生成单元测试用例要求覆盖正常情况覆盖边界情况覆盖异常情况使用成本控制策略使用缓存减少重复调用批量处理减少调用次数本地模型减少费用智能路由选择最合适的模型优化方式越详细越好答案优化是一个系统工程需要从多个维度进行优化索引优化创建合适的索引单列索引复合索引注意列顺序覆盖索引部分索引函数索引索引设计原则最左前缀原则复合索引的列顺序很重要选择性原则选择区分度高的列建立索引覆盖索引尽量让查询只通过索引就能完成避免冗余索引删除不必要的索引查询语句优化避免不推荐推荐使用代替不推荐推荐避免隐式类型转换不推荐会导致索引失效推荐使用分页推荐使用游标分页避免分页大数据量时性能差表结构优化选择合适的数据类型不推荐推荐使用足够根据实际需求设置长度年龄用足够使用节省空间规范化设计避免过度规范化对于频繁查询的统计信息可以使用冗余字段冗余字段避免冗余字段避免分区表优化按时间分区按月分区查询执行计划优化分析执行计划使用分析查询使用获取详细执行信息连接查询优化优化顺序小表驱动大表使用强制顺序使用代替子查询不推荐推荐批量操作优化批量插入推荐批量插入使用批量更新使用批量更新缓存优化应用层缓存数据库查询缓存查询缓存已废弃建议使用应用层缓存或使用等外部缓存配置优化配置优化缓冲池大小建议为内存的日志文件大小连接数查询缓存已移除监控和分析慢查询日志开启慢查询日志阈值秒避免噪音查看配置分析慢日志使用归纳热点关注总耗时分位样本临时表文件排序关键监控指标分位延迟命中率脏页比例频率比临时表文件排序次数死锁数锁等待时间活跃连接数线程池使用率实战排查顺序先看系统瓶颈慢日志定位索引语句结构优化观察指标回归的查询原理答案通过将映射为由执行器驱动完成组装参数绑定与结果映射并内置一级二级缓存与插件拦截链核心组件与职责会话创建与管理一次增删改查的元数据参数返回类型缓存配置执行器负责缓存与查询更新预编译设置参数执行参数到的映射将结果集映射为对象类型转换插件拦截点执行流程解析与构建将每条解析为通过动态代理生成代理调用方法定位构建动态查一级缓存作用域为未命中则预编译绑定参数执行映射结果写入一级缓存若配置二级缓存且命中策略允许则参与二级缓存示例活跃用户如何定义答案依据业务定义活跃标准并落到可计算的事件集合上常见口径当日周月内有有效行为的去重用户数在基准日活跃且日后仍活跃的比例有效行为示例登录下单支付内容发布停留时长有效交互计算示例以登录下单支付等为有效事件日留存口径落地建议明确有效行为与去重维度设备账号统一时间边界本地时区自然日滚动用物化表定时任务沉淀供实时看板有没有关注缓存命中情况答案需要对本地缓存与分布式缓存分别监测常见指标命中率加载耗时淘汰过期数数内存用量本地缓存分布式缓存基础命中指标内存与淘汰监控建议应用侧暴露优化思路提升命中热点预热恰当避免随机可哈希归一化降低穿透布隆过滤器空值缓存限制击穿互斥锁请求合并异步刷新防雪崩过期时间加随机抖动限流与降级策略单例管理怎么做的答案默认作用域容器内单例核心由管理三级缓存解决循环依赖一级完全初始化的单例二级提前暴露的单例实例未增强三级用于创建早期引用代理生命周期简化实例化属性填充回调初始化放入一级缓存示例默认即为要点单例线程安全需业务自行保证无状态或自行加锁原型注入单例时如需每次新建可用特性答案服务发现与健康检查临时持久实例权重元数据心跳配置管理灰度发布历史版本监听推送命名空间动态与服务管理多环境隔离权限控制集群与一致性模式持久化视版本模式集成示例如何实现高性能的分布式配置中心答案设计目标高可用低延迟强最终一致可选灰度可控可观测核心设计推送长轮询客户端与服务端保持长轮询或配置变更即时下发客户端本地快照磁盘作为降级兜底启动优先读本地版本与灰度版本号灰度规则按实例标签可回滚多级缓存配置中心内存缓存客户端内存缓存多租户隔离三级维度限流与背压批量推送合并通知客户端指数退避可观测发布审计变更追踪客户端监控延迟分布客户端长轮询示意当前本地服务器比较不一致则返回变更列表一致则阻塞至超时或有变更性能优化要点分区分片多副本读写分离热点拆分批量异步落盘合并多请求指数退避重试监听去抖动限频存储顺序写压缩与合并冷热分层网络连接池零拷贝落地选型建议均可对强一致审计要求高选对生态一体化与服务发现合并选',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-08-19 16:51:31',
  postMainColor: '#c87f12ff',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://img.picgo.net/2025/06/23/tom09183405464859c2.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">个人主页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://benedicttom.github.io/home/" title="个人主页"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="个人主页"/><span class="back-menu-item-text">个人主页</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">Joie's Blog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> Newest Comments</span></div><div class="aside-list"><span>loading...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AMQP/" style="font-size: 1.05rem;">AMQP<sup>1</sup></a><a href="/tags/CI-CD/" style="font-size: 1.05rem;">CI/CD<sup>1</sup></a><a href="/tags/ElasticSearch/" style="font-size: 1.05rem;">ElasticSearch<sup>3</sup></a><a href="/tags/Hexo/" style="font-size: 1.05rem;">Hexo<sup>1</sup></a><a href="/tags/Http/" style="font-size: 1.05rem;">Http<sup>2</sup></a><a href="/tags/I-O/" style="font-size: 1.05rem;">I/O<sup>2</sup></a><a href="/tags/Java/" style="font-size: 1.05rem;">Java<sup>9</sup></a><a href="/tags/MongoDB/" style="font-size: 1.05rem;">MongoDB<sup>1</sup></a><a href="/tags/Mysql/" style="font-size: 1.05rem;">Mysql<sup>2</sup></a><a href="/tags/ORM/" style="font-size: 1.05rem;">ORM<sup>3</sup></a><a href="/tags/Python/" style="font-size: 1.05rem;">Python<sup>5</sup></a><a href="/tags/Redis/" style="font-size: 1.05rem;">Redis<sup>6</sup></a><a href="/tags/Redisson/" style="font-size: 1.05rem;">Redisson<sup>1</sup></a><a href="/tags/Rpc/" style="font-size: 1.05rem;">Rpc<sup>2</sup></a><a href="/tags/Spring/" style="font-size: 1.05rem;">Spring<sup>3</sup></a><a href="/tags/Spring-Cloud/" style="font-size: 1.05rem;">Spring Cloud<sup>5</sup></a><a href="/tags/Spring-Data/" style="font-size: 1.05rem;">Spring Data<sup>5</sup></a><a href="/tags/Swagger/" style="font-size: 1.05rem;">Swagger<sup>2</sup></a><a href="/tags/%E4%B8%9A%E5%8A%A1/" style="font-size: 1.05rem;">业务<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 1.05rem;">云原生<sup>1</sup></a><a href="/tags/%E5%85%AB%E8%82%A1/" style="font-size: 1.05rem;">八股<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" style="font-size: 1.05rem;">分布式锁<sup>1</sup></a><a href="/tags/%E5%8A%9B%E6%89%A3/" style="font-size: 1.05rem;">力扣<sup>10</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 1.05rem;">多线程<sup>9</sup></a><a href="/tags/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/" style="font-size: 1.05rem;">定时任务<sup>3</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 1.05rem;">并发<sup>9</sup></a><a href="/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" style="font-size: 1.05rem;">开发工具<sup>2</sup></a><a href="/tags/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/" style="font-size: 1.05rem;">异步编程<sup>1</sup></a><a href="/tags/%E6%8E%A8%E8%8D%90/" style="font-size: 1.05rem;">推荐<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 1.05rem;">数据结构<sup>5</sup></a><a href="/tags/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C/" style="font-size: 1.05rem;">权限校验<sup>4</sup></a><a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 1.05rem;">架构<sup>1</sup></a><a href="/tags/%E6%A0%91/" style="font-size: 1.05rem;">树<sup>1</sup></a><a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 1.05rem;">消息队列<sup>5</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">算法<sup>1</sup></a><a href="/tags/%E7%BC%93%E5%AD%98/" style="font-size: 1.05rem;">缓存<sup>4</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 1.05rem;">设计模式<sup>1</sup></a><a href="/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 1.05rem;">运维<sup>2</sup></a><a href="/tags/%E9%9B%86%E5%90%88/" style="font-size: 1.05rem;">集合<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 1.05rem;">面试<sup>3</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>Archives</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">September 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/08/"><span class="card-archive-list-date">August 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">46</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">July 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">28</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">June 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9D%A2%E8%AF%95%E8%80%85/" itemprop="url">面试者</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E9%9D%A2%E8%AF%95/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>面试</span></a></span></div></div><h1 class="post-title" itemprop="name headline">面试_滴滴</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-08-19T03:50:02.090Z" title="Created 2025-08-19 11:50:02">2025-08-19</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-08-19T08:51:31.707Z" title="Updated 2025-08-19 16:51:31">2025-08-19</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为北京"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>北京</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://origin.picgo.net/2025/08/07/202012111639381648986755c150cff23.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/08/19/%E9%9D%A2%E8%AF%95_%E6%BB%B4%E6%BB%B4/"><header><a class="post-meta-categories" href="/categories/%E9%9D%A2%E8%AF%95%E8%80%85/" itemprop="url">面试者</a><a href="/tags/%E9%9D%A2%E8%AF%95/" tabindex="-1" itemprop="url">面试</a><h1 id="CrawlerTitle" itemprop="name headline">面试_滴滴</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Joie</span><time itemprop="dateCreated datePublished" datetime="2025-08-19T03:50:02.090Z" title="Created 2025-08-19 11:50:02">2025-08-19</time><time itemprop="dateCreated datePublished" datetime="2025-08-19T08:51:31.707Z" title="Updated 2025-08-19 16:51:31">2025-08-19</time></header><h2 id="面试问题与答案"><a href="#面试问题与答案" class="headerlink" title="面试问题与答案"></a>面试问题与答案</h2><h3 id="1-Java-优先队列的实现原理"><a href="#1-Java-优先队列的实现原理" class="headerlink" title="1. Java 优先队列的实现原理"></a>1. Java 优先队列的实现原理</h3><p><strong>答案：</strong><br>Java的PriorityQueue基于堆（Heap）数据结构实现，默认是小顶堆。</p>
<p><strong>核心原理：</strong></p>
<ul>
<li>使用数组存储完全二叉树</li>
<li>通过<code>compareTo()</code>或<code>Comparator</code>比较元素大小</li>
<li>插入时向上调整（上浮）</li>
<li>删除时向下调整（下沉）</li>
</ul>
<p><strong>关键方法：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 插入元素 - 向上调整</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">siftUp</span><span class="params">(<span class="type">int</span> k, E x)</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (k &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">parent</span> <span class="operator">=</span> (k - <span class="number">1</span>) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">e</span> <span class="operator">=</span> queue[parent];</span><br><span class="line">        <span class="keyword">if</span> (comparator.compare(x, (E) e) &gt;= <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        queue[k] = e;</span><br><span class="line">        k = parent;</span><br><span class="line">    &#125;</span><br><span class="line">    queue[k] = x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>时间复杂度：</strong></p>
<ul>
<li>插入：O(log n)</li>
<li>删除：O(log n)</li>
<li>查找最小值：O(1)</li>
</ul>
<hr>
<h3 id="2-Redis分布式锁原理"><a href="#2-Redis分布式锁原理" class="headerlink" title="2. Redis分布式锁原理"></a>2. Redis分布式锁原理</h3><p><strong>答案：</strong><br>Redis分布式锁通过SET命令的NX（不存在才设置）和EX（过期时间）参数实现。</p>
<p><strong>核心实现：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET key value NX EX seconds</span><br></pre></td></tr></table></figure>

<p><strong>关键特性：</strong></p>
<ul>
<li><strong>原子性</strong>：SET NX EX是原子操作</li>
<li><strong>过期时间</strong>：防止死锁</li>
<li><strong>唯一性</strong>：只有第一个客户端能获得锁</li>
</ul>
<p><strong>完整实现示例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(String key, String value, <span class="type">long</span> expireTime)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> jedis.set(key, value, <span class="string">&quot;NX&quot;</span>, <span class="string">&quot;EX&quot;</span>, expireTime);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;OK&quot;</span>.equals(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">releaseLock</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then &quot;</span> +</span><br><span class="line">                   <span class="string">&quot;return redis.call(&#x27;del&#x27;, KEYS[1]) else return 0 end&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> jedis.eval(script, <span class="number">1</span>, key, value).equals(<span class="number">1L</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意事项：</strong></p>
<ul>
<li>必须设置过期时间防止死锁</li>
<li>释放锁时要验证锁的持有者</li>
<li>考虑锁的续期机制</li>
</ul>
<hr>
<h3 id="3-如何用数据库实现一个分布式锁"><a href="#3-如何用数据库实现一个分布式锁" class="headerlink" title="3. 如何用数据库实现一个分布式锁"></a>3. 如何用数据库实现一个分布式锁</h3><p><strong>答案：</strong><br>可以通过数据库的唯一索引和事务特性实现分布式锁。</p>
<p><strong>方案一：基于唯一索引</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建锁表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> distributed_lock (</span><br><span class="line">    lock_key <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    lock_value <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    expire_time <span class="type">TIMESTAMP</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    create_time <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 获取锁</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> distributed_lock (lock_key, lock_value, expire_time) </span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;order_lock&#x27;</span>, <span class="string">&#x27;client_001&#x27;</span>, DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">30</span> <span class="keyword">SECOND</span>))</span><br><span class="line"><span class="keyword">ON</span> DUPLICATE KEY <span class="keyword">UPDATE</span> </span><br><span class="line">    lock_value <span class="operator">=</span> <span class="keyword">CASE</span> </span><br><span class="line">        <span class="keyword">WHEN</span> expire_time <span class="operator">&lt;</span> NOW() <span class="keyword">THEN</span> <span class="keyword">VALUES</span>(lock_value)</span><br><span class="line">        <span class="keyword">ELSE</span> lock_value </span><br><span class="line">    <span class="keyword">END</span>,</span><br><span class="line">    expire_time <span class="operator">=</span> <span class="keyword">CASE</span> </span><br><span class="line">        <span class="keyword">WHEN</span> expire_time <span class="operator">&lt;</span> NOW() <span class="keyword">THEN</span> <span class="keyword">VALUES</span>(expire_time)</span><br><span class="line">        <span class="keyword">ELSE</span> expire_time </span><br><span class="line">    <span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<p><strong>方案二：基于行锁</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用SELECT FOR UPDATE</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> distributed_lock <span class="keyword">WHERE</span> lock_key <span class="operator">=</span> <span class="string">&#x27;order_lock&#x27;</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"><span class="comment">-- 执行业务逻辑</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p><strong>优缺点：</strong></p>
<ul>
<li><strong>优点</strong>：实现简单，利用数据库事务特性</li>
<li><strong>缺点</strong>：性能较低，不适合高并发场景</li>
</ul>
<hr>
<h3 id="4-ThreadLocal-的数据结构，原理？"><a href="#4-ThreadLocal-的数据结构，原理？" class="headerlink" title="4. ThreadLocal 的数据结构，原理？"></a>4. ThreadLocal 的数据结构，原理？</h3><p><strong>答案：</strong><br>ThreadLocal通过ThreadLocalMap存储数据，每个线程都有独立的ThreadLocalMap实例。</p>
<p><strong>核心结构：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadLocal</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="comment">// ThreadLocal的hash值，用于在ThreadLocalMap中定位</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">threadLocalHashCode</span> <span class="operator">=</span> nextHashCode();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取当前线程的ThreadLocalMap</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">        <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">        <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">            ThreadLocalMap.<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> map.getEntry(<span class="built_in">this</span>);</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">                <span class="type">T</span> <span class="variable">result</span> <span class="operator">=</span> (T)e.value;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> setInitialValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ThreadLocalMap结构：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalMap</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span> <span class="keyword">extends</span> <span class="title class_">WeakReference</span>&lt;ThreadLocal&lt;?&gt;&gt; &#123;</span><br><span class="line">        Object value;</span><br><span class="line">        Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class="line">            <span class="built_in">super</span>(k);  <span class="comment">// 弱引用指向ThreadLocal</span></span><br><span class="line">            value = v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Entry[] table;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>内存泄漏问题：</strong></p>
<ul>
<li>ThreadLocal被弱引用，可能被GC回收</li>
<li>但Entry的value是强引用，可能导致内存泄漏</li>
<li>使用完ThreadLocal后要调用remove()方法</li>
</ul>
<hr>
<h3 id="5-ThreadLocal-如何跨线程通信"><a href="#5-ThreadLocal-如何跨线程通信" class="headerlink" title="5. ThreadLocal 如何跨线程通信"></a>5. ThreadLocal 如何跨线程通信</h3><p><strong>答案：</strong><br>ThreadLocal本身无法跨线程通信，但可以通过以下方式实现：</p>
<p><strong>方案一：TransmittableThreadLocal</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransmittableThreadLocal</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">InheritableThreadLocal</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="comment">// 在创建子线程时自动传递值</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> T <span class="title function_">childValue</span><span class="params">(T parentValue)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> parentValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line">TransmittableThreadLocal&lt;String&gt; context = <span class="keyword">new</span> <span class="title class_">TransmittableThreadLocal</span>&lt;&gt;();</span><br><span class="line">context.set(<span class="string">&quot;main thread value&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子线程可以获取到父线程的值</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    System.out.println(context.get()); <span class="comment">// 输出: main thread value</span></span><br><span class="line">&#125;).start();</span><br></pre></td></tr></table></figure>

<p><strong>方案二：手动传递</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;String&gt; context = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        context.set(value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> context.get();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span> &#123;</span><br><span class="line">        context.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在子线程中手动设置</span></span><br><span class="line">ThreadLocalContext.set(<span class="string">&quot;child thread value&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>方案三：使用InheritableThreadLocal</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InheritableThreadLocal</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">ThreadLocal</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="comment">// 子线程创建时会自动继承父线程的值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="6-MQ-数据是怎么存储的？"><a href="#6-MQ-数据是怎么存储的？" class="headerlink" title="6. MQ 数据是怎么存储的？"></a>6. MQ 数据是怎么存储的？</h3><p><strong>答案：</strong><br>不同MQ的存储机制不同，以Kafka为例：</p>
<p><strong>Kafka存储机制：</strong></p>
<ul>
<li><strong>分区存储</strong>：每个topic分为多个partition</li>
<li><strong>分段存储</strong>：每个partition分为多个segment文件</li>
<li><strong>文件结构</strong>：<ul>
<li><code>.log</code>：消息数据文件</li>
<li><code>.index</code>：偏移量索引文件</li>
<li><code>.timeindex</code>：时间索引文件</li>
</ul>
</li>
</ul>
<p><strong>存储目录结构：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/tmp/kafka-logs/topic-0/</span><br><span class="line">├── 00000000000000000000.log</span><br><span class="line">├── 00000000000000000000.index</span><br><span class="line">├── 00000000000000000000.timeindex</span><br><span class="line">├── 00000000000000000001.log</span><br><span class="line">├── 00000000000000000001.index</span><br><span class="line">└── 00000000000000000001.timeindex</span><br></pre></td></tr></table></figure>

<p><strong>消息存储格式：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Message Length: 4 bytes</span><br><span class="line">CRC: 4 bytes</span><br><span class="line">Magic: 1 byte</span><br><span class="line">Attributes: 1 byte</span><br><span class="line">Timestamp: 8 bytes</span><br><span class="line">Key Length: 4 bytes</span><br><span class="line">Key: N bytes</span><br><span class="line">Value Length: 4 bytes</span><br><span class="line">Value: N bytes</span><br></pre></td></tr></table></figure>

<p><strong>其他MQ存储方式：</strong></p>
<ul>
<li><strong>RabbitMQ</strong>：基于Erlang的Mnesia数据库</li>
<li><strong>RocketMQ</strong>：基于文件系统，支持多种存储引擎</li>
<li><strong>Pulsar</strong>：分层存储，热数据在内存，冷数据在BookKeeper</li>
</ul>
<hr>
<h3 id="7-消费者如何消费MQ-中的消息？"><a href="#7-消费者如何消费MQ-中的消息？" class="headerlink" title="7. 消费者如何消费MQ 中的消息？"></a>7. 消费者如何消费MQ 中的消息？</h3><p><strong>答案：</strong><br>消费者通过拉取或推送方式消费消息，以Kafka为例：</p>
<p><strong>拉取模式（Pull）：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@KafkaListener(topics = &quot;user-topic&quot;, groupId = &quot;user-group&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">consumeUserMessage</span><span class="params">(ConsumerRecord&lt;String, String&gt; record)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 处理消息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> record.value();</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> record.key();</span><br><span class="line">        <span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> record.offset();</span><br><span class="line">        <span class="type">int</span> <span class="variable">partition</span> <span class="operator">=</span> record.partition();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 业务逻辑处理</span></span><br><span class="line">        processUserMessage(message);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 手动提交偏移量</span></span><br><span class="line">        <span class="comment">// kafkaTemplate.commitSync();</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// 异常处理</span></span><br><span class="line">        log.error(<span class="string">&quot;消费消息失败&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>批量消费：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@KafkaListener(topics = &quot;batch-topic&quot;, groupId = &quot;batch-group&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">consumeBatchMessages</span><span class="params">(List&lt;ConsumerRecord&lt;String, String&gt;&gt; records)</span> &#123;</span><br><span class="line">    List&lt;String&gt; messages = records.stream()</span><br><span class="line">        .map(ConsumerRecord::value)</span><br><span class="line">        .collect(Collectors.toList());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 批量处理</span></span><br><span class="line">    batchProcessMessages(messages);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>消费者配置：</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="attr">consumer:</span></span><br><span class="line">      <span class="attr">bootstrap-servers:</span> <span class="string">localhost:9092</span></span><br><span class="line">      <span class="attr">group-id:</span> <span class="string">user-group</span></span><br><span class="line">      <span class="attr">auto-offset-reset:</span> <span class="string">earliest</span></span><br><span class="line">      <span class="attr">enable-auto-commit:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">key-deserializer:</span> <span class="string">org.apache.kafka.common.serialization.StringDeserializer</span></span><br><span class="line">      <span class="attr">value-deserializer:</span> <span class="string">org.apache.kafka.common.serialization.StringDeserializer</span></span><br><span class="line">      <span class="attr">max-poll-records:</span> <span class="number">500</span></span><br><span class="line">      <span class="attr">fetch-min-size:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">fetch-max-wait:</span> <span class="number">500</span></span><br></pre></td></tr></table></figure>

<p><strong>消费策略：</strong></p>
<ul>
<li><strong>顺序消费</strong>：单分区单消费者</li>
<li><strong>并行消费</strong>：多分区多消费者</li>
<li><strong>批量消费</strong>：提高吞吐量</li>
<li><strong>异步消费</strong>：非阻塞处理</li>
</ul>
<hr>
<h3 id="8-线程池参数详解"><a href="#8-线程池参数详解" class="headerlink" title="8. 线程池参数详解"></a>8. 线程池参数详解</h3><p><strong>答案：</strong><br>线程池的核心参数包括：</p>
<p><strong>核心参数：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ThreadPoolExecutor</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="type">int</span> corePoolSize,        // 核心线程数</span></span><br><span class="line"><span class="params">    <span class="type">int</span> maximumPoolSize,     // 最大线程数</span></span><br><span class="line"><span class="params">    <span class="type">long</span> keepAliveTime,      // 线程空闲时间</span></span><br><span class="line"><span class="params">    TimeUnit unit,           // 时间单位</span></span><br><span class="line"><span class="params">    BlockingQueue&lt;Runnable&gt; workQueue,  // 工作队列</span></span><br><span class="line"><span class="params">    ThreadFactory threadFactory,         // 线程工厂</span></span><br><span class="line"><span class="params">    RejectedExecutionHandler handler     // 拒绝策略</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>

<p><strong>参数详解：</strong></p>
<ol>
<li><p><strong>corePoolSize（核心线程数）</strong></p>
<ul>
<li>线程池中会维护的最小线程数</li>
<li>即使这些线程空闲，也不会被回收</li>
<li>建议：CPU密集型任务 &#x3D; CPU核心数 + 1，IO密集型任务 &#x3D; CPU核心数 * 2</li>
</ul>
</li>
<li><p><strong>maximumPoolSize（最大线程数）</strong></p>
<ul>
<li>线程池中允许的最大线程数</li>
<li>当工作队列满了，且当前线程数小于最大线程数时，会创建新线程</li>
</ul>
</li>
<li><p><strong>keepAliveTime（线程空闲时间）</strong></p>
<ul>
<li>当线程数大于核心线程数时，多余线程的空闲时间</li>
<li>超过这个时间，多余线程会被回收</li>
</ul>
</li>
<li><p><strong>workQueue（工作队列）</strong></p>
<ul>
<li>存储等待执行的任务的阻塞队列</li>
<li>当所有核心线程都在工作时，新任务会放入队列</li>
</ul>
</li>
</ol>
<p><strong>线程池工作流程：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 当前线程数 &lt; corePoolSize → 创建新线程执行任务</span><br><span class="line">2. 当前线程数 &gt;= corePoolSize → 任务放入队列</span><br><span class="line">3. 队列满了且当前线程数 &lt; maximumPoolSize → 创建新线程执行任务</span><br><span class="line">4. 队列满了且当前线程数 &gt;= maximumPoolSize → 执行拒绝策略</span><br></pre></td></tr></table></figure>

<p><strong>常用线程池：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 固定大小线程池</span></span><br><span class="line"><span class="type">ExecutorService</span> <span class="variable">fixedThreadPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可缓存线程池</span></span><br><span class="line"><span class="type">ExecutorService</span> <span class="variable">cachedThreadPool</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 单线程池</span></span><br><span class="line"><span class="type">ExecutorService</span> <span class="variable">singleThreadExecutor</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定时任务线程池</span></span><br><span class="line"><span class="type">ScheduledExecutorService</span> <span class="variable">scheduledThreadPool</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="9-线程池队列什么时候往里加元素？"><a href="#9-线程池队列什么时候往里加元素？" class="headerlink" title="9. 线程池队列什么时候往里加元素？"></a>9. 线程池队列什么时候往里加元素？</h3><p><strong>答案：</strong><br>线程池队列在以下情况下会添加元素：</p>
<p><strong>添加元素的时机：</strong></p>
<ol>
<li><strong>当前线程数 &gt;&#x3D; corePoolSize</strong>：新任务会先尝试放入队列</li>
<li><strong>队列未满</strong>：任务直接放入队列等待执行</li>
<li><strong>所有核心线程都在工作</strong>：新任务必须排队</li>
</ol>
<p><strong>队列类型及特点：</strong></p>
<ol>
<li><strong>ArrayBlockingQueue（有界队列）</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 固定大小的数组队列</span></span><br><span class="line">BlockingQueue&lt;Runnable&gt; queue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>特点：FIFO，有界，适合内存敏感场景</li>
<li>使用场景：任务量可预测，内存有限</li>
</ul>
<ol start="2">
<li><strong>LinkedBlockingQueue（无界队列）</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基于链表的无界队列</span></span><br><span class="line">BlockingQueue&lt;Runnable&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>
<ul>
<li>特点：FIFO，无界，内存占用较大</li>
<li>使用场景：任务量不可预测，内存充足</li>
</ul>
<ol start="3">
<li><strong>SynchronousQueue（同步队列）</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不存储元素的阻塞队列</span></span><br><span class="line">BlockingQueue&lt;Runnable&gt; queue = <span class="keyword">new</span> <span class="title class_">SynchronousQueue</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>
<ul>
<li>特点：不存储元素，每个插入操作必须等待另一个线程的移除操作</li>
<li>使用场景：要求任务立即执行，不允许排队</li>
</ul>
<ol start="4">
<li><strong>PriorityBlockingQueue（优先级队列）</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基于优先级的无界阻塞队列</span></span><br><span class="line">BlockingQueue&lt;Runnable&gt; queue = <span class="keyword">new</span> <span class="title class_">PriorityBlockingQueue</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>
<ul>
<li>特点：基于优先级排序，无界</li>
<li>使用场景：任务有优先级要求</li>
</ul>
<p><strong>队列选择建议：</strong></p>
<ul>
<li><strong>CPU密集型</strong>：ArrayBlockingQueue，避免过多线程切换</li>
<li><strong>IO密集型</strong>：LinkedBlockingQueue，提高并发度</li>
<li><strong>实时性要求高</strong>：SynchronousQueue，任务立即执行</li>
<li><strong>任务有优先级</strong>：PriorityBlockingQueue</li>
</ul>
<hr>
<h3 id="10-Spring-Boot-和-Spring-Cloud-的区别？"><a href="#10-Spring-Boot-和-Spring-Cloud-的区别？" class="headerlink" title="10. Spring Boot 和 Spring Cloud 的区别？"></a>10. Spring Boot 和 Spring Cloud 的区别？</h3><p><strong>答案：</strong><br>Spring Boot和Spring Cloud是两个不同层次的技术：</p>
<p><strong>Spring Boot：</strong></p>
<ul>
<li><strong>定位</strong>：快速构建Spring应用的脚手架</li>
<li><strong>功能</strong>：自动配置、内嵌服务器、生产就绪特性</li>
<li><strong>范围</strong>：单个应用&#x2F;服务</li>
</ul>
<p><strong>Spring Cloud：</strong></p>
<ul>
<li><strong>定位</strong>：分布式系统开发工具集</li>
<li><strong>功能</strong>：服务发现、配置管理、熔断器、网关等</li>
<li><strong>范围</strong>：微服务架构</li>
</ul>
<p><strong>详细对比：</strong></p>
<table>
<thead>
<tr>
<th>特性</th>
<th>Spring Boot</th>
<th>Spring Cloud</th>
</tr>
</thead>
<tbody><tr>
<td>定位</td>
<td>应用开发框架</td>
<td>微服务治理框架</td>
</tr>
<tr>
<td>依赖</td>
<td>spring-boot-starter</td>
<td>spring-cloud-starter</td>
</tr>
<tr>
<td>配置</td>
<td>application.yml</td>
<td>bootstrap.yml + application.yml</td>
</tr>
<tr>
<td>服务注册</td>
<td>无</td>
<td>Eureka、Consul、Nacos</td>
</tr>
<tr>
<td>配置中心</td>
<td>无</td>
<td>Config、Nacos、Apollo</td>
</tr>
<tr>
<td>负载均衡</td>
<td>无</td>
<td>Ribbon、LoadBalancer</td>
</tr>
<tr>
<td>熔断器</td>
<td>无</td>
<td>Hystrix、Sentinel</td>
</tr>
<tr>
<td>网关</td>
<td>无</td>
<td>Gateway、Zuul</td>
</tr>
</tbody></table>
<p><strong>使用场景：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Spring Boot应用</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(UserServiceApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Spring Cloud应用</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span>  <span class="comment">// 服务发现</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span>     <span class="comment">// 服务调用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderServiceApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>关系：</strong></p>
<ul>
<li>Spring Cloud基于Spring Boot构建</li>
<li>Spring Boot提供基础能力，Spring Cloud提供分布式能力</li>
<li>可以单独使用Spring Boot，但不能单独使用Spring Cloud</li>
</ul>
<hr>
<h3 id="11-类加载机制？"><a href="#11-类加载机制？" class="headerlink" title="11. 类加载机制？"></a>11. 类加载机制？</h3><p><strong>答案：</strong><br>Java类加载机制包括加载、验证、准备、解析、初始化五个阶段：</p>
<p><strong>类加载过程：</strong></p>
<ol>
<li><p><strong>加载（Loading）</strong></p>
<ul>
<li>通过类名获取类的二进制数据</li>
<li>将二进制数据转换为方法区内的运行时数据结构</li>
<li>在内存中生成Class对象</li>
</ul>
</li>
<li><p><strong>验证（Verification）</strong></p>
<ul>
<li>文件格式验证：魔数、版本号等</li>
<li>元数据验证：语义分析</li>
<li>字节码验证：程序逻辑验证</li>
<li>符号引用验证：符号引用转换为直接引用</li>
</ul>
</li>
<li><p><strong>准备（Preparation）</strong></p>
<ul>
<li>为类变量分配内存</li>
<li>设置类变量的初始值（零值）</li>
</ul>
</li>
<li><p><strong>解析（Resolution）</strong></p>
<ul>
<li>将符号引用转换为直接引用</li>
<li>符号引用：以符号形式描述所引用的目标</li>
<li>直接引用：指向目标的指针、相对偏移量等</li>
</ul>
</li>
<li><p><strong>初始化（Initialization）</strong></p>
<ul>
<li>执行类构造器<code>&lt;clinit&gt;()</code>方法</li>
<li>为类变量赋初始值</li>
<li>执行静态代码块</li>
</ul>
</li>
</ol>
<p><strong>类加载器层次：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Bootstrap ClassLoader (启动类加载器)</span><br><span class="line">    ↓</span><br><span class="line">Extension ClassLoader (扩展类加载器)</span><br><span class="line">    ↓</span><br><span class="line">Application ClassLoader (应用类加载器)</span><br><span class="line">    ↓</span><br><span class="line">Custom ClassLoader (自定义类加载器)</span><br></pre></td></tr></table></figure>

<p><strong>双亲委派模型：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Class&lt;?&gt; loadClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">    <span class="comment">// 1. 检查是否已经加载</span></span><br><span class="line">    Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">    <span class="keyword">if</span> (c != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 委派给父加载器</span></span><br><span class="line">    <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            c = parent.loadClass(name);</span><br><span class="line">            <span class="keyword">if</span> (c != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> c;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="comment">// 父加载器无法加载</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 自己尝试加载</span></span><br><span class="line">    <span class="keyword">return</span> findClass(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>破坏双亲委派的情况：</strong></p>
<ul>
<li><strong>SPI机制</strong>：如JDBC驱动加载</li>
<li><strong>热部署</strong>：如OSGi、Tomcat</li>
<li><strong>自定义类加载器</strong>：重写loadClass方法</li>
</ul>
<hr>
<h3 id="12-JVM-垃圾回收机制？"><a href="#12-JVM-垃圾回收机制？" class="headerlink" title="12. JVM 垃圾回收机制？"></a>12. JVM 垃圾回收机制？</h3><p><strong>答案：</strong><br>JVM垃圾回收机制包括垃圾识别、垃圾回收算法、垃圾收集器等：</p>
<p><strong>垃圾识别算法：</strong></p>
<ol>
<li><p><strong>引用计数法</strong></p>
<ul>
<li>每个对象维护一个引用计数器</li>
<li>引用为0时立即回收</li>
<li>缺点：无法解决循环引用问题</li>
</ul>
</li>
<li><p><strong>可达性分析</strong></p>
<ul>
<li>从GC Roots开始，标记所有可达对象</li>
<li>未被标记的对象即为垃圾</li>
<li>GC Roots包括：栈中局部变量、静态变量、常量、本地方法栈等</li>
</ul>
</li>
</ol>
<p><strong>垃圾回收算法：</strong></p>
<ol>
<li><strong>标记-清除（Mark-Sweep）</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 标记阶段：标记所有可达对象</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">mark</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj != <span class="literal">null</span> &amp;&amp; !obj.isMarked()) &#123;</span><br><span class="line">        obj.setMarked(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">for</span> (Object ref : obj.getReferences()) &#123;</span><br><span class="line">            mark(ref);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清除阶段：回收未标记对象</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">sweep</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (Object obj : heap) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!obj.isMarked()) &#123;</span><br><span class="line">            free(obj);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            obj.setMarked(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p><strong>复制（Copying）</strong></p>
<ul>
<li>将内存分为两块，每次只使用一块</li>
<li>垃圾回收时，将存活对象复制到另一块</li>
<li>优点：效率高，无碎片</li>
<li>缺点：内存利用率低</li>
</ul>
</li>
<li><p><strong>标记-整理（Mark-Compact）</strong></p>
<ul>
<li>标记阶段同标记-清除</li>
<li>整理阶段：将存活对象向一端移动</li>
<li>优点：无碎片，内存利用率高</li>
<li>缺点：效率较低</li>
</ul>
</li>
<li><p><strong>分代收集</strong></p>
<ul>
<li>新生代：复制算法</li>
<li>老年代：标记-整理或标记-清除</li>
</ul>
</li>
</ol>
<p><strong>垃圾收集器：</strong></p>
<ol>
<li><p><strong>Serial收集器</strong></p>
<ul>
<li>单线程收集器</li>
<li>适合客户端应用</li>
</ul>
</li>
<li><p><strong>Parallel收集器</strong></p>
<ul>
<li>多线程收集器</li>
<li>适合服务器应用</li>
</ul>
</li>
<li><p><strong>CMS收集器</strong></p>
<ul>
<li>并发标记清除</li>
<li>低停顿时间</li>
</ul>
</li>
<li><p><strong>G1收集器</strong></p>
<ul>
<li>区域化内存布局</li>
<li>可预测的停顿时间</li>
</ul>
</li>
<li><p><strong>ZGC收集器</strong></p>
<ul>
<li>低延迟垃圾收集器</li>
<li>停顿时间不超过10ms</li>
</ul>
</li>
</ol>
<p><strong>GC调优参数：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 堆内存大小</span></span><br><span class="line">-Xms4g -Xmx4g</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新生代大小</span></span><br><span class="line">-Xmn1g</span><br><span class="line"></span><br><span class="line"><span class="comment"># 垃圾收集器选择</span></span><br><span class="line">-XX:+UseG1GC</span><br><span class="line"></span><br><span class="line"><span class="comment"># GC日志</span></span><br><span class="line">-XX:+PrintGCDetails -XX:+PrintGCTimeStamps</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="13-HashMap-原理"><a href="#13-HashMap-原理" class="headerlink" title="13. HashMap 原理"></a>13. HashMap 原理</h3><p><strong>答案：</strong><br>HashMap基于数组+链表+红黑树的数据结构实现：</p>
<p><strong>核心数据结构：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashMap</span>&lt;K,V&gt; <span class="keyword">extends</span> <span class="title class_">AbstractMap</span>&lt;K,V&gt; &#123;</span><br><span class="line">    <span class="comment">// 存储键值对的数组</span></span><br><span class="line">    <span class="keyword">transient</span> Node&lt;K,V&gt;[] table;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 键值对数量</span></span><br><span class="line">    <span class="keyword">transient</span> <span class="type">int</span> size;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 扩容阈值</span></span><br><span class="line">    <span class="type">int</span> threshold;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 负载因子</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">float</span> loadFactor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 链表节点</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;K,V&gt; <span class="keyword">implements</span> <span class="title class_">Map</span>.Entry&lt;K,V&gt; &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> hash;</span><br><span class="line">    <span class="keyword">final</span> K key;</span><br><span class="line">    V value;</span><br><span class="line">    Node&lt;K,V&gt; next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>工作原理：</strong></p>
<ol>
<li><strong>计算hash值</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="literal">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>确定数组索引</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> (n - <span class="number">1</span>) &amp; hash;  <span class="comment">// n是数组长度</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>插入元素</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> V <span class="title function_">putVal</span><span class="params">(<span class="type">int</span> hash, K key, V value, <span class="type">boolean</span> onlyIfAbsent, <span class="type">boolean</span> evict)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="type">int</span> n, i;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. 数组为空，初始化</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 计算索引位置</span></span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="literal">null</span>)</span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 3. 处理hash冲突</span></span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="built_in">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 4. 链表插入</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">binCount</span> <span class="operator">=</span> <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="literal">null</span>) &#123;</span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>)</span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="literal">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 5. 扩容检查</span></span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>扩容机制：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">oldCap</span> <span class="operator">=</span> (oldTab == <span class="literal">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">oldThr</span> <span class="operator">=</span> threshold;</span><br><span class="line">    <span class="type">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">            threshold = Integer.MAX_VALUE;</span><br><span class="line">            <span class="keyword">return</span> oldTab;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">            newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// 阈值翻倍</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建新数组，重新hash</span></span><br><span class="line">    Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> <span class="title class_">Node</span>[newCap];</span><br><span class="line">    table = newTab;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 重新分配元素</span></span><br><span class="line">    <span class="keyword">if</span> (oldTab != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">            Node&lt;K,V&gt; e;</span><br><span class="line">            <span class="keyword">if</span> ((e = oldTab[j]) != <span class="literal">null</span>) &#123;</span><br><span class="line">                oldTab[j] = <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">if</span> (e.next == <span class="literal">null</span>)</span><br><span class="line">                    newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                    ((TreeNode&lt;K,V&gt;)e).split(<span class="built_in">this</span>, newTab, j, oldCap);</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 链表重新分配</span></span><br><span class="line">                    Node&lt;K,V&gt; loHead = <span class="literal">null</span>, loTail = <span class="literal">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; hiHead = <span class="literal">null</span>, hiTail = <span class="literal">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; next;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                        next = e.next;</span><br><span class="line">                        <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (loTail == <span class="literal">null</span>)</span><br><span class="line">                                loHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                loTail.next = e;</span><br><span class="line">                            loTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (hiTail == <span class="literal">null</span>)</span><br><span class="line">                                hiHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                hiTail.next = e;</span><br><span class="line">                            hiTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">while</span> ((e = next) != <span class="literal">null</span>);</span><br><span class="line">                    <span class="keyword">if</span> (loTail != <span class="literal">null</span>) &#123;</span><br><span class="line">                        loTail.next = <span class="literal">null</span>;</span><br><span class="line">                        newTab[j] = loHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (hiTail != <span class="literal">null</span>) &#123;</span><br><span class="line">                        hiTail.next = <span class="literal">null</span>;</span><br><span class="line">                        newTab[j + oldCap] = hiHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newTab;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>红黑树转换：</strong></p>
<ul>
<li>当链表长度 &gt;&#x3D; 8 且数组长度 &gt;&#x3D; 64 时，链表转换为红黑树</li>
<li>当红黑树节点数 &lt;&#x3D; 6 时，红黑树转换为链表</li>
</ul>
<p><strong>性能特点：</strong></p>
<ul>
<li>平均时间复杂度：O(1)</li>
<li>最坏时间复杂度：O(n)（所有元素hash冲突）</li>
<li>空间复杂度：O(n)</li>
</ul>
<hr>
<h3 id="14-ConcurrentHashMap-原理"><a href="#14-ConcurrentHashMap-原理" class="headerlink" title="14. ConcurrentHashMap 原理"></a>14. ConcurrentHashMap 原理</h3><p><strong>答案：</strong><br>ConcurrentHashMap是线程安全的HashMap，JDK 1.8基于CAS + synchronized实现：</p>
<p><strong>核心数据结构：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcurrentHashMap</span>&lt;K,V&gt; <span class="keyword">extends</span> <span class="title class_">AbstractMap</span>&lt;K,V&gt; &#123;</span><br><span class="line">    <span class="comment">// 存储键值对的数组</span></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">volatile</span> Node&lt;K,V&gt;[] table;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 扩容时的临时数组</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Node&lt;K,V&gt;[] nextTable;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 基础计数器</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="type">long</span> baseCount;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 扩容控制</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="type">int</span> sizeCtl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 节点类型</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;K,V&gt; <span class="keyword">implements</span> <span class="title class_">Map</span>.Entry&lt;K,V&gt; &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> hash;</span><br><span class="line">    <span class="keyword">final</span> K key;</span><br><span class="line">    <span class="keyword">volatile</span> V value;</span><br><span class="line">    <span class="keyword">volatile</span> Node&lt;K,V&gt; next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>线程安全机制：</strong></p>
<ol>
<li><strong>CAS操作</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用CAS更新值</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> &lt;K,V&gt; <span class="type">boolean</span> <span class="title function_">casTabAt</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="type">int</span> i, Node&lt;K,V&gt; c, Node&lt;K,V&gt; v)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> U.compareAndSwapObject(tab, ((<span class="type">long</span>)i &lt;&lt; ASHIFT) + ABASE, c, v);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用CAS更新sizeCtl</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">initTable</span><span class="params">()</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; <span class="type">int</span> sc;</span><br><span class="line">    <span class="keyword">while</span> ((tab = table) == <span class="literal">null</span> || tab.length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((sc = sizeCtl) &lt; <span class="number">0</span>)</span><br><span class="line">            Thread.<span class="keyword">yield</span>(); <span class="comment">// 其他线程正在初始化</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (U.compareAndSwapInt(<span class="built_in">this</span>, SIZECTL, sc, -<span class="number">1</span>)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> ((tab = table) == <span class="literal">null</span> || tab.length == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> (sc &gt; <span class="number">0</span>) ? sc : DEFAULT_CAPACITY;</span><br><span class="line">                    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">                    Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class="keyword">new</span> <span class="title class_">Node</span>&lt;?,?&gt;[n];</span><br><span class="line">                    table = tab = nt;</span><br><span class="line">                    sc = n - (n &gt;&gt;&gt; <span class="number">2</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                sizeCtl = sc;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>synchronized锁</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对数组元素加锁</span></span><br><span class="line"><span class="keyword">synchronized</span> (f) &#123;</span><br><span class="line">    <span class="keyword">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fh &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 链表操作</span></span><br><span class="line">            binCount = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) &#123;</span><br><span class="line">                K ek;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((ek = e.key) == key || (ek != <span class="literal">null</span> &amp;&amp; key.equals(ek)))) &#123;</span><br><span class="line">                    oldVal = e.val;</span><br><span class="line">                    <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                        e.val = value;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                Node&lt;K,V&gt; pred = e;</span><br><span class="line">                <span class="keyword">if</span> ((e = e.next) == <span class="literal">null</span>) &#123;</span><br><span class="line">                    pred.next = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;K,V&gt;(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (f <span class="keyword">instanceof</span> TreeBin) &#123;</span><br><span class="line">            <span class="comment">// 红黑树操作</span></span><br><span class="line">            Node&lt;K,V&gt; p;</span><br><span class="line">            binCount = <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key, value)) != <span class="literal">null</span>) &#123;</span><br><span class="line">                oldVal = p.val;</span><br><span class="line">                <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                    p.val = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>put操作流程：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(key, value, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> V <span class="title function_">putVal</span><span class="params">(K key, V value, <span class="type">boolean</span> onlyIfAbsent)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="literal">null</span> || value == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">    <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> spread(key.hashCode());</span><br><span class="line">    <span class="type">int</span> <span class="variable">binCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (Node&lt;K,V&gt;[] tab = table;;) &#123;</span><br><span class="line">        Node&lt;K,V&gt; f; <span class="type">int</span> n, i, fh;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 1. 初始化table</span></span><br><span class="line">        <span class="keyword">if</span> (tab == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">            tab = initTable();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 计算索引位置</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((f = tabAt(tab, i = (n - <span class="number">1</span>) &amp; hash)) == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 3. CAS插入新节点</span></span><br><span class="line">            <span class="keyword">if</span> (casTabAt(tab, i, <span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">Node</span>&lt;K,V&gt;(hash, key, value, <span class="literal">null</span>)))</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 处理hash冲突</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((fh = f.hash) == MOVED)</span><br><span class="line">            tab = helpTransfer(tab, f);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">V</span> <span class="variable">oldVal</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">synchronized</span> (f) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (fh &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="comment">// 链表操作</span></span><br><span class="line">                        binCount = <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) &#123;</span><br><span class="line">                            K ek;</span><br><span class="line">                            <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((ek = e.key) == key || (ek != <span class="literal">null</span> &amp;&amp; key.equals(ek)))) &#123;</span><br><span class="line">                                oldVal = e.val;</span><br><span class="line">                                <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                                    e.val = value;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            Node&lt;K,V&gt; pred = e;</span><br><span class="line">                            <span class="keyword">if</span> ((e = e.next) == <span class="literal">null</span>) &#123;</span><br><span class="line">                                pred.next = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;K,V&gt;(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (f <span class="keyword">instanceof</span> TreeBin) &#123;</span><br><span class="line">                        <span class="comment">// 红黑树操作</span></span><br><span class="line">                        Node&lt;K,V&gt; p;</span><br><span class="line">                        binCount = <span class="number">2</span>;</span><br><span class="line">                        <span class="keyword">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key, value)) != <span class="literal">null</span>) &#123;</span><br><span class="line">                            oldVal = p.val;</span><br><span class="line">                            <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                                p.val = value;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (binCount != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)</span><br><span class="line">                    treeifyBin(tab, i);</span><br><span class="line">                <span class="keyword">if</span> (oldVal != <span class="literal">null</span>)</span><br><span class="line">                    <span class="keyword">return</span> oldVal;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 5. 更新计数</span></span><br><span class="line">    addCount(<span class="number">1L</span>, binCount);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>扩容机制：</strong></p>
<ul>
<li>支持多线程并发扩容</li>
<li>使用ForwardingNode标记正在扩容的节点</li>
<li>其他线程可以参与扩容过程</li>
</ul>
<p><strong>性能特点：</strong></p>
<ul>
<li>读操作无锁，性能高</li>
<li>写操作使用分段锁，减少锁竞争</li>
<li>支持高并发读写</li>
</ul>
<hr>
<h3 id="15-详细讲一下大模型怎么用的？"><a href="#15-详细讲一下大模型怎么用的？" class="headerlink" title="15. 详细讲一下大模型怎么用的？"></a>15. 详细讲一下大模型怎么用的？</h3><p><strong>答案：</strong><br>大模型（LLM）的应用方式多样，主要包括以下几种：</p>
<p><strong>1. 直接调用API</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用OpenAI API</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OpenAIService</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;openai.api.key&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String apiKey;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generateText</span><span class="params">(String prompt)</span> &#123;</span><br><span class="line">        <span class="type">OpenAiService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OpenAiService</span>(apiKey);</span><br><span class="line">        </span><br><span class="line">        <span class="type">CompletionRequest</span> <span class="variable">request</span> <span class="operator">=</span> CompletionRequest.builder()</span><br><span class="line">            .model(<span class="string">&quot;gpt-3.5-turbo&quot;</span>)</span><br><span class="line">            .messages(Arrays.asList(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ChatMessage</span>(<span class="string">&quot;user&quot;</span>, prompt)</span><br><span class="line">            ))</span><br><span class="line">            .maxTokens(<span class="number">1000</span>)</span><br><span class="line">            .temperature(<span class="number">0.7</span>)</span><br><span class="line">            .build();</span><br><span class="line">            </span><br><span class="line">        <span class="type">ChatCompletion</span> <span class="variable">response</span> <span class="operator">=</span> service.createChatCompletion(request);</span><br><span class="line">        <span class="keyword">return</span> response.getChoices().get(<span class="number">0</span>).getMessage().getContent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2. 本地部署模型</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用Hugging Face Transformers</span></span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer, AutoModelForCausalLM</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载模型</span></span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(<span class="string">&quot;THUDM/chatglm2-6b&quot;</span>)</span><br><span class="line">model = AutoModelForCausalLM.from_pretrained(<span class="string">&quot;THUDM/chatglm2-6b&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成文本</span></span><br><span class="line">inputs = tokenizer(<span class="string">&quot;你好，请介绍一下自己&quot;</span>, return_tensors=<span class="string">&quot;pt&quot;</span>)</span><br><span class="line">outputs = model.generate(**inputs, max_length=<span class="number">100</span>)</span><br><span class="line">response = tokenizer.decode(outputs[<span class="number">0</span>], skip_special_tokens=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p><strong>3. 微调训练</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用LoRA进行微调</span></span><br><span class="line"><span class="keyword">from</span> peft <span class="keyword">import</span> LoraConfig, get_peft_model</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> TrainingArguments, Trainer</span><br><span class="line"></span><br><span class="line"><span class="comment"># LoRA配置</span></span><br><span class="line">lora_config = LoraConfig(</span><br><span class="line">    r=<span class="number">16</span>,</span><br><span class="line">    lora_alpha=<span class="number">32</span>,</span><br><span class="line">    target_modules=[<span class="string">&quot;q_proj&quot;</span>, <span class="string">&quot;v_proj&quot;</span>],</span><br><span class="line">    lora_dropout=<span class="number">0.05</span>,</span><br><span class="line">    bias=<span class="string">&quot;none&quot;</span>,</span><br><span class="line">    task_type=<span class="string">&quot;CAUSAL_LM&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用LoRA</span></span><br><span class="line">model = get_peft_model(model, lora_config)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 训练参数</span></span><br><span class="line">training_args = TrainingArguments(</span><br><span class="line">    output_dir=<span class="string">&quot;./results&quot;</span>,</span><br><span class="line">    num_train_epochs=<span class="number">3</span>,</span><br><span class="line">    per_device_train_batch_size=<span class="number">4</span>,</span><br><span class="line">    gradient_accumulation_steps=<span class="number">4</span>,</span><br><span class="line">    warmup_steps=<span class="number">100</span>,</span><br><span class="line">    learning_rate=<span class="number">2e-4</span>,</span><br><span class="line">    fp16=<span class="literal">True</span>,</span><br><span class="line">    logging_steps=<span class="number">10</span>,</span><br><span class="line">    save_steps=<span class="number">1000</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 训练</span></span><br><span class="line">trainer = Trainer(</span><br><span class="line">    model=model,</span><br><span class="line">    args=training_args,</span><br><span class="line">    train_dataset=train_dataset,</span><br><span class="line">    data_collator=data_collator,</span><br><span class="line">)</span><br><span class="line">trainer.train()</span><br></pre></td></tr></table></figure>

<p><strong>4. 实际应用场景</strong></p>
<p><strong>代码生成：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeGenerationService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generateCode</span><span class="params">(String requirement)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            请根据以下需求生成Java代码：</span></span><br><span class="line"><span class="string">            需求：%s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            要求：</span></span><br><span class="line"><span class="string">            1. 代码要规范，有注释</span></span><br><span class="line"><span class="string">            2. 包含异常处理</span></span><br><span class="line"><span class="string">            3. 遵循设计模式</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>, requirement);</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> openAIService.generateText(prompt);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">codeReview</span><span class="params">(String code)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            请对以下Java代码进行代码审查：</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            请指出：</span></span><br><span class="line"><span class="string">            1. 潜在的问题</span></span><br><span class="line"><span class="string">            2. 性能优化建议</span></span><br><span class="line"><span class="string">            3. 代码规范问题</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>, code);</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> openAIService.generateText(prompt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>文档生成：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DocumentationService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generateAPI</span><span class="params">(String code)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            请为以下Java方法生成API文档：</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            请包含：</span></span><br><span class="line"><span class="string">            1. 方法说明</span></span><br><span class="line"><span class="string">            2. 参数说明</span></span><br><span class="line"><span class="string">            3. 返回值说明</span></span><br><span class="line"><span class="string">            4. 使用示例</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>, code);</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> openAIService.generateText(prompt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>5. 集成到开发流程</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AIDevelopmentAssistant</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCodeCommit</span><span class="params">(CodeCommitEvent event)</span> &#123;</span><br><span class="line">        <span class="comment">// 代码提交后自动生成文档</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">documentation</span> <span class="operator">=</span> generateDocumentation(event.getCode());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 自动代码审查</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">review</span> <span class="operator">=</span> codeReview(event.getCode());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 发送通知</span></span><br><span class="line">        notificationService.sendReviewNotification(documentation, review);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generateTestCases</span><span class="params">(String methodCode)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            请为以下Java方法生成单元测试用例：</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            %s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            要求：</span></span><br><span class="line"><span class="string">            1. 覆盖正常情况</span></span><br><span class="line"><span class="string">            2. 覆盖边界情况</span></span><br><span class="line"><span class="string">            3. 覆盖异常情况</span></span><br><span class="line"><span class="string">            4. 使用JUnit 5</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>, methodCode);</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> openAIService.generateText(prompt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>6. 成本控制策略</strong></p>
<ul>
<li>使用缓存减少重复调用</li>
<li>批量处理减少API调用次数</li>
<li>本地模型减少API费用</li>
<li>智能路由选择最合适的模型</li>
</ul>
<hr>
<h3 id="16-SQL-优化方式？越详细越好"><a href="#16-SQL-优化方式？越详细越好" class="headerlink" title="16. SQL 优化方式？越详细越好"></a>16. SQL 优化方式？越详细越好</h3><p><strong>答案：</strong><br>SQL优化是一个系统工程，需要从多个维度进行优化：</p>
<p><strong>1. 索引优化</strong></p>
<p><strong>创建合适的索引：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 单列索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_name <span class="keyword">ON</span> users(name);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 复合索引（注意列顺序）</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_status_created <span class="keyword">ON</span> users(status, created_at);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 覆盖索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_covering <span class="keyword">ON</span> users(id, name, email, status);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 部分索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_active <span class="keyword">ON</span> users(email) <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="string">&#x27;active&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 函数索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_lower_email <span class="keyword">ON</span> users(<span class="built_in">LOWER</span>(email));</span><br></pre></td></tr></table></figure>

<p><strong>索引设计原则：</strong></p>
<ul>
<li>最左前缀原则：复合索引的列顺序很重要</li>
<li>选择性原则：选择区分度高的列建立索引</li>
<li>覆盖索引：尽量让查询只通过索引就能完成</li>
<li>避免冗余索引：删除不必要的索引</li>
</ul>
<p><strong>2. 查询语句优化</strong></p>
<p>**避免SELECT ***</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不推荐</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="string">&#x27;active&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 推荐</span></span><br><span class="line"><span class="keyword">SELECT</span> id, name, email <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="string">&#x27;active&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>使用EXISTS代替IN</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不推荐</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> user_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="string">&#x27;active&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 推荐</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders o <span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> users u <span class="keyword">WHERE</span> u.id <span class="operator">=</span> o.user_id <span class="keyword">AND</span> u.status <span class="operator">=</span> <span class="string">&#x27;active&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>避免隐式类型转换</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不推荐（会导致索引失效）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> phone <span class="operator">=</span> <span class="number">13800138000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 推荐</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> phone <span class="operator">=</span> <span class="string">&#x27;13800138000&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>使用LIMIT分页</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 推荐使用游标分页</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders </span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">1000</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> id </span><br><span class="line">LIMIT <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 避免OFFSET分页（大数据量时性能差）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> id </span><br><span class="line">LIMIT <span class="number">20</span> <span class="keyword">OFFSET</span> <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<p><strong>3. 表结构优化</strong></p>
<p><strong>选择合适的数据类型：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不推荐</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">BIGINT</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    age <span class="type">INT</span>,</span><br><span class="line">    created_at DATETIME</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 推荐</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> UNSIGNED AUTO_INCREMENT,  <span class="comment">-- 使用UNSIGNED INT足够</span></span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">100</span>),               <span class="comment">-- 根据实际需求设置长度</span></span><br><span class="line">    age TINYINT UNSIGNED,           <span class="comment">-- 年龄用TINYINT足够</span></span><br><span class="line">    created_at <span class="type">TIMESTAMP</span>             <span class="comment">-- 使用TIMESTAMP节省空间</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>规范化设计：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 避免过度规范化</span></span><br><span class="line"><span class="comment">-- 对于频繁查询的统计信息，可以使用冗余字段</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    user_id <span class="type">INT</span>,</span><br><span class="line">    amount <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">    user_name <span class="type">VARCHAR</span>(<span class="number">100</span>),  <span class="comment">-- 冗余字段，避免JOIN</span></span><br><span class="line">    user_email <span class="type">VARCHAR</span>(<span class="number">100</span>), <span class="comment">-- 冗余字段，避免JOIN</span></span><br><span class="line">    created_at <span class="type">TIMESTAMP</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>4. 分区表优化</strong></p>
<p><strong>按时间分区：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 按月分区</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    user_id <span class="type">INT</span>,</span><br><span class="line">    amount <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span></span><br><span class="line">) <span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">RANGE</span> (<span class="keyword">YEAR</span>(created_at) <span class="operator">*</span> <span class="number">100</span> <span class="operator">+</span> <span class="keyword">MONTH</span>(created_at)) (</span><br><span class="line">    <span class="keyword">PARTITION</span> p202401 <span class="keyword">VALUES</span> LESS THAN (<span class="number">202402</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p202402 <span class="keyword">VALUES</span> LESS THAN (<span class="number">202403</span>),</span><br><span class="line">    <span class="keyword">PARTITION</span> p202403 <span class="keyword">VALUES</span> LESS THAN (<span class="number">202404</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>5. 查询执行计划优化</strong></p>
<p><strong>分析执行计划：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用EXPLAIN分析查询</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> u.name, <span class="built_in">COUNT</span>(o.id) </span><br><span class="line"><span class="keyword">FROM</span> users u </span><br><span class="line"><span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> u.id <span class="operator">=</span> o.user_id </span><br><span class="line"><span class="keyword">WHERE</span> u.status <span class="operator">=</span> <span class="string">&#x27;active&#x27;</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> u.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用EXPLAIN ANALYZE获取详细执行信息</span></span><br><span class="line">EXPLAIN ANALYZE <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;John%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>6. 连接查询优化</strong></p>
<p><strong>优化JOIN顺序：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 小表驱动大表</span></span><br><span class="line"><span class="keyword">SELECT</span> u.name, o.amount </span><br><span class="line"><span class="keyword">FROM</span> users u </span><br><span class="line"><span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> u.id <span class="operator">=</span> o.user_id </span><br><span class="line"><span class="keyword">WHERE</span> u.status <span class="operator">=</span> <span class="string">&#x27;active&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用STRAIGHT_JOIN强制JOIN顺序</span></span><br><span class="line"><span class="keyword">SELECT</span> STRAIGHT_JOIN u.name, o.amount </span><br><span class="line"><span class="keyword">FROM</span> users u </span><br><span class="line"><span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> u.id <span class="operator">=</span> o.user_id;</span><br></pre></td></tr></table></figure>

<p><strong>使用JOIN代替子查询：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不推荐</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> user_id <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> amount <span class="operator">&gt;</span> <span class="number">1000</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 推荐</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> u.<span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> users u </span><br><span class="line"><span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> u.id <span class="operator">=</span> o.user_id </span><br><span class="line"><span class="keyword">WHERE</span> o.amount <span class="operator">&gt;</span> <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<p><strong>7. 批量操作优化</strong></p>
<p><strong>批量插入：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 推荐批量插入</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (name, email, status) <span class="keyword">VALUES</span> </span><br><span class="line">(<span class="string">&#x27;John&#x27;</span>, <span class="string">&#x27;john@example.com&#x27;</span>, <span class="string">&#x27;active&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;Jane&#x27;</span>, <span class="string">&#x27;jane@example.com&#x27;</span>, <span class="string">&#x27;active&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;Bob&#x27;</span>, <span class="string">&#x27;bob@example.com&#x27;</span>, <span class="string">&#x27;inactive&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用LOAD DATA INFILE（MySQL）</span></span><br><span class="line">LOAD DATA INFILE <span class="string">&#x27;/tmp/users.csv&#x27;</span> </span><br><span class="line"><span class="keyword">INTO</span> <span class="keyword">TABLE</span> users </span><br><span class="line">FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> </span><br><span class="line">LINES TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>批量更新：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用CASE WHEN批量更新</span></span><br><span class="line"><span class="keyword">UPDATE</span> users </span><br><span class="line"><span class="keyword">SET</span> status <span class="operator">=</span> <span class="keyword">CASE</span> </span><br><span class="line">    <span class="keyword">WHEN</span> last_login <span class="operator">&lt;</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">30</span> <span class="keyword">DAY</span>) <span class="keyword">THEN</span> <span class="string">&#x27;inactive&#x27;</span></span><br><span class="line">    <span class="keyword">WHEN</span> last_login <span class="operator">&lt;</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">7</span> <span class="keyword">DAY</span>) <span class="keyword">THEN</span> <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">    <span class="keyword">ELSE</span> <span class="string">&#x27;active&#x27;</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<p><strong>8. 缓存优化</strong></p>
<p><strong>应用层缓存：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;users&quot;, key = &quot;#id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.selectById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@CacheEvict(value = &quot;users&quot;, key = &quot;#user.id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        userMapper.updateById(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>数据库查询缓存：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- MySQL查询缓存（已废弃，建议使用应用层缓存）</span></span><br><span class="line"><span class="comment">-- 或使用Redis等外部缓存</span></span><br></pre></td></tr></table></figure>

<p><strong>9. 配置优化</strong></p>
<p><strong>MySQL配置优化：</strong></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="comment"># 缓冲池大小（建议为内存的70-80%）</span></span><br><span class="line"><span class="attr">innodb_buffer_pool_size</span> = <span class="number">4</span>G</span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志文件大小</span></span><br><span class="line"><span class="attr">innodb_log_file_size</span> = <span class="number">256</span>M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接数</span></span><br><span class="line"><span class="attr">max_connections</span> = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询缓存（MySQL 8.0已移除）</span></span><br><span class="line"><span class="comment"># query_cache_size = 128M</span></span><br><span class="line"><span class="comment"># query_cache_type = 1</span></span><br></pre></td></tr></table></figure>

<p><strong>10. 监控和分析</strong></p>
<p><strong>慢查询日志：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 开启慢查询日志</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> long_query_time <span class="operator">=</span> <span class="number">1</span>;               <span class="comment">-- 阈值(秒)</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> log_queries_not_using_indexes <span class="operator">=</span> <span class="number">0</span>; <span class="comment">-- 避免噪音</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log_file <span class="operator">=</span> <span class="string">&#x27;/var/log/mysql/slow.log&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看配置</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;slow_query%&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;long_query_time&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>分析慢日志：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 pt-query-digest 归纳热点 SQL</span></span><br><span class="line">pt-query-digest /var/log/mysql/slow.log &gt; slow-report.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关注：总耗时、95/99 分位、样本、Rows_examined、Full scan、临时表/文件排序</span></span><br></pre></td></tr></table></figure>

<p><strong>关键监控指标：</strong></p>
<ul>
<li>QPS&#x2F;TPS、95&#x2F;99 分位延迟</li>
<li>InnoDB Buffer Pool 命中率、脏页比例、Redo&#x2F;Fsync 频率</li>
<li>Rows_examined&#x2F;Rows_sent 比、临时表&#x2F;文件排序次数</li>
<li>死锁数、锁等待时间、活跃连接数、线程池使用率</li>
</ul>
<p><strong>实战排查顺序：</strong></p>
<ol>
<li>先看系统瓶颈(CPU&#x2F;IO) → 2) 慢日志定位SQL → 3) EXPLAIN&#x2F;ANALYZE → 4) 索引&#x2F;语句&#x2F;结构优化 → 5) 观察指标回归</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">### 17. MyBatis 的查询原理？</span><br><span class="line"></span><br><span class="line">**答案：**</span><br><span class="line">MyBatis 通过将 Mapper 映射为 `MappedStatement`，由执行器 `Executor` 驱动 `StatementHandler / ParameterHandler / ResultSetHandler` 完成 SQL 组装、参数绑定与结果映射，并内置一级/二级缓存与插件拦截链。</span><br><span class="line"></span><br><span class="line">**核心组件与职责：**</span><br><span class="line">- `SqlSessionFactory`/`SqlSession`：会话创建与管理</span><br><span class="line">- `MappedStatement`：一次增删改查的元数据（SQL、参数、返回类型、缓存配置）</span><br><span class="line">- `Executor`：执行器，Simple/Reuse/Batch，负责缓存与查询更新</span><br><span class="line">- `StatementHandler`：预编译、设置参数、执行 SQL</span><br><span class="line">- `ParameterHandler`：参数到 JDBC 的映射</span><br><span class="line">- `ResultSetHandler`：将结果集映射为对象</span><br><span class="line">- `TypeHandler`：Java ↔ JDBC 类型转换</span><br><span class="line">- 插件拦截点：`Executor`、`StatementHandler`、`ParameterHandler`、`ResultSetHandler`</span><br><span class="line"></span><br><span class="line">**执行流程：**</span><br><span class="line">1) 解析 `mybatis-config.xml` 与 Mapper XML，构建 `Configuration`</span><br><span class="line">2) 将每条 `&lt;select|insert|... id&gt;` 解析为 `MappedStatement`</span><br><span class="line">3) `SqlSession.getMapper()` 通过 JDK 动态代理生成 Mapper 代理</span><br><span class="line">4) 调用方法 → 定位 `MappedStatement` → 构建 `BoundSql`（动态 SQL + OGNL）</span><br><span class="line">5) `Executor` 查一级缓存（`localCache`，作用域为 `SqlSession`）</span><br><span class="line">6) 未命中则 `StatementHandler` 预编译、`ParameterHandler` 绑定参数，执行 SQL</span><br><span class="line">7) `ResultSetHandler` 映射结果，写入一级缓存；若配置二级缓存且命中策略允许，则参与二级缓存</span><br><span class="line"></span><br><span class="line">**示例：**</span><br><span class="line">```xml</span><br><span class="line">&lt;!-- UserMapper.xml --&gt;</span><br><span class="line">&lt;mapper namespace=&quot;com.demo.UserMapper&quot;&gt;</span><br><span class="line">  &lt;select id=&quot;selectById&quot; parameterType=&quot;long&quot; resultType=&quot;com.demo.User&quot;&gt;</span><br><span class="line">    SELECT id, name, email FROM t_user WHERE id = #&#123;id&#125;</span><br><span class="line">  &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">  &lt;select id=&quot;listByStatus&quot; resultType=&quot;com.demo.User&quot;&gt;</span><br><span class="line">    SELECT id, name, email FROM t_user</span><br><span class="line">    &lt;where&gt;</span><br><span class="line">      &lt;if test=&quot;status != null&quot;&gt;AND status = #&#123;status&#125;&lt;/if&gt;</span><br><span class="line">      &lt;if test=&quot;name != null&quot;&gt;AND name LIKE CONCAT(&#x27;%&#x27;, #&#123;name&#125;, &#x27;%&#x27;)&lt;/if&gt;</span><br><span class="line">    &lt;/where&gt;</span><br><span class="line">    ORDER BY id DESC</span><br><span class="line">    LIMIT #&#123;limit&#125; OFFSET #&#123;offset&#125;</span><br><span class="line">  &lt;/select&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;cache eviction=&quot;LRU&quot; flushInterval=&quot;600000&quot; size=&quot;512&quot; readOnly=&quot;false&quot;/&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserMapper.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    User <span class="title function_">selectById</span><span class="params">(<span class="type">long</span> id)</span>;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">listByStatus</span><span class="params">(<span class="meta">@Param(&quot;status&quot;)</span> Integer status,</span></span><br><span class="line"><span class="params">                            <span class="meta">@Param(&quot;name&quot;)</span> String name,</span></span><br><span class="line"><span class="params">                            <span class="meta">@Param(&quot;limit&quot;)</span> <span class="type">int</span> limit,</span></span><br><span class="line"><span class="params">                            <span class="meta">@Param(&quot;offset&quot;)</span> <span class="type">int</span> offset)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="18-活跃用户如何定义？"><a href="#18-活跃用户如何定义？" class="headerlink" title="18. 活跃用户如何定义？"></a>18. 活跃用户如何定义？</h3><p><strong>答案：</strong><br>依据业务定义活跃标准，并落到可计算的事件集合上，常见口径：</p>
<ul>
<li>DAU&#x2F;WAU&#x2F;MAU：当日&#x2F;周&#x2F;月内有“有效行为”的去重用户数</li>
<li>Retention：在基准日活跃，且 N 日后仍活跃的比例</li>
<li>有效行为示例：登录、下单、支付、内容发布、停留时长≥X、有效交互≥Y</li>
</ul>
<p><strong>DAU 计算示例（MySQL）：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 以登录/下单/支付等为有效事件</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> user_id) <span class="keyword">AS</span> dau</span><br><span class="line"><span class="keyword">FROM</span> user_events</span><br><span class="line"><span class="keyword">WHERE</span> event_time <span class="operator">&gt;=</span> CURDATE()</span><br><span class="line">  <span class="keyword">AND</span> event_time <span class="operator">&lt;</span>  DATE_ADD(CURDATE(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span>)</span><br><span class="line">  <span class="keyword">AND</span> event_type <span class="keyword">IN</span> (<span class="string">&#x27;login&#x27;</span>,<span class="string">&#x27;order_paid&#x27;</span>,<span class="string">&#x27;publish&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>7 日留存（D0→D7）：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> d0 <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> user_id</span><br><span class="line">  <span class="keyword">FROM</span> user_events</span><br><span class="line">  <span class="keyword">WHERE</span> event_time <span class="operator">&gt;=</span> <span class="string">&#x27;2025-08-01&#x27;</span> <span class="keyword">AND</span> event_time <span class="operator">&lt;</span> <span class="string">&#x27;2025-08-02&#x27;</span></span><br><span class="line">), d7 <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> user_id</span><br><span class="line">  <span class="keyword">FROM</span> user_events</span><br><span class="line">  <span class="keyword">WHERE</span> event_time <span class="operator">&gt;=</span> <span class="string">&#x27;2025-08-08&#x27;</span> <span class="keyword">AND</span> event_time <span class="operator">&lt;</span> <span class="string">&#x27;2025-08-09&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> d0 <span class="keyword">JOIN</span> d7 <span class="keyword">USING</span>(user_id)) <span class="operator">/</span> (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> d0) <span class="keyword">AS</span> retention_7d;</span><br></pre></td></tr></table></figure>

<p><strong>口径落地建议：</strong></p>
<ul>
<li>明确“有效行为”与去重维度（user_id&#x2F;设备&#x2F;账号）</li>
<li>统一时间边界（UTC&#x2F;本地时区、自然日 vs 滚动 24h）</li>
<li>用物化表&#x2F;定时任务沉淀 DAU&#x2F;WAU&#x2F;MAU，供实时看板</li>
</ul>
<hr>
<h3 id="19-有没有关注缓存命中情况？"><a href="#19-有没有关注缓存命中情况？" class="headerlink" title="19. 有没有关注缓存命中情况？"></a>19. 有没有关注缓存命中情况？</h3><p><strong>答案：</strong><br>需要对本地缓存与分布式缓存分别监测，常见指标：命中率、Miss、加载耗时、淘汰&#x2F;过期数、Key 数、内存用量。</p>
<p><strong>Caffeine（本地缓存）：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Cache&lt;String, User&gt; cache = Caffeine.newBuilder()</span><br><span class="line">    .maximumSize(<span class="number">100_000</span>)</span><br><span class="line">    .recordStats()</span><br><span class="line">    .expireAfterWrite(Duration.ofMinutes(<span class="number">10</span>))</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line"><span class="type">CacheStats</span> <span class="variable">stats</span> <span class="operator">=</span> cache.stats();</span><br><span class="line"><span class="type">double</span> <span class="variable">hitRate</span> <span class="operator">=</span> stats.hitRate();</span><br><span class="line"><span class="type">long</span> <span class="variable">evictions</span> <span class="operator">=</span> stats.evictionCount();</span><br></pre></td></tr></table></figure>

<p><strong>Redis（分布式缓存）：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基础命中指标</span></span><br><span class="line">redis-cli INFO stats | egrep <span class="string">&#x27;keyspace_hits|keyspace_misses&#x27;</span></span><br><span class="line"><span class="comment"># 内存与淘汰</span></span><br><span class="line">redis-cli INFO memory | egrep <span class="string">&#x27;used_memory_human|maxmemory_policy&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>Prometheus 监控建议：</strong></p>
<ul>
<li>应用侧暴露：<code>cache_requests_total&#123;result=&quot;hit|miss&quot;&#125;</code>、<code>cache_latency_seconds</code>、<code>cache_evictions_total</code></li>
<li>Redis Exporter：<code>redis_keyspace_hits_total / (hits + misses)</code>、<code>redis_evicted_keys_total</code></li>
</ul>
<p><strong>优化思路：</strong></p>
<ul>
<li>提升命中：热点 Key 预热、恰当 TTL、避免随机 Key（可哈希归一化）</li>
<li>降低穿透：布隆过滤器&#x2F;空值缓存</li>
<li>限制击穿：互斥锁&#x2F;请求合并&#x2F;异步刷新</li>
<li>防雪崩：过期时间加随机抖动、限流与降级策略</li>
</ul>
<hr>
<h3 id="20-Spring-单例管理怎么做的？"><a href="#20-Spring-单例管理怎么做的？" class="headerlink" title="20. Spring 单例管理怎么做的？"></a>20. Spring 单例管理怎么做的？</h3><p><strong>答案：</strong><br>Spring 默认 <code>singleton</code> 作用域，容器内单例。核心由 <code>DefaultListableBeanFactory</code> 管理，三级缓存解决循环依赖：</p>
<ul>
<li><code>singletonObjects</code>（一级）：完全初始化的单例</li>
<li><code>earlySingletonObjects</code>（二级）：提前暴露的单例实例（未增强）</li>
<li><code>singletonFactories</code>（三级）：ObjectFactory，用于创建早期引用（AOP 代理）</li>
</ul>
<p><strong>生命周期（简化）：</strong> 实例化 → 属性填充 → <code>Aware</code> 回调 → <code>BeanPostProcessor</code> before → 初始化 → <code>BeanPostProcessor</code> after → 放入一级缓存</p>
<p><strong>示例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(ConfigurableBeanFactory.SCOPE_SINGLETON)</span> <span class="comment">// 默认即为 singleton</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrototypeTask</span> &#123; &#125;</span><br></pre></td></tr></table></figure>

<p><strong>要点：</strong></p>
<ul>
<li>单例线程安全需业务自行保证（无状态或自行加锁）</li>
<li>原型 Bean 注入单例时如需每次新建，可用 <code>ObjectProvider</code>&#x2F;<code>@Lookup</code></li>
</ul>
<hr>
<h3 id="21-Nacos-特性？"><a href="#21-Nacos-特性？" class="headerlink" title="21. Nacos 特性？"></a>21. Nacos 特性？</h3><p><strong>答案：</strong></p>
<ul>
<li>服务发现与健康检查：临时&#x2F;持久实例、权重、元数据、心跳</li>
<li>配置管理：灰度发布、历史版本、监听推送、命名空间&#x2F;Group</li>
<li>动态 DNS 与服务管理：多环境隔离、权限控制</li>
<li>集群与一致性：AP&#x2F;CP 模式，Raft&#x2F;DB 持久化（视版本&#x2F;模式）</li>
</ul>
<p><strong>Spring Cloud 集成（示例）：</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">order-service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">DEFAULT_GROUP</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConfigController</span> &#123;</span><br><span class="line">  <span class="meta">@Value(&quot;$&#123;order.page.size:20&#125;&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> pageSize;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/cfg&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">cfg</span><span class="params">()</span> &#123; <span class="keyword">return</span> pageSize; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="22-如何实现高性能的分布式配置中心？"><a href="#22-如何实现高性能的分布式配置中心？" class="headerlink" title="22. 如何实现高性能的分布式配置中心？"></a>22. 如何实现高性能的分布式配置中心？</h3><p><strong>答案：</strong><br>设计目标：高可用、低延迟、强&#x2F;最终一致可选、灰度可控、可观测。</p>
<p><strong>核心设计：</strong></p>
<ul>
<li>推送&#x2F;长轮询：客户端与服务端保持长轮询或 SSE&#x2F;WS，配置变更即时下发</li>
<li>客户端本地快照：磁盘 Snapshot 作为降级兜底，启动优先读本地</li>
<li>版本与灰度：版本号 + 灰度规则（按 IP&#x2F;实例&#x2F;标签），可回滚</li>
<li>多级缓存：配置中心内存缓存 → 客户端内存缓存</li>
<li>多租户隔离：Namespace + Group + DataId 三级维度</li>
<li>限流与背压：批量推送、合并通知、客户端指数退避</li>
<li>可观测：发布审计、变更追踪、客户端 ACK 监控、延迟分布</li>
</ul>
<p><strong>客户端长轮询示意：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /v1/cs/configs/listener</span><br><span class="line">Headers: Long-Pulling-Timeout: 30000ms</span><br><span class="line">Body: dataIds=xxx&amp;group=DEFAULT_GROUP&amp;tenant=ns-001&amp;md5=当前本地MD5</span><br><span class="line"><span class="comment"># 服务器比较 MD5，不一致则返回变更列表；一致则阻塞至超时或有变更</span></span><br></pre></td></tr></table></figure>

<p><strong>性能优化要点：</strong></p>
<ul>
<li>Server：分区分片、多副本、读写分离、热点 Key 拆分、批量&#x2F;异步落盘</li>
<li>Client：合并多 DataId 请求、指数退避重试、监听去抖动&#x2F;限频</li>
<li>存储：SSD、顺序写、压缩与合并、冷热分层</li>
<li>网络：HTTP&#x2F;2、连接池、零拷贝</li>
</ul>
<p><strong>落地选型建议：</strong> Nacos&#x2F;Apollo&#x2F;Spring Cloud Config 均可；对强一致&#x2F;审计要求高选 Apollo，对生态一体化与服务发现合并选 Nacos。</p>
<hr>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.picgo.net/2025/06/23/tom09183405464859c2.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.picgo.net/2025/06/23/tom09183405464859c2.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">Joie</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/08/19/%E9%9D%A2%E8%AF%95_%E6%BB%B4%E6%BB%B4/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/08/19/%E9%9D%A2%E8%AF%95_%E6%BB%B4%E6%BB%B4/')">面试_滴滴</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/08/19/%E9%9D%A2%E8%AF%95_%E6%BB%B4%E6%BB%B4/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=面试_滴滴&amp;url=http://example.com/2025/08/19/%E9%9D%A2%E8%AF%95_%E6%BB%B4%E6%BB%B4/&amp;pic=https://origin.picgo.net/2025/08/07/202012111639381648986755c150cff23.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E9%9D%A2%E8%AF%95/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>面试<span class="tagsPageCount">3</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://origin.picgo.net/2025/09/25/asyncabc674a8cbe370a0.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/08/18/%E5%B9%B6%E5%8F%91_io%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/08/18/netty99741d1acc3d52a8.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">I/O多路复用</div></div></a></div><div class="next-post pull-right"><a href="/2025/08/19/Spring_IOC/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/08/21/Springca9e2519d2cfda6d.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Spring IOC</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2025/08/20/%E9%9D%A2%E8%AF%95_8_20/" title="面试_8_20"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/08/07/202012111639381648986755c150cff23.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-08-20</div><div class="title">面试_8_20</div></div></a></div><div><a href="/2025/08/18/%E9%9D%A2%E8%AF%95_%E9%AB%98%E5%BE%B7/" title="面试_高德"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/08/07/202012111639381648986755c150cff23.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-08-18</div><div class="title">面试_高德</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.picgo.net/2025/06/23/tom09183405464859c2.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Joie</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/BenedictTom" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/372204786" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%E4%B8%8E%E7%AD%94%E6%A1%88"><span class="toc-number">1.</span> <span class="toc-text">面试问题与答案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Java-%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.</span> <span class="toc-text">1. Java 优先队列的实现原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">2. Redis分布式锁原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%A6%82%E4%BD%95%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="toc-number">1.3.</span> <span class="toc-text">3. 如何用数据库实现一个分布式锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-ThreadLocal-%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%8C%E5%8E%9F%E7%90%86%EF%BC%9F"><span class="toc-number">1.4.</span> <span class="toc-text">4. ThreadLocal 的数据结构，原理？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-ThreadLocal-%E5%A6%82%E4%BD%95%E8%B7%A8%E7%BA%BF%E7%A8%8B%E9%80%9A%E4%BF%A1"><span class="toc-number">1.5.</span> <span class="toc-text">5. ThreadLocal 如何跨线程通信</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-MQ-%E6%95%B0%E6%8D%AE%E6%98%AF%E6%80%8E%E4%B9%88%E5%AD%98%E5%82%A8%E7%9A%84%EF%BC%9F"><span class="toc-number">1.6.</span> <span class="toc-text">6. MQ 数据是怎么存储的？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E6%B6%88%E8%B4%B9%E8%80%85%E5%A6%82%E4%BD%95%E6%B6%88%E8%B4%B9MQ-%E4%B8%AD%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%9F"><span class="toc-number">1.7.</span> <span class="toc-text">7. 消费者如何消费MQ 中的消息？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.8.</span> <span class="toc-text">8. 线程池参数详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E9%98%9F%E5%88%97%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E5%BE%80%E9%87%8C%E5%8A%A0%E5%85%83%E7%B4%A0%EF%BC%9F"><span class="toc-number">1.9.</span> <span class="toc-text">9. 线程池队列什么时候往里加元素？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-Spring-Boot-%E5%92%8C-Spring-Cloud-%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-number">1.10.</span> <span class="toc-text">10. Spring Boot 和 Spring Cloud 的区别？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%EF%BC%9F"><span class="toc-number">1.11.</span> <span class="toc-text">11. 类加载机制？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-JVM-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6%EF%BC%9F"><span class="toc-number">1.12.</span> <span class="toc-text">12. JVM 垃圾回收机制？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-HashMap-%E5%8E%9F%E7%90%86"><span class="toc-number">1.13.</span> <span class="toc-text">13. HashMap 原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-ConcurrentHashMap-%E5%8E%9F%E7%90%86"><span class="toc-number">1.14.</span> <span class="toc-text">14. ConcurrentHashMap 原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-%E8%AF%A6%E7%BB%86%E8%AE%B2%E4%B8%80%E4%B8%8B%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%80%8E%E4%B9%88%E7%94%A8%E7%9A%84%EF%BC%9F"><span class="toc-number">1.15.</span> <span class="toc-text">15. 详细讲一下大模型怎么用的？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-SQL-%E4%BC%98%E5%8C%96%E6%96%B9%E5%BC%8F%EF%BC%9F%E8%B6%8A%E8%AF%A6%E7%BB%86%E8%B6%8A%E5%A5%BD"><span class="toc-number">1.16.</span> <span class="toc-text">16. SQL 优化方式？越详细越好</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-%E6%B4%BB%E8%B7%83%E7%94%A8%E6%88%B7%E5%A6%82%E4%BD%95%E5%AE%9A%E4%B9%89%EF%BC%9F"><span class="toc-number">1.17.</span> <span class="toc-text">18. 活跃用户如何定义？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#19-%E6%9C%89%E6%B2%A1%E6%9C%89%E5%85%B3%E6%B3%A8%E7%BC%93%E5%AD%98%E5%91%BD%E4%B8%AD%E6%83%85%E5%86%B5%EF%BC%9F"><span class="toc-number">1.18.</span> <span class="toc-text">19. 有没有关注缓存命中情况？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#20-Spring-%E5%8D%95%E4%BE%8B%E7%AE%A1%E7%90%86%E6%80%8E%E4%B9%88%E5%81%9A%E7%9A%84%EF%BC%9F"><span class="toc-number">1.19.</span> <span class="toc-text">20. Spring 单例管理怎么做的？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#21-Nacos-%E7%89%B9%E6%80%A7%EF%BC%9F"><span class="toc-number">1.20.</span> <span class="toc-text">21. Nacos 特性？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%EF%BC%9F"><span class="toc-number">1.21.</span> <span class="toc-text">22. 如何实现高性能的分布式配置中心？</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/09/25/Spring_Async/" title="Spring Async 异步编程详解"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/09/25/asyncabc674a8cbe370a0.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring Async 异步编程详解"/></a><div class="content"><a class="title" href="/2025/09/25/Spring_Async/" title="Spring Async 异步编程详解">Spring Async 异步编程详解</a><time datetime="2025-09-25T02:57:07.010Z" title="Created 2025-09-25 10:57:07">2025-09-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/23/%E9%9D%A2%E8%AF%95%E8%AE%B0%E5%BD%95_2020_9_23/" title="面试记录_2025_6_27"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/08/07/202012111639381648986755c150cff23.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="面试记录_2025_6_27"/></a><div class="content"><a class="title" href="/2025/09/23/%E9%9D%A2%E8%AF%95%E8%AE%B0%E5%BD%95_2020_9_23/" title="面试记录_2025_6_27">面试记录_2025_6_27</a><time datetime="2025-09-23T01:35:50.929Z" title="Created 2025-09-23 09:35:50">2025-09-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/21/Python_%E8%A3%85%E9%A5%B0%E5%99%A8/" title="Python装饰器"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/09/25/deco4918756a582fd2b8.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python装饰器"/></a><div class="content"><a class="title" href="/2025/09/21/Python_%E8%A3%85%E9%A5%B0%E5%99%A8/" title="Python装饰器">Python装饰器</a><time datetime="2025-09-20T16:00:33.502Z" title="Created 2025-09-21 00:00:33">2025-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/20/Java_%E6%B3%A8%E8%A7%A3/" title="Java注解"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/09/25/Java_programming_language-Logo.wine1fede47ef64618a5.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java注解"/></a><div class="content"><a class="title" href="/2025/09/20/Java_%E6%B3%A8%E8%A7%A3/" title="Java注解">Java注解</a><time datetime="2025-09-20T15:35:27.683Z" title="Created 2025-09-20 23:35:27">2025-09-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/16/PERFORMANCE_OPTIMIZATION(1)/" title="接口梳理"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/08/12/springdoc1a22b69dff6426b8.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="接口梳理"/></a><div class="content"><a class="title" href="/2025/09/16/PERFORMANCE_OPTIMIZATION(1)/" title="接口梳理">接口梳理</a><time datetime="2025-09-16T10:37:00.995Z" title="Created 2025-09-16 18:37:00">2025-09-16</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><div id="runtimeTextTip"></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 By <a class="footer-bar-link" href="/" title="Joie" target="_blank">Joie</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = []
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">Articles</div><div class="length-num">90</div></a><a href="/tags/" title="tag"><div class="headline">Tags</div><div class="length-num">40</div></a><a href="/categories/" title="category"><div class="headline">Categories</div><div class="length-num">29</div></a></div><span class="sidebar-menu-item-title">Function</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="Display Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>Display Mode</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">个人主页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://benedicttom.github.io/home/" title="个人主页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="个人主页"/><span class="back-menu-item-text">个人主页</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AMQP/" style="font-size: 0.88rem;">AMQP<sup>1</sup></a><a href="/tags/CI-CD/" style="font-size: 0.88rem;">CI/CD<sup>1</sup></a><a href="/tags/ElasticSearch/" style="font-size: 0.88rem;">ElasticSearch<sup>3</sup></a><a href="/tags/Hexo/" style="font-size: 0.88rem;">Hexo<sup>1</sup></a><a href="/tags/Http/" style="font-size: 0.88rem;">Http<sup>2</sup></a><a href="/tags/I-O/" style="font-size: 0.88rem;">I/O<sup>2</sup></a><a href="/tags/Java/" style="font-size: 0.88rem;">Java<sup>9</sup></a><a href="/tags/MongoDB/" style="font-size: 0.88rem;">MongoDB<sup>1</sup></a><a href="/tags/Mysql/" style="font-size: 0.88rem;">Mysql<sup>2</sup></a><a href="/tags/ORM/" style="font-size: 0.88rem;">ORM<sup>3</sup></a><a href="/tags/Python/" style="font-size: 0.88rem;">Python<sup>5</sup></a><a href="/tags/Redis/" style="font-size: 0.88rem;">Redis<sup>6</sup></a><a href="/tags/Redisson/" style="font-size: 0.88rem;">Redisson<sup>1</sup></a><a href="/tags/Rpc/" style="font-size: 0.88rem;">Rpc<sup>2</sup></a><a href="/tags/Spring/" style="font-size: 0.88rem;">Spring<sup>3</sup></a><a href="/tags/Spring-Cloud/" style="font-size: 0.88rem;">Spring Cloud<sup>5</sup></a><a href="/tags/Spring-Data/" style="font-size: 0.88rem;">Spring Data<sup>5</sup></a><a href="/tags/Swagger/" style="font-size: 0.88rem;">Swagger<sup>2</sup></a><a href="/tags/%E4%B8%9A%E5%8A%A1/" style="font-size: 0.88rem;">业务<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 0.88rem;">云原生<sup>1</sup></a><a href="/tags/%E5%85%AB%E8%82%A1/" style="font-size: 0.88rem;">八股<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" style="font-size: 0.88rem;">分布式锁<sup>1</sup></a><a href="/tags/%E5%8A%9B%E6%89%A3/" style="font-size: 0.88rem;">力扣<sup>10</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 0.88rem;">多线程<sup>9</sup></a><a href="/tags/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/" style="font-size: 0.88rem;">定时任务<sup>3</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 0.88rem;">并发<sup>9</sup></a><a href="/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" style="font-size: 0.88rem;">开发工具<sup>2</sup></a><a href="/tags/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/" style="font-size: 0.88rem;">异步编程<sup>1</sup></a><a href="/tags/%E6%8E%A8%E8%8D%90/" style="font-size: 0.88rem;">推荐<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 0.88rem;">数据结构<sup>5</sup></a><a href="/tags/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C/" style="font-size: 0.88rem;">权限校验<sup>4</sup></a><a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 0.88rem;">架构<sup>1</sup></a><a href="/tags/%E6%A0%91/" style="font-size: 0.88rem;">树<sup>1</sup></a><a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 0.88rem;">消息队列<sup>5</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">算法<sup>1</sup></a><a href="/tags/%E7%BC%93%E5%AD%98/" style="font-size: 0.88rem;">缓存<sup>4</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 0.88rem;">设计模式<sup>1</sup></a><a href="/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 0.88rem;">运维<sup>2</sup></a><a href="/tags/%E9%9B%86%E5%90%88/" style="font-size: 0.88rem;">集合<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 0.88rem;">面试<sup>3</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2025 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2025 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Joie 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("04/01/2025 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "";
        img.title = "";
        img.alt = "";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>