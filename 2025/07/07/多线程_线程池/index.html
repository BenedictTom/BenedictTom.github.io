<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>多线程_线程池 | Joie's Blog</title><meta name="keywords" content="多线程,并发"><meta name="author" content="Joie"><meta name="copyright" content="Joie"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="多线程_线程池"><meta name="application-name" content="多线程_线程池"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="多线程_线程池"><meta property="og:url" content="http://example.com/2025/07/07/%E5%A4%9A%E7%BA%BF%E7%A8%8B_%E7%BA%BF%E7%A8%8B%E6%B1%A0/index.html"><meta property="og:site_name" content="Joie's Blog"><meta property="og:description" content="Java 线程池与 Executor 框架全解析多线程编程是高性能 Java 应用的基石，而线程池则是高效管理线程资源、提升并发性能的核心工具。本文将系统梳理 Java 线程池相关知识，涵盖原理、接口、实现、调优、典型场景与面试要点，助你彻底掌握并发利器。  目录 线程池的意义与优势 Executo"><meta property="og:locale" content="en"><meta property="og:image" content="https://img.picgo.net/2025/07/07/6c4064c88ff621702204e7fe46a464266ce0015884687e07.png"><meta property="article:author" content="Joie"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://img.picgo.net/2025/07/07/6c4064c88ff621702204e7fe46a464266ce0015884687e07.png"><meta name="description" content="Java 线程池与 Executor 框架全解析多线程编程是高性能 Java 应用的基石，而线程池则是高效管理线程资源、提升并发性能的核心工具。本文将系统梳理 Java 线程池相关知识，涵盖原理、接口、实现、调优、典型场景与面试要点，助你彻底掌握并发利器。  目录 线程池的意义与优势 Executo"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/07/07/%E5%A4%9A%E7%BA%BF%E7%A8%8B_%E7%BA%BF%E7%A8%8B%E6%B1%A0/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"Here","backTitle":"Welcome"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":"api","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"Author: Joie","link":"Link: ","source":"Source: Joie's Blog","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.","copySuccess":"Copy success, copy and reprint please mark the address of this article"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Joie\'s Blog',
  title: '多线程_线程池',
  postAI: '',
  pageFillDescription: 'Java 线程池与 Executor 框架全解析, 目录, 线程池的意义与优势, Executor 框架概览, 核心接口与实现类, 1. Executor, 2. ExecutorService, 3. ScheduledExecutorService, 4. 主要实现类, 线程池的创建与使用, 1. Executors 工具类, 2. 线程池的基本用法, ThreadPoolExecutor 深入解析, 1. 构造参数, 2. 线程池运行流程, 3. 任务队列类型, 4. 拒绝策略, 5. 线程池监控与管理, 线程池参数调优建议, 典型应用场景, 常见面试问题, 小结与注意事项, 自定义线程池的实现（优化版）, 2. 重试策略（RetryPolicy）, 3. 降级策略（FallbackPolicy）, 拒绝策略选择建议, 1. 根据业务重要性选择, 2. 根据系统负载选择, 3. 根据监控需求选择, 最佳实践, 监控指标, Fork x2F Join, 核心组件, 工作流程, 示例代码, 特点与优势, 1. 线程池的工作原理？, 2. ThreadPoolExecutor 各参数含义及调优建议？, 3. 线程池的拒绝策略有哪些？适用场景？, 4. Executors 工厂方法的风险？为什么生产不推荐？, 5. 如何优雅关闭线程池？, 6. 线程池如何防止 OOM？, 7. 线程池监控与调优实践？, 8. 线程池与 ForkJoinPool 区别？, 总结线程池与框架全解析多线程编程是高性能应用的基石而线程池则是高效管理线程资源提升并发性能的核心工具本文将系统梳理线程池相关知识涵盖原理接口实现调优典型场景与面试要点助你彻底掌握并发利器目录线程池的意义与优势框架概览核心接口与实现类线程池的创建与使用深入解析线程池参数调优建议典型应用场景常见面试问题小结与注意事项线程池的意义与优势资源复用线程池通过复用已创建的线程避免频繁创建销毁线程带来的性能损耗统一管理集中管理线程生命周期便于监控和调优任务调度支持任务排队定时周期执行批量处理等高级功能防止资源耗尽通过限制最大线程数防止系统因过多线程而崩溃提升响应速度任务无需等待新线程创建直接复用空闲线程框架概览的框架包实现了任务提交与执行的解耦极大简化了并发编程其核心思想是提交任务由线程池统一调度和执行核心接口与实现类最基础接口定义了用于提交任务但不关心执行细节扩展了支持任务提交任务取消结果获取批量任务处理线程池关闭与状态管理支持定时周期性任务调度主要实现类最常用的线程池实现支持灵活参数配置支持定时周期任务适合递归分治并行计算场景线程池的创建与使用工具类提供多种便捷工厂方法方法说明固定大小线程池单线程池顺序执行可伸缩线程池适合大量短任务定时周期任务线程池工作窃取线程池示例建议生产环境优先使用显式配置参数避免默认策略带来的风险如线程池的基本用法提交任务获取结果关闭线程池示例深入解析是线程池的核心实现支持高度自定义构造参数核心线程数最大线程数非核心线程空闲存活时间时间单位任务队列线程工厂拒绝策略线程池运行流程任务提交到线程池若运行线程数直接创建新线程执行否则任务进入队列等待若队列满且线程数创建新线程执行若队列满且线程数已达最大触发拒绝策略任务队列类型有界数组队列常用无界链表队列默认不存储任务直接交给线程优先级队列拒绝策略默认抛出异常由提交任务的线程执行直接丢弃丢弃队列最老任务尝试执行新任务线程池监控与管理当前线程数活跃线程数已完成任务数预启动所有核心线程示例线程池参数调优建议核心线程数密集型核心数密集型核心数最大线程数根据业务并发量和硬件资源合理设置队列类型与长度有界队列防止无界队列需谨慎拒绝策略根据业务容忍度选择推荐自定义日志报警线程工厂自定义线程名便于排查问题监控与报警定期监控线程池状态及时发现异常典型应用场景服务器请求处理批量数据处理日志异步写入定时周期性任务调度并行计算分治任务常见面试问题线程池的工作原理各参数含义及调优建议线程池的拒绝策略有哪些适用场景工厂方法的风险为什么生产不推荐如何优雅关闭线程池线程池如何防止线程池监控与调优实践线程池与区别小结与注意事项线程池是高并发系统的基础设施合理配置至关重要推荐优先使用显式配置参数关注线程池监控与异常处理防止资源泄漏和结合实际业务场景选择合适的线程池类型与参数自定义线程池的实现优化版测试不同的拒绝策略测试拒绝策略测试默认策略测试抛出异常测试测试调用者运行测试测试直接丢弃测试测试丢弃最老任务创建一个小容量的线程池来触发拒绝策略提交多个任务超过线程池容量执行任务模拟长时间任务等待一段时间观察结果异常拒绝策略接口处理被拒绝的任务被拒绝的任务线程池实例默认拒绝策略抛出异常任务被拒绝执行线程池已满调用者运行策略由提交任务的线程执行任务被拒绝由调用者线程执行直接丢弃策略静默丢弃任务任务被直接丢弃什么都不做直接丢弃丢弃最老任务策略丢弃队列中最老的任务然后尝试执行新任务尝试丢弃最老任务并执行新任务尝试从队列中移除最老的任务丢弃了最老的任务尝试将新任务放入队列放入新任务时被中断自定义拒绝执行异常自定义拒绝策略记录日志并发送告警线程池任务被拒绝当前活跃线程数队列大小记录错误日志模拟发送告警可以选择抛出异常或静默处理这里可以实现具体的告警逻辑如发送邮件短信钉钉等发送告警自定义拒绝策略重试策略任务被拒绝尝试重试重新尝试提交任务重试成功任务已重新加入队列重试失败抛出异常任务重试次后仍然被拒绝自定义拒绝策略降级策略任务被拒绝执行降级策略执行降级任务降级任务执行失败测试自定义拒绝策略测试自定义拒绝策略测试日志告警策略测试日志告警策略测试重试策略测试重试策略测试降级策略测试降级策略测试线程池执行任务捕获异常执行任务捕获异常执行降级任务执行任务捕获异常参数必须大于拒绝策略不能为执行任务任务不能为线程池已关闭如果当前线程数小于核心线程数创建新线程新增线程当前数量尝试将任务放入队列队列已满触发拒绝策略队列已满触发拒绝策略任务加入等待队列当前队列大小关闭线程池正在关闭线程池获取当前活跃线程数获取队列中的任务数检查线程池是否已关闭获取工作队列用于拒绝策略线程类执行第一个任务循环执行队列中的任务线程池已关闭且队列为空退出循环线程被中断正常退出从集合中移除自己线程退出当前活跃线程数任务执行异常线程安全的阻塞队列容量必须大于带超时的获取元素阻塞获取元素阻塞添加元素元素不能为非阻塞添加元素元素不能为获取队列大小检查队列是否为空检查队列是否已满拒绝策略详解什么是拒绝策略拒绝策略是线程池中处理任务被拒绝执行时的策略当线程池和任务队列都满时新提交的任务会被拒绝此时需要根据业务需求选择合适的处理方式内置拒绝策略默认策略行为抛出异常适用场景需要明确知道任务被拒绝的情况优点能够及时发现线程池负载过高的问题缺点可能导致调用方异常需要额外的异常处理行为由提交任务的线程执行被拒绝的任务适用场景对任务执行时间不敏感希望降低提交速度优点能够自动调节提交速度防止系统过载缺点可能阻塞调用方线程行为静默丢弃被拒绝的任务适用场景任务可以被丢弃不重要的任务优点不会影响系统稳定性缺点任务丢失可能影响业务逻辑行为丢弃队列中最老的任务然后尝试执行新任务适用场景新任务比老任务更重要优点保证新任务能够执行缺点可能丢失重要的老任务自定义拒绝策略日志告警策略使用示例订单处理线程池特点记录详细日志并发送告警适用场景生产环境监控需要及时发现问题重试策略使用示例重试次每次间隔秒特点自动重试被拒绝的任务适用场景任务比较重要可以接受延迟执行降级策略使用示例执行降级逻辑特点执行降级任务替代被拒绝的任务适用场景有备选方案保证系统可用性拒绝策略选择建议根据业务重要性选择关键业务使用或自定义重试策略一般业务使用或非关键业务使用根据系统负载选择高负载系统使用自动调节稳定负载系统使用及时发现问题突发负载系统使用保证新任务根据监控需求选择需要监控使用自定义日志告警策略简单监控使用配合异常监控无需监控使用最佳实践生产环境推荐使用自定义日志告警策略及时发现问题开发环境推荐使用便于调试测试环境推荐使用模拟真实负载监控告警配合线程池监控设置合理的告警阈值参数调优根据拒绝策略的执行情况调整线程池参数监控指标拒绝次数统计任务被拒绝的次数拒绝率拒绝次数总提交次数队列使用率当前队列大小队列容量线程使用率活跃线程数最大线程数通过这些指标可以及时发现线程池配置问题进行相应的调优框架是引入的一个并行编程框架旨在帮助开发者更方便地编写高效可扩展的并行程序它基于分治法策略将一个大任务递归分解为多个小任务并行执行然后合并这些小任务的结果以得到最终结果框架特别适合于那些可以被分解成许多相似的小任务并且这些小任务之间几乎没有依赖关系的情况核心组件这是框架的核心执行引擎类似于线程池它管理着工作窃取算法下的工作线程集合每个工作线程都维护着自己的双端队列用于存储待执行的任务这是一个抽象类代表了可以在中执行的任务所有的任务都需要继承自这个类或者其子类适用于不需要返回结果的任务适用于需要返回结果的任务这是一种分配任务的方法当某个线程完成了自己中的所有任务后它可以尝试从其他线程的的尾部偷取任务来执行从而提高了资源利用率和负载均衡工作流程任务开始时如果当前任务规模足够小则直接计算否则将其分割为两个或更多的子任务并对每个子任务调用方法异步执行对于每个已经出去的子任务父任务会调用方法等待子任务完成并获取其结果注意不会阻塞线程除非当前线程没有其他任务可做合并结果一旦所有子任务都完成了父任务就会合并它们的结果生成最终结果示例代码这里有一个简单的例子展示了如何使用来计算数组中元素的总和阈值决定是否继续拆分任务分别启动子任务合并结果初始化你的数据特点与优势高效性通过工作窃取算法有效地利用多核处理器的能力减少了线程间的竞争灵活性可以轻松处理各种类型的并行问题特别是那些可以通过分治法解决的问题易用性简化了并行程序的编写过程使得开发人员无需手动管理线程同步等复杂问题好的我们来系统性地回答关于线程池的这八大核心问题线程池的工作原理线程池的核心思想是池化预先创建一组可重用的线程避免频繁创建和销毁线程带来的性能开销工作流程提交任务客户端调用或提交任务判断核心线程如果当前线程数核心线程数即使有空闲线程也会创建新线程来执行任务如果当前线程数进入下一步尝试入队将任务放入工作队列如果入队成功任务在队列中等待如果入队失败队列已满进入下一步判断最大线程数如果当前线程数最大线程数则创建非核心线程来执行这个新任务如果当前线程数进入下一步执行拒绝策略触发拒绝策略如抛出异常丢弃任务等简单记忆核心线程不够入队队列满创建非核心线程还不够拒绝各参数含义及调优建议参数含义调优建议核心线程数这些线程会一直存活除非设置了密集型任务为核心数密集型任务或更高因为线程常阻塞最大线程数线程池允许创建的线程总数上限通常设置为的倍用于应对突发流量需结合系统资源内存文件句柄等设置非核心线程的空闲存活时间超过的线程在空闲超过此时间后会被回收一般设置为秒如果希望核心线程也能回收可设置的时间单位如根据业务需求选择工作队列用于存放待执行的任务推荐有界队列如防止避免使用无界队列如默认的线程工厂用于创建新线程可以自定义线程名称优先级是否为守护线程等强烈建议自定义为线程命名如便于日志追踪和问题排查拒绝策略当线程池无法处理新任务时的处理策略根据业务选择合适的策略见问题线程池的拒绝策略有哪些适用场景拒绝策略类名行为适用场景中止策略默认抛出异常对数据一致性要求高宁愿失败也不愿丢失或延迟系统设计应能处理此异常调用者运行策略由提交任务的线程即调用者线程自己来执行该任务适用于非关键任务可以接受任务执行变慢能起到背压作用减缓任务提交速度丢弃策略静默丢弃新提交的任务不抛异常适用于可丢失任务的场景如日志收集监控数据上报丢弃最旧策略丢弃队列中最老的一个任务即将被执行的那个然后尝试提交新任务适用于实时性要求高的场景如消息推送宁愿丢旧消息也不愿队列积压工厂方法的风险为什么生产不推荐提供了便捷的工厂方法但在生产环境中应避免直接使用原因如下工厂方法风险详细说明使用无界队列内部使用容量如果任务处理速度跟不上提交速度队列会无限增长最终导致线程数无上限在高并发下可能创建海量线程耗尽系统资源内存文件句柄等导致系统崩溃使用无界队列同存在风险正确做法直接使用构造函数显式指定所有参数尤其是使用有界队列和合理的线程数上限如何优雅关闭线程池目标是停止接收新任务并等待已提交的任务执行完毕停止接收新任务等待任务完成推荐设置超时超时后强制关闭中断正在执行的任务再次等待确保任务响应中断线程池未能正常关闭当前线程被中断也强制关闭关键方法平滑关闭不再接收新任务但会执行完队列中的任务立即关闭尝试中断所有正在执行的任务并返回队列中未处理的任务阻塞等待线程池关闭或超时线程池如何防止使用有界队列如明确限制队列大小合理设置线程数避免过大防止创建过多线程耗尽内存配置合适的拒绝策略当资源紧张时通过拒绝策略如快速失败而不是让任务无限堆积监控队列大小实时监控及时发现积压避免任务内存泄漏确保任务本身不会持有大对象或导致内存泄漏线程池监控与调优实践监控指标可通过或自定义监控当前线程数正在执行任务的线程数队列中的任务数已完成任务数曾达到的最大线程数调优实践压力测试模拟生产流量观察监控指标调整参数如果经常很大增加或或优化任务处理速度如果接近说明线程池在频繁扩容可能需要增加如果频繁触发拒绝策略需要增加线程数队列大小或优化业务逻辑动态调优高级场景下可实现动态调整线程池参数如线程池与区别特性设计目的通用任务执行分治算法如递归并行流任务模型有返回值无返回值工作窃取不支持核心特性空闲线程会从其他线程的队列尾部窃取任务提高利用率适用场景任务定时任务通用异步处理密集型可分解的计算任务如归并排序矩阵运算大数据处理创建方式显式构造或公共池或自定义构造默认线程数方法有不同默认线程数为简单说普通线程池适合处理独立的不可分割的任务适合处理一个大任务可以拆分成多个小任务并行执行最后合并结果的场景利用工作窃取机制高效利用多核总结线程池是并发编程的基石掌握其原理参数调优拒绝策略关闭方式和监控方法是构建高性能高可用服务的必备技能记住避免使用的快捷方法优先使用自定义有界线程池这是生产环境的最佳实践参考资料并发编程实战深入理解虚拟机官方文档太完整了这是我见过最详细的线程池讲解了线程池工作流程',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-09-02 14:00:51',
  postMainColor: '#5393E3',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://img.picgo.net/2025/06/23/tom09183405464859c2.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">个人主页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://benedicttom.github.io/home/" title="个人主页"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="个人主页"/><span class="back-menu-item-text">个人主页</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">Joie's Blog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> Newest Comments</span></div><div class="aside-list"><span>loading...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI/" style="font-size: 1.05rem;">AI<sup>1</sup></a><a href="/tags/AMQP/" style="font-size: 1.05rem;">AMQP<sup>1</sup></a><a href="/tags/CI-CD/" style="font-size: 1.05rem;">CI/CD<sup>1</sup></a><a href="/tags/ElasticSearch/" style="font-size: 1.05rem;">ElasticSearch<sup>3</sup></a><a href="/tags/Hexo/" style="font-size: 1.05rem;">Hexo<sup>1</sup></a><a href="/tags/Http/" style="font-size: 1.05rem;">Http<sup>2</sup></a><a href="/tags/I-O/" style="font-size: 1.05rem;">I/O<sup>2</sup></a><a href="/tags/Java/" style="font-size: 1.05rem;">Java<sup>10</sup></a><a href="/tags/K8S/" style="font-size: 1.05rem;">K8S<sup>1</sup></a><a href="/tags/MongoDB/" style="font-size: 1.05rem;">MongoDB<sup>1</sup></a><a href="/tags/Mysql/" style="font-size: 1.05rem;">Mysql<sup>2</sup></a><a href="/tags/ORM/" style="font-size: 1.05rem;">ORM<sup>3</sup></a><a href="/tags/Python/" style="font-size: 1.05rem;">Python<sup>5</sup></a><a href="/tags/Redis/" style="font-size: 1.05rem;">Redis<sup>7</sup></a><a href="/tags/Redisson/" style="font-size: 1.05rem;">Redisson<sup>1</sup></a><a href="/tags/Rpc/" style="font-size: 1.05rem;">Rpc<sup>2</sup></a><a href="/tags/Spring/" style="font-size: 1.05rem;">Spring<sup>3</sup></a><a href="/tags/Spring-Cloud/" style="font-size: 1.05rem;">Spring Cloud<sup>5</sup></a><a href="/tags/Spring-Data/" style="font-size: 1.05rem;">Spring Data<sup>5</sup></a><a href="/tags/Swagger/" style="font-size: 1.05rem;">Swagger<sup>1</sup></a><a href="/tags/http/" style="font-size: 1.05rem;">http<sup>1</sup></a><a href="/tags/%E4%B8%9A%E5%8A%A1/" style="font-size: 1.05rem;">业务<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 1.05rem;">云原生<sup>1</sup></a><a href="/tags/%E5%85%AB%E8%82%A1/" style="font-size: 1.05rem;">八股<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" style="font-size: 1.05rem;">分布式锁<sup>1</sup></a><a href="/tags/%E5%8A%9B%E6%89%A3/" style="font-size: 1.05rem;">力扣<sup>10</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 1.05rem;">多线程<sup>9</sup></a><a href="/tags/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/" style="font-size: 1.05rem;">定时任务<sup>3</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 1.05rem;">并发<sup>10</sup></a><a href="/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" style="font-size: 1.05rem;">开发工具<sup>2</sup></a><a href="/tags/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/" style="font-size: 1.05rem;">异步编程<sup>1</sup></a><a href="/tags/%E6%8E%A8%E8%8D%90/" style="font-size: 1.05rem;">推荐<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 1.05rem;">数据结构<sup>1</sup></a><a href="/tags/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C/" style="font-size: 1.05rem;">权限校验<sup>4</sup></a><a href="/tags/%E6%A0%91/" style="font-size: 1.05rem;">树<sup>1</sup></a><a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 1.05rem;">消息队列<sup>5</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">算法<sup>2</sup></a><a href="/tags/%E7%BC%93%E5%AD%98/" style="font-size: 1.05rem;">缓存<sup>3</sup></a><a href="/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 1.05rem;">运维<sup>2</sup></a><a href="/tags/%E9%9B%86%E5%90%88/" style="font-size: 1.05rem;">集合<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>Archives</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/11/"><span class="card-archive-list-date">November 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/10/"><span class="card-archive-list-date">October 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">September 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/08/"><span class="card-archive-list-date">August 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">46</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">July 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">28</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">June 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%B9%B6%E5%8F%91/" itemprop="url">并发</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>多线程</span></a><a class="article-meta__tags" href="/tags/%E5%B9%B6%E5%8F%91/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>并发</span></a></span></div></div><h1 class="post-title" itemprop="name headline">多线程_线程池</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-07-07T12:53:21.228Z" title="Created 2025-07-07 20:53:21">2025-07-07</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-09-02T06:00:51.409Z" title="Updated 2025-09-02 14:00:51">2025-09-02</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为北京"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>北京</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://img.picgo.net/2025/07/07/6c4064c88ff621702204e7fe46a464266ce0015884687e07.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/07/07/%E5%A4%9A%E7%BA%BF%E7%A8%8B_%E7%BA%BF%E7%A8%8B%E6%B1%A0/"><header><a class="post-meta-categories" href="/categories/%E5%B9%B6%E5%8F%91/" itemprop="url">并发</a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" tabindex="-1" itemprop="url">多线程</a><a href="/tags/%E5%B9%B6%E5%8F%91/" tabindex="-1" itemprop="url">并发</a><h1 id="CrawlerTitle" itemprop="name headline">多线程_线程池</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Joie</span><time itemprop="dateCreated datePublished" datetime="2025-07-07T12:53:21.228Z" title="Created 2025-07-07 20:53:21">2025-07-07</time><time itemprop="dateCreated datePublished" datetime="2025-09-02T06:00:51.409Z" title="Updated 2025-09-02 14:00:51">2025-09-02</time></header><h1 id="Java-线程池与-Executor-框架全解析"><a href="#Java-线程池与-Executor-框架全解析" class="headerlink" title="Java 线程池与 Executor 框架全解析"></a>Java 线程池与 Executor 框架全解析</h1><p>多线程编程是高性能 Java 应用的基石，而线程池则是高效管理线程资源、提升并发性能的核心工具。本文将系统梳理 Java 线程池相关知识，涵盖原理、接口、实现、调优、典型场景与面试要点，助你彻底掌握并发利器。</p>
<hr>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol>
<li><a href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%84%8F%E4%B9%89%E4%B8%8E%E4%BC%98%E5%8A%BF">线程池的意义与优势</a></li>
<li><a href="#executor-%E6%A1%86%E6%9E%B6%E6%A6%82%E8%A7%88">Executor 框架概览</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E6%8E%A5%E5%8F%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0%E7%B1%BB">核心接口与实现类</a></li>
<li><a href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8">线程池的创建与使用</a></li>
<li><a href="#threadpoolexecutor-%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90">ThreadPoolExecutor 深入解析</a></li>
<li><a href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%8F%82%E6%95%B0%E8%B0%83%E4%BC%98%E5%BB%BA%E8%AE%AE">线程池参数调优建议</a></li>
<li><a href="#%E5%85%B8%E5%9E%8B%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">典型应用场景</a></li>
<li><a href="#%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98">常见面试问题</a></li>
<li><a href="#%E5%B0%8F%E7%BB%93%E4%B8%8E%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">小结与注意事项</a></li>
</ol>
<hr>
<h2 id="线程池的意义与优势"><a href="#线程池的意义与优势" class="headerlink" title="线程池的意义与优势"></a>线程池的意义与优势</h2><ul>
<li><strong>资源复用</strong>：线程池通过复用已创建的线程，避免频繁创建&#x2F;销毁线程带来的性能损耗。</li>
<li><strong>统一管理</strong>：集中管理线程生命周期，便于监控和调优。</li>
<li><strong>任务调度</strong>：支持任务排队、定时&#x2F;周期执行、批量处理等高级功能。</li>
<li><strong>防止资源耗尽</strong>：通过限制最大线程数，防止系统因过多线程而崩溃。</li>
<li><strong>提升响应速度</strong>：任务无需等待新线程创建，直接复用空闲线程。</li>
</ul>
<hr>
<h2 id="Executor-框架概览"><a href="#Executor-框架概览" class="headerlink" title="Executor 框架概览"></a>Executor 框架概览</h2><p>Java 的 <code>Executor</code> 框架（<code>java.util.concurrent</code> 包）实现了任务提交与执行的解耦，极大简化了并发编程。其核心思想是：</p>
<ul>
<li><strong>提交任务</strong>（Runnable&#x2F;Callable）</li>
<li><strong>由线程池统一调度和执行</strong></li>
</ul>
<hr>
<h2 id="核心接口与实现类"><a href="#核心接口与实现类" class="headerlink" title="核心接口与实现类"></a>核心接口与实现类</h2><h3 id="1-Executor"><a href="#1-Executor" class="headerlink" title="1. Executor"></a>1. Executor</h3><p>最基础接口，定义了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Runnable command)</span>;</span><br></pre></td></tr></table></figure>
<p>用于提交任务，但不关心执行细节。</p>
<h3 id="2-ExecutorService"><a href="#2-ExecutorService" class="headerlink" title="2. ExecutorService"></a>2. ExecutorService</h3><p>扩展了 Executor，支持：</p>
<ul>
<li>任务提交（submit）</li>
<li>任务取消、结果获取（Future）</li>
<li>批量任务处理（invokeAll&#x2F;invokeAny）</li>
<li>线程池关闭与状态管理</li>
</ul>
<h3 id="3-ScheduledExecutorService"><a href="#3-ScheduledExecutorService" class="headerlink" title="3. ScheduledExecutorService"></a>3. ScheduledExecutorService</h3><p>支持定时&#x2F;周期性任务调度。</p>
<h3 id="4-主要实现类"><a href="#4-主要实现类" class="headerlink" title="4. 主要实现类"></a>4. 主要实现类</h3><ul>
<li><strong>ThreadPoolExecutor</strong>：最常用的线程池实现，支持灵活参数配置。</li>
<li><strong>ScheduledThreadPoolExecutor</strong>：支持定时&#x2F;周期任务。</li>
<li><strong>ForkJoinPool</strong>：适合递归分治、并行计算场景。</li>
</ul>
<hr>
<h2 id="线程池的创建与使用"><a href="#线程池的创建与使用" class="headerlink" title="线程池的创建与使用"></a>线程池的创建与使用</h2><h3 id="1-Executors-工具类"><a href="#1-Executors-工具类" class="headerlink" title="1. Executors 工具类"></a>1. Executors 工具类</h3><p><code>Executors</code> 提供多种便捷工厂方法：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>newFixedThreadPool(n)</td>
<td>固定大小线程池</td>
</tr>
<tr>
<td>newSingleThreadExecutor()</td>
<td>单线程池，顺序执行</td>
</tr>
<tr>
<td>newCachedThreadPool()</td>
<td>可伸缩线程池，适合大量短任务</td>
</tr>
<tr>
<td>newScheduledThreadPool(n)</td>
<td>定时&#x2F;周期任务线程池</td>
</tr>
<tr>
<td>newWorkStealingPool()</td>
<td>工作窃取线程池（Java 8+）</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExecutorService</span> <span class="variable">pool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">4</span>);</span><br><span class="line">pool.submit(() -&gt; System.out.println(<span class="string">&quot;Hello from thread pool&quot;</span>));</span><br><span class="line">pool.shutdown();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>⚠️ 建议生产环境优先使用 ThreadPoolExecutor 显式配置参数，避免 Executors 默认策略带来的风险（如 OOM）。</p>
</blockquote>
<h3 id="2-线程池的基本用法"><a href="#2-线程池的基本用法" class="headerlink" title="2. 线程池的基本用法"></a>2. 线程池的基本用法</h3><ul>
<li>提交任务（execute&#x2F;submit）</li>
<li>获取结果（Future）</li>
<li>关闭线程池（shutdown&#x2F;shutdownNow）</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;String&gt; future = pool.submit(() -&gt; <span class="string">&quot;result&quot;</span>);</span><br><span class="line">System.out.println(future.get());</span><br><span class="line">pool.shutdown();</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ThreadPoolExecutor-深入解析"><a href="#ThreadPoolExecutor-深入解析" class="headerlink" title="ThreadPoolExecutor 深入解析"></a>ThreadPoolExecutor 深入解析</h2><p><code>ThreadPoolExecutor</code> 是线程池的核心实现，支持高度自定义。</p>
<h3 id="1-构造参数"><a href="#1-构造参数" class="headerlink" title="1. 构造参数"></a>1. 构造参数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ThreadPoolExecutor(</span><br><span class="line">    <span class="type">int</span> corePoolSize,         <span class="comment">// 核心线程数</span></span><br><span class="line">    <span class="type">int</span> maximumPoolSize,      <span class="comment">// 最大线程数</span></span><br><span class="line">    <span class="type">long</span> keepAliveTime,       <span class="comment">// 非核心线程空闲存活时间</span></span><br><span class="line">    TimeUnit unit,            <span class="comment">// 时间单位</span></span><br><span class="line">    BlockingQueue&lt;Runnable&gt; workQueue, <span class="comment">// 任务队列</span></span><br><span class="line">    ThreadFactory threadFactory,       <span class="comment">// 线程工厂</span></span><br><span class="line">    RejectedExecutionHandler handler   <span class="comment">// 拒绝策略</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="2-线程池运行流程"><a href="#2-线程池运行流程" class="headerlink" title="2. 线程池运行流程"></a>2. 线程池运行流程</h3><ol>
<li>任务提交到线程池</li>
<li>若运行线程数 &lt; corePoolSize，直接创建新线程执行</li>
<li>否则，任务进入队列等待</li>
<li>若队列满且线程数 &lt; maximumPoolSize，创建新线程执行</li>
<li>若队列满且线程数已达最大，触发拒绝策略</li>
</ol>
<h3 id="3-任务队列类型"><a href="#3-任务队列类型" class="headerlink" title="3. 任务队列类型"></a>3. 任务队列类型</h3><ul>
<li><strong>ArrayBlockingQueue</strong>：有界数组队列，常用</li>
<li><strong>LinkedBlockingQueue</strong>：无界链表队列，默认</li>
<li><strong>SynchronousQueue</strong>：不存储任务，直接交给线程</li>
<li><strong>PriorityBlockingQueue</strong>：优先级队列</li>
</ul>
<h3 id="4-拒绝策略"><a href="#4-拒绝策略" class="headerlink" title="4. 拒绝策略"></a>4. 拒绝策略</h3><ul>
<li><strong>AbortPolicy</strong>（默认）：抛出异常</li>
<li><strong>CallerRunsPolicy</strong>：由提交任务的线程执行</li>
<li><strong>DiscardPolicy</strong>：直接丢弃</li>
<li><strong>DiscardOldestPolicy</strong>：丢弃队列最老任务，尝试执行新任务</li>
</ul>
<h3 id="5-线程池监控与管理"><a href="#5-线程池监控与管理" class="headerlink" title="5. 线程池监控与管理"></a>5. 线程池监控与管理</h3><ul>
<li><code>getPoolSize()</code>：当前线程数</li>
<li><code>getActiveCount()</code>：活跃线程数</li>
<li><code>getCompletedTaskCount()</code>：已完成任务数</li>
<li><code>prestartAllCoreThreads()</code>：预启动所有核心线程</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">    <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, TimeUnit.SECONDS, <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;());</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">taskNum</span> <span class="operator">=</span> i + <span class="number">1</span>;</span><br><span class="line">    executor.execute(() -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Task &quot;</span> + taskNum + <span class="string">&quot; in &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">executor.shutdown();</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="线程池参数调优建议"><a href="#线程池参数调优建议" class="headerlink" title="线程池参数调优建议"></a>线程池参数调优建议</h2><ul>
<li><strong>核心线程数（corePoolSize）</strong>：CPU 密集型 ≈ CPU 核心数；IO 密集型 ≈ 2×CPU 核心数</li>
<li><strong>最大线程数（maximumPoolSize）</strong>：根据业务并发量和硬件资源合理设置</li>
<li><strong>队列类型与长度</strong>：有界队列防止 OOM，无界队列需谨慎</li>
<li><strong>拒绝策略</strong>：根据业务容忍度选择，推荐自定义日志&#x2F;报警</li>
<li><strong>线程工厂</strong>：自定义线程名便于排查问题</li>
<li><strong>监控与报警</strong>：定期监控线程池状态，及时发现异常</li>
</ul>
<hr>
<h2 id="典型应用场景"><a href="#典型应用场景" class="headerlink" title="典型应用场景"></a>典型应用场景</h2><ul>
<li>Web 服务器请求处理</li>
<li>批量数据处理、日志异步写入</li>
<li>定时&#x2F;周期性任务调度</li>
<li>并行计算、分治任务（ForkJoinPool）</li>
</ul>
<hr>
<h2 id="常见面试问题"><a href="#常见面试问题" class="headerlink" title="常见面试问题"></a>常见面试问题</h2><ol>
<li>线程池的工作原理？</li>
<li>ThreadPoolExecutor 各参数含义及调优建议？</li>
<li>线程池的拒绝策略有哪些？适用场景？</li>
<li>Executors 工厂方法的风险？为什么生产不推荐？</li>
<li>如何优雅关闭线程池？</li>
<li>线程池如何防止 OOM？</li>
<li>线程池监控与调优实践？</li>
<li>线程池与 ForkJoinPool 区别？</li>
</ol>
<hr>
<h2 id="小结与注意事项"><a href="#小结与注意事项" class="headerlink" title="小结与注意事项"></a>小结与注意事项</h2><ul>
<li>线程池是高并发系统的基础设施，合理配置至关重要</li>
<li>推荐优先使用 ThreadPoolExecutor 显式配置参数</li>
<li>关注线程池监控与异常处理，防止资源泄漏和 OOM</li>
<li>结合实际业务场景选择合适的线程池类型与参数</li>
</ul>
<hr>
<h2 id="自定义线程池的实现（优化版）"><a href="#自定义线程池的实现（优化版）" class="headerlink" title="自定义线程池的实现（优化版）"></a>自定义线程池的实现（优化版）</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.atguigujuc.day1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayDeque;</span><br><span class="line"><span class="keyword">import</span> java.util.Deque;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicBoolean;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestPool</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 测试不同的拒绝策略</span></span><br><span class="line">        testRejectionPolicies();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testRejectionPolicies</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=== 测试拒绝策略 ===&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 测试 AbortPolicy（默认策略）</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n1. 测试 AbortPolicy（抛出异常）:&quot;</span>);</span><br><span class="line">        testWithRejectionPolicy(<span class="keyword">new</span> <span class="title class_">AbortPolicy</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 测试 CallerRunsPolicy</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n2. 测试 CallerRunsPolicy（调用者运行）:&quot;</span>);</span><br><span class="line">        testWithRejectionPolicy(<span class="keyword">new</span> <span class="title class_">CallerRunsPolicy</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 测试 DiscardPolicy</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n3. 测试 DiscardPolicy（直接丢弃）:&quot;</span>);</span><br><span class="line">        testWithRejectionPolicy(<span class="keyword">new</span> <span class="title class_">DiscardPolicy</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 测试 DiscardOldestPolicy</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n4. 测试 DiscardOldestPolicy（丢弃最老任务）:&quot;</span>);</span><br><span class="line">        testWithRejectionPolicy(<span class="keyword">new</span> <span class="title class_">DiscardOldestPolicy</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testWithRejectionPolicy</span><span class="params">(RejectionPolicy policy)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建一个小容量的线程池来触发拒绝策略</span></span><br><span class="line">        <span class="type">ThreadPool</span> <span class="variable">threadPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPool</span>(<span class="number">1</span>, <span class="number">100</span>, TimeUnit.MILLISECONDS, <span class="number">2</span>, policy);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 提交多个任务，超过线程池容量</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="type">int</span> <span class="variable">taskId</span> <span class="operator">=</span> i;</span><br><span class="line">                threadPool.execute(() -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;执行任务 &quot;</span> + taskId + <span class="string">&quot; by &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">500</span>); <span class="comment">// 模拟长时间任务</span></span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        Thread.currentThread().interrupt();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 等待一段时间观察结果</span></span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;异常: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 拒绝策略接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">RejectionPolicy</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理被拒绝的任务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> task 被拒绝的任务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> threadPool 线程池实例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable task, ThreadPool threadPool)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 默认拒绝策略：抛出异常</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbortPolicy</span> <span class="keyword">implements</span> <span class="title class_">RejectionPolicy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable task, ThreadPool threadPool)</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RejectedExecutionException</span>(<span class="string">&quot;任务被拒绝执行，线程池已满&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 调用者运行策略：由提交任务的线程执行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CallerRunsPolicy</span> <span class="keyword">implements</span> <span class="title class_">RejectionPolicy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable task, ThreadPool threadPool)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;任务被拒绝，由调用者线程执行: &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">if</span> (!threadPool.isShutdown()) &#123;</span><br><span class="line">            task.run();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 直接丢弃策略：静默丢弃任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DiscardPolicy</span> <span class="keyword">implements</span> <span class="title class_">RejectionPolicy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable task, ThreadPool threadPool)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;任务被直接丢弃&quot;</span>);</span><br><span class="line">        <span class="comment">// 什么都不做，直接丢弃</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 丢弃最老任务策略：丢弃队列中最老的任务，然后尝试执行新任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DiscardOldestPolicy</span> <span class="keyword">implements</span> <span class="title class_">RejectionPolicy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable task, ThreadPool threadPool)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;尝试丢弃最老任务并执行新任务&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!threadPool.isShutdown()) &#123;</span><br><span class="line">            <span class="comment">// 尝试从队列中移除最老的任务</span></span><br><span class="line">            <span class="type">Runnable</span> <span class="variable">discardedTask</span> <span class="operator">=</span> threadPool.getWorkQueue().poll();</span><br><span class="line">            <span class="keyword">if</span> (discardedTask != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;丢弃了最老的任务&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 尝试将新任务放入队列</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                threadPool.getWorkQueue().put(task);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">                System.out.println(<span class="string">&quot;放入新任务时被中断&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义拒绝执行异常</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RejectedExecutionException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RejectedExecutionException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RejectedExecutionException</span><span class="params">(String message, Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message, cause);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义拒绝策略：记录日志并发送告警</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LogAndAlertPolicy</span> <span class="keyword">implements</span> <span class="title class_">RejectionPolicy</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String poolName;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LogAndAlertPolicy</span><span class="params">(String poolName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.poolName = poolName;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable task, ThreadPool threadPool)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> String.format(<span class="string">&quot;线程池[%s]任务被拒绝，当前活跃线程数: %d, 队列大小: %d&quot;</span>, </span><br><span class="line">                poolName, threadPool.getActiveCount(), threadPool.getQueueSize());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 记录错误日志</span></span><br><span class="line">        System.err.println(<span class="string">&quot;ERROR: &quot;</span> + message);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 模拟发送告警</span></span><br><span class="line">        sendAlert(message);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 可以选择抛出异常或静默处理</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RejectedExecutionException</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendAlert</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="comment">// 这里可以实现具体的告警逻辑，如发送邮件、短信、钉钉等</span></span><br><span class="line">        System.out.println(<span class="string">&quot;发送告警: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义拒绝策略：重试策略</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RetryPolicy</span> <span class="keyword">implements</span> <span class="title class_">RejectionPolicy</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> maxRetries;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> retryDelayMs;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RetryPolicy</span><span class="params">(<span class="type">int</span> maxRetries, <span class="type">long</span> retryDelayMs)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.maxRetries = maxRetries;</span><br><span class="line">        <span class="built_in">this</span>.retryDelayMs = retryDelayMs;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable task, ThreadPool threadPool)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;任务被拒绝，尝试重试...&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; maxRetries; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(retryDelayMs);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 重新尝试提交任务</span></span><br><span class="line">                <span class="keyword">if</span> (threadPool.getWorkQueue().offer(task)) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;重试成功，任务已重新加入队列&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 重试失败，抛出异常</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RejectedExecutionException</span>(<span class="string">&quot;任务重试&quot;</span> + maxRetries + <span class="string">&quot;次后仍然被拒绝&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义拒绝策略：降级策略</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FallbackPolicy</span> <span class="keyword">implements</span> <span class="title class_">RejectionPolicy</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Runnable fallbackTask;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FallbackPolicy</span><span class="params">(Runnable fallbackTask)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fallbackTask = fallbackTask;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable task, ThreadPool threadPool)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;任务被拒绝，执行降级策略&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 执行降级任务</span></span><br><span class="line">            <span class="keyword">if</span> (fallbackTask != <span class="literal">null</span>) &#123;</span><br><span class="line">                fallbackTask.run();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;降级任务执行失败: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试自定义拒绝策略</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomPolicyTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=== 测试自定义拒绝策略 ===&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 测试日志告警策略</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n1. 测试日志告警策略:&quot;</span>);</span><br><span class="line">        testLogAndAlertPolicy();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 测试重试策略</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n2. 测试重试策略:&quot;</span>);</span><br><span class="line">        testRetryPolicy();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 测试降级策略</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n3. 测试降级策略:&quot;</span>);</span><br><span class="line">        testFallbackPolicy();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testLogAndAlertPolicy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ThreadPool</span> <span class="variable">threadPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPool</span>(<span class="number">1</span>, <span class="number">100</span>, TimeUnit.MILLISECONDS, <span class="number">1</span>, </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">LogAndAlertPolicy</span>(<span class="string">&quot;测试线程池&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="type">int</span> <span class="variable">taskId</span> <span class="operator">=</span> i;</span><br><span class="line">                threadPool.execute(() -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;执行任务 &quot;</span> + taskId);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        Thread.currentThread().interrupt();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;捕获异常: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testRetryPolicy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ThreadPool</span> <span class="variable">threadPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPool</span>(<span class="number">1</span>, <span class="number">100</span>, TimeUnit.MILLISECONDS, <span class="number">1</span>, </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">RetryPolicy</span>(<span class="number">3</span>, <span class="number">200</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="type">int</span> <span class="variable">taskId</span> <span class="operator">=</span> i;</span><br><span class="line">                threadPool.execute(() -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;执行任务 &quot;</span> + taskId);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">800</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        Thread.currentThread().interrupt();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;捕获异常: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testFallbackPolicy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">fallbackTask</span> <span class="operator">=</span> () -&gt; System.out.println(<span class="string">&quot;执行降级任务&quot;</span>);</span><br><span class="line">        <span class="type">ThreadPool</span> <span class="variable">threadPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPool</span>(<span class="number">1</span>, <span class="number">100</span>, TimeUnit.MILLISECONDS, <span class="number">1</span>, </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">FallbackPolicy</span>(fallbackTask));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="type">int</span> <span class="variable">taskId</span> <span class="operator">=</span> i;</span><br><span class="line">                threadPool.execute(() -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;执行任务 &quot;</span> + taskId);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        Thread.currentThread().interrupt();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;捕获异常: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadPool</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BlockingQueue&lt;Runnable&gt; workQueue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;Worker&gt; workers;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> coreSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> timeout;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TimeUnit timeUnit;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AtomicBoolean isShutdown;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">mainLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RejectionPolicy rejectionPolicy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ThreadPool</span><span class="params">(<span class="type">int</span> coreSize, <span class="type">long</span> timeout, TimeUnit timeUnit, <span class="type">int</span> queueCapacity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(coreSize, timeout, timeUnit, queueCapacity, <span class="keyword">new</span> <span class="title class_">AbortPolicy</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ThreadPool</span><span class="params">(<span class="type">int</span> coreSize, <span class="type">long</span> timeout, TimeUnit timeUnit, <span class="type">int</span> queueCapacity, RejectionPolicy rejectionPolicy)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (coreSize &lt;= <span class="number">0</span> || timeout &lt;= <span class="number">0</span> || queueCapacity &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;参数必须大于0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (rejectionPolicy == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;拒绝策略不能为null&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">this</span>.coreSize = coreSize;</span><br><span class="line">        <span class="built_in">this</span>.timeout = timeout;</span><br><span class="line">        <span class="built_in">this</span>.timeUnit = timeUnit;</span><br><span class="line">        <span class="built_in">this</span>.workQueue = <span class="keyword">new</span> <span class="title class_">BlockingQueue</span>&lt;&gt;(queueCapacity);</span><br><span class="line">        <span class="built_in">this</span>.workers = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="built_in">this</span>.isShutdown = <span class="keyword">new</span> <span class="title class_">AtomicBoolean</span>(<span class="literal">false</span>);</span><br><span class="line">        <span class="built_in">this</span>.rejectionPolicy = rejectionPolicy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行任务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Runnable runnable)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (runnable == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;任务不能为null&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (isShutdown.get()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;线程池已关闭&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 如果当前线程数小于核心线程数，创建新线程</span></span><br><span class="line">            <span class="keyword">if</span> (workers.size() &lt; coreSize) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;新增worker线程，当前worker数量: &quot;</span> + workers.size());</span><br><span class="line">                <span class="type">Worker</span> <span class="variable">worker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Worker</span>(runnable);</span><br><span class="line">                workers.add(worker);</span><br><span class="line">                worker.start();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 尝试将任务放入队列</span></span><br><span class="line">                <span class="keyword">if</span> (!workQueue.offer(runnable)) &#123;</span><br><span class="line">                    <span class="comment">// 队列已满，触发拒绝策略</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;队列已满，触发拒绝策略&quot;</span>);</span><br><span class="line">                    rejectionPolicy.rejectedExecution(runnable, <span class="built_in">this</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;任务加入等待队列，当前队列大小: &quot;</span> + workQueue.size());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭线程池</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isShutdown.compareAndSet(<span class="literal">false</span>, <span class="literal">true</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;正在关闭线程池...&quot;</span>);</span><br><span class="line">            mainLock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (Worker worker : workers) &#123;</span><br><span class="line">                    worker.interrupt();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                mainLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前活跃线程数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getActiveCount</span><span class="params">()</span> &#123;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> workers.size();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取队列中的任务数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getQueueSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> workQueue.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查线程池是否已关闭</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isShutdown</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> isShutdown.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取工作队列（用于拒绝策略）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    BlockingQueue&lt;Runnable&gt; <span class="title function_">getWorkQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> workQueue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Worker线程类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">Worker</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> Runnable firstTask;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">completedTasks</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Worker</span><span class="params">(Runnable firstTask)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.firstTask = firstTask;</span><br><span class="line">            setName(<span class="string">&quot;Worker-&quot;</span> + getId());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 执行第一个任务</span></span><br><span class="line">                <span class="keyword">if</span> (firstTask != <span class="literal">null</span>) &#123;</span><br><span class="line">                    runTask(firstTask);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 循环执行队列中的任务</span></span><br><span class="line">                <span class="keyword">while</span> (!isShutdown.get() || !workQueue.isEmpty()) &#123;</span><br><span class="line">                    <span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> workQueue.poll(timeout, timeUnit);</span><br><span class="line">                    <span class="keyword">if</span> (task != <span class="literal">null</span>) &#123;</span><br><span class="line">                        runTask(task);</span><br><span class="line">                        completedTasks = <span class="literal">true</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isShutdown.get()) &#123;</span><br><span class="line">                        <span class="comment">// 线程池已关闭且队列为空，退出循环</span></span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="comment">// 线程被中断，正常退出</span></span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">// 从workers集合中移除自己</span></span><br><span class="line">                mainLock.lock();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    workers.remove(<span class="built_in">this</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;Worker线程 &quot;</span> + getName() + <span class="string">&quot; 退出，当前活跃线程数: &quot;</span> + workers.size());</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    mainLock.unlock();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">runTask</span><span class="params">(Runnable task)</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                task.run();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                System.err.println(<span class="string">&quot;任务执行异常: &quot;</span> + e.getMessage());</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 线程安全的阻塞队列</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BlockingQueue</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Deque&lt;T&gt; queue = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">notEmpty</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">notFull</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> capacity;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BlockingQueue</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (capacity &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;容量必须大于0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 带超时的获取元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">poll</span><span class="params">(<span class="type">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">nanos</span> <span class="operator">=</span> unit.toNanos(timeout);</span><br><span class="line">        lock.lockInterruptibly();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (queue.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nanos &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                nanos = notEmpty.awaitNanos(nanos);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">T</span> <span class="variable">element</span> <span class="operator">=</span> queue.removeFirst();</span><br><span class="line">            notFull.signal();</span><br><span class="line">            <span class="keyword">return</span> element;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 阻塞获取元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">take</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        lock.lockInterruptibly();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (queue.isEmpty()) &#123;</span><br><span class="line">                notEmpty.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">T</span> <span class="variable">element</span> <span class="operator">=</span> queue.removeFirst();</span><br><span class="line">            notFull.signal();</span><br><span class="line">            <span class="keyword">return</span> element;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 阻塞添加元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(T element)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">if</span> (element == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;元素不能为null&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        lock.lockInterruptibly();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (queue.size() == capacity) &#123;</span><br><span class="line">                notFull.await();</span><br><span class="line">            &#125;</span><br><span class="line">            queue.addLast(element);</span><br><span class="line">            notEmpty.signal();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 非阻塞添加元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offer</span><span class="params">(T element)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (element == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;元素不能为null&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (queue.size() == capacity) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            queue.addLast(element);</span><br><span class="line">            notEmpty.signal();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取队列大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queue.size();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查队列是否为空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queue.isEmpty();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查队列是否已满</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queue.size() == capacity;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">## 拒绝策略详解</span><br><span class="line"></span><br><span class="line">### 什么是拒绝策略？</span><br><span class="line"></span><br><span class="line">拒绝策略是线程池中处理任务被拒绝执行时的策略。当线程池和任务队列都满时，新提交的任务会被拒绝，此时需要根据业务需求选择合适的处理方式。</span><br><span class="line"></span><br><span class="line">### 内置拒绝策略</span><br><span class="line"></span><br><span class="line">#### <span class="number">1.</span> AbortPolicy（默认策略）</span><br><span class="line">- **行为**：抛出 `RejectedExecutionException` 异常</span><br><span class="line">- **适用场景**：需要明确知道任务被拒绝的情况</span><br><span class="line">- **优点**：能够及时发现线程池负载过高的问题</span><br><span class="line">- **缺点**：可能导致调用方异常，需要额外的异常处理</span><br><span class="line"></span><br><span class="line">#### <span class="number">2.</span> CallerRunsPolicy</span><br><span class="line">- **行为**：由提交任务的线程执行被拒绝的任务</span><br><span class="line">- **适用场景**：对任务执行时间不敏感，希望降低提交速度</span><br><span class="line">- **优点**：能够自动调节提交速度，防止系统过载</span><br><span class="line">- **缺点**：可能阻塞调用方线程</span><br><span class="line"></span><br><span class="line">#### <span class="number">3.</span> DiscardPolicy</span><br><span class="line">- **行为**：静默丢弃被拒绝的任务</span><br><span class="line">- **适用场景**：任务可以被丢弃，不重要的任务</span><br><span class="line">- **优点**：不会影响系统稳定性</span><br><span class="line">- **缺点**：任务丢失，可能影响业务逻辑</span><br><span class="line"></span><br><span class="line">#### <span class="number">4.</span> DiscardOldestPolicy</span><br><span class="line">- **行为**：丢弃队列中最老的任务，然后尝试执行新任务</span><br><span class="line">- **适用场景**：新任务比老任务更重要</span><br><span class="line">- **优点**：保证新任务能够执行</span><br><span class="line">- **缺点**：可能丢失重要的老任务</span><br><span class="line"></span><br><span class="line">### 自定义拒绝策略</span><br><span class="line"></span><br><span class="line">#### <span class="number">1.</span> 日志告警策略（LogAndAlertPolicy）</span><br><span class="line">```java</span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="type">ThreadPool</span> <span class="variable">threadPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPool</span>(<span class="number">2</span>, <span class="number">1000</span>, TimeUnit.MILLISECONDS, <span class="number">10</span>, </span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">LogAndAlertPolicy</span>(<span class="string">&quot;订单处理线程池&quot;</span>));</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>特点</strong>：记录详细日志并发送告警</li>
<li><strong>适用场景</strong>：生产环境监控，需要及时发现问题</li>
</ul>
<h4 id="2-重试策略（RetryPolicy）"><a href="#2-重试策略（RetryPolicy）" class="headerlink" title="2. 重试策略（RetryPolicy）"></a>2. 重试策略（RetryPolicy）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="type">ThreadPool</span> <span class="variable">threadPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPool</span>(<span class="number">2</span>, <span class="number">1000</span>, TimeUnit.MILLISECONDS, <span class="number">10</span>, </span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">RetryPolicy</span>(<span class="number">3</span>, <span class="number">1000</span>)); <span class="comment">// 重试3次，每次间隔1秒</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>特点</strong>：自动重试被拒绝的任务</li>
<li><strong>适用场景</strong>：任务比较重要，可以接受延迟执行</li>
</ul>
<h4 id="3-降级策略（FallbackPolicy）"><a href="#3-降级策略（FallbackPolicy）" class="headerlink" title="3. 降级策略（FallbackPolicy）"></a>3. 降级策略（FallbackPolicy）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="type">Runnable</span> <span class="variable">fallbackTask</span> <span class="operator">=</span> () -&gt; System.out.println(<span class="string">&quot;执行降级逻辑&quot;</span>);</span><br><span class="line"><span class="type">ThreadPool</span> <span class="variable">threadPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPool</span>(<span class="number">2</span>, <span class="number">1000</span>, TimeUnit.MILLISECONDS, <span class="number">10</span>, </span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">FallbackPolicy</span>(fallbackTask));</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>特点</strong>：执行降级任务替代被拒绝的任务</li>
<li><strong>适用场景</strong>：有备选方案，保证系统可用性</li>
</ul>
<h3 id="拒绝策略选择建议"><a href="#拒绝策略选择建议" class="headerlink" title="拒绝策略选择建议"></a>拒绝策略选择建议</h3><h4 id="1-根据业务重要性选择"><a href="#1-根据业务重要性选择" class="headerlink" title="1. 根据业务重要性选择"></a>1. 根据业务重要性选择</h4><ul>
<li><strong>关键业务</strong>：使用 <code>CallerRunsPolicy</code> 或自定义重试策略</li>
<li><strong>一般业务</strong>：使用 <code>AbortPolicy</code> 或 <code>DiscardOldestPolicy</code></li>
<li><strong>非关键业务</strong>：使用 <code>DiscardPolicy</code></li>
</ul>
<h4 id="2-根据系统负载选择"><a href="#2-根据系统负载选择" class="headerlink" title="2. 根据系统负载选择"></a>2. 根据系统负载选择</h4><ul>
<li><strong>高负载系统</strong>：使用 <code>CallerRunsPolicy</code> 自动调节</li>
<li><strong>稳定负载系统</strong>：使用 <code>AbortPolicy</code> 及时发现问题</li>
<li><strong>突发负载系统</strong>：使用 <code>DiscardOldestPolicy</code> 保证新任务</li>
</ul>
<h4 id="3-根据监控需求选择"><a href="#3-根据监控需求选择" class="headerlink" title="3. 根据监控需求选择"></a>3. 根据监控需求选择</h4><ul>
<li><strong>需要监控</strong>：使用自定义日志告警策略</li>
<li><strong>简单监控</strong>：使用 <code>AbortPolicy</code> 配合异常监控</li>
<li><strong>无需监控</strong>：使用 <code>DiscardPolicy</code></li>
</ul>
<h3 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h3><ol>
<li><strong>生产环境推荐</strong>：使用自定义日志告警策略，及时发现问题</li>
<li><strong>开发环境推荐</strong>：使用 <code>AbortPolicy</code>，便于调试</li>
<li><strong>测试环境推荐</strong>：使用 <code>CallerRunsPolicy</code>，模拟真实负载</li>
<li><strong>监控告警</strong>：配合线程池监控，设置合理的告警阈值</li>
<li><strong>参数调优</strong>：根据拒绝策略的执行情况，调整线程池参数</li>
</ol>
<h3 id="监控指标"><a href="#监控指标" class="headerlink" title="监控指标"></a>监控指标</h3><ul>
<li><strong>拒绝次数</strong>：统计任务被拒绝的次数</li>
<li><strong>拒绝率</strong>：拒绝次数 &#x2F; 总提交次数</li>
<li><strong>队列使用率</strong>：当前队列大小 &#x2F; 队列容量</li>
<li><strong>线程使用率</strong>：活跃线程数 &#x2F; 最大线程数</li>
</ul>
<p>通过这些指标可以及时发现线程池配置问题，进行相应的调优。</p>
<hr>
<h2 id="Fork-Join"><a href="#Fork-Join" class="headerlink" title="Fork &#x2F; Join"></a>Fork &#x2F; Join</h2><p>Fork&#x2F;Join 框架是 Java 7 引入的一个并行编程框架，旨在帮助开发者更方便地编写高效、可扩展的并行程序。它基于“分治法”（Divide-and-Conquer）策略，将一个大任务递归分解为多个小任务并行执行，然后合并这些小任务的结果以得到最终结果。Fork&#x2F;Join 框架特别适合于那些可以被分解成许多相似的小任务，并且这些小任务之间几乎没有依赖关系的情况。</p>
<h3 id="核心组件"><a href="#核心组件" class="headerlink" title="核心组件"></a>核心组件</h3><ol>
<li><p><strong>ForkJoinPool</strong>：这是 Fork&#x2F;Join 框架的核心执行引擎，类似于线程池。它管理着工作窃取算法(work-stealing algorithm)下的工作线程集合。每个工作线程都维护着自己的双端队列(deque)，用于存储待执行的任务。</p>
</li>
<li><p><strong>ForkJoinTask<V></strong>：这是一个抽象类，代表了可以在 ForkJoinPool 中执行的任务。所有的 Fork&#x2F;Join 任务都需要继承自这个类或者其子类。</p>
<ul>
<li><strong>RecursiveAction</strong>：适用于不需要返回结果的任务。</li>
<li><strong>RecursiveTask<V></strong>：适用于需要返回结果的任务。</li>
</ul>
</li>
<li><p><strong>Work-Stealing Algorithm</strong>：这是一种分配任务的方法，当某个线程完成了自己 deque 中的所有任务后，它可以尝试从其他线程的 deque 的尾部“偷取”任务来执行，从而提高了资源利用率和负载均衡。</p>
</li>
</ol>
<h3 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h3><ol>
<li><p><strong>Fork</strong>：任务开始时，如果当前任务规模足够小，则直接计算；否则，将其分割(split)为两个或更多的子任务，并对每个子任务调用 <code>fork()</code> 方法异步执行。</p>
</li>
<li><p><strong>Join</strong>：对于每个已经 fork 出去的子任务，父任务会调用 <code>join()</code> 方法等待子任务完成，并获取其结果。注意，<code>join()</code> 不会阻塞线程，除非当前线程没有其他任务可做。</p>
</li>
<li><p><strong>合并结果</strong>：一旦所有子任务都完成了，父任务就会合并它们的结果，生成最终结果。</p>
</li>
</ol>
<h3 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h3><p>这里有一个简单的例子，展示了如何使用 RecursiveTask 来计算数组中元素的总和：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.RecursiveTask;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ForkJoinPool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SumTask</span> <span class="keyword">extends</span> <span class="title class_">RecursiveTask</span>&lt;Long&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">THRESHOLD</span> <span class="operator">=</span> <span class="number">10</span>; <span class="comment">// 阈值，决定是否继续拆分任务</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span>[] array;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> start;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> end;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SumTask</span><span class="params">(<span class="type">long</span>[] array, <span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.array = array;</span><br><span class="line">        <span class="built_in">this</span>.start = start;</span><br><span class="line">        <span class="built_in">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Long <span class="title function_">compute</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (end - start &lt;= THRESHOLD) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; end; i++) &#123;</span><br><span class="line">                sum += array[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sum;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">middle</span> <span class="operator">=</span> (start + end) / <span class="number">2</span>;</span><br><span class="line">            <span class="type">SumTask</span> <span class="variable">leftTask</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SumTask</span>(array, start, middle);</span><br><span class="line">            <span class="type">SumTask</span> <span class="variable">rightTask</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SumTask</span>(array, middle, end);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 分别启动子任务</span></span><br><span class="line">            leftTask.fork();</span><br><span class="line">            rightTask.fork();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 合并结果</span></span><br><span class="line">            <span class="keyword">return</span> leftTask.join() + rightTask.join();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">long</span>[] numbers = &#123; <span class="comment">/* 初始化你的数据 */</span> &#125;;</span><br><span class="line">        <span class="type">ForkJoinPool</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForkJoinPool</span>();</span><br><span class="line">        <span class="type">SumTask</span> <span class="variable">task</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SumTask</span>(numbers, <span class="number">0</span>, numbers.length);</span><br><span class="line">        <span class="type">long</span> <span class="variable">result</span> <span class="operator">=</span> pool.invoke(task);</span><br><span class="line">        System.out.println(<span class="string">&quot;Sum is: &quot;</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="特点与优势"><a href="#特点与优势" class="headerlink" title="特点与优势"></a>特点与优势</h3><ul>
<li><strong>高效性</strong>：通过工作窃取算法有效地利用多核处理器的能力，减少了线程间的竞争。</li>
<li><strong>灵活性</strong>：可以轻松处理各种类型的并行问题，特别是那些可以通过分治法解决的问题。</li>
<li><strong>易用性</strong>：简化了并行程序的编写过程，使得开发人员无需手动管理线程同步等复杂问题。</li>
</ul>
<p>好的，我们来系统性地回答关于 Java 线程池的这八大核心问题。</p>
<hr>
<h3 id="1-线程池的工作原理？"><a href="#1-线程池的工作原理？" class="headerlink" title="1. 线程池的工作原理？"></a>1. 线程池的工作原理？</h3><p>线程池的核心思想是**“池化”**：预先创建一组可重用的线程，避免频繁创建和销毁线程带来的性能开销。</p>
<p><strong>工作流程：</strong></p>
<ol>
<li><strong>提交任务</strong>：客户端调用 <code>execute(Runnable command)</code> 或 <code>submit(Callable&lt;T&gt; task)</code> 提交任务。</li>
<li><strong>判断核心线程</strong>：<ul>
<li>如果<strong>当前线程数 &lt; 核心线程数（corePoolSize）</strong>，即使有空闲线程，也会<strong>创建新线程</strong>来执行任务。</li>
<li>如果<strong>当前线程数 &gt;&#x3D; corePoolSize</strong>，进入下一步。</li>
</ul>
</li>
<li><strong>尝试入队</strong>：<ul>
<li>将任务放入<strong>工作队列（workQueue）</strong>。</li>
<li>如果入队成功，任务在队列中等待。</li>
<li>如果入队失败（队列已满），进入下一步。</li>
</ul>
</li>
<li><strong>判断最大线程数</strong>：<ul>
<li>如果<strong>当前线程数 &lt; 最大线程数（maximumPoolSize）</strong>，则<strong>创建非核心线程</strong>来执行这个新任务。</li>
<li>如果<strong>当前线程数 &gt;&#x3D; maximumPoolSize</strong>，进入下一步。</li>
</ul>
</li>
<li><strong>执行拒绝策略</strong>：<ul>
<li>触发<strong>拒绝策略（RejectedExecutionHandler）</strong>，如抛出异常、丢弃任务等。</li>
</ul>
</li>
</ol>
<p><strong>简单记忆：</strong></p>
<blockquote>
<p><strong>核心线程不够 → 入队 → 队列满 → 创建非核心线程 → 还不够 → 拒绝</strong></p>
</blockquote>
<hr>
<h3 id="2-ThreadPoolExecutor-各参数含义及调优建议？"><a href="#2-ThreadPoolExecutor-各参数含义及调优建议？" class="headerlink" title="2. ThreadPoolExecutor 各参数含义及调优建议？"></a>2. <code>ThreadPoolExecutor</code> 各参数含义及调优建议？</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">    <span class="type">int</span> corePoolSize,</span><br><span class="line">    <span class="type">int</span> maximumPoolSize,</span><br><span class="line">    <span class="type">long</span> keepAliveTime,</span><br><span class="line">    TimeUnit unit,</span><br><span class="line">    BlockingQueue&lt;Runnable&gt; workQueue,</span><br><span class="line">    ThreadFactory threadFactory,</span><br><span class="line">    RejectedExecutionHandler handler</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">含义</th>
<th align="left">调优建议</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong><code>corePoolSize</code></strong></td>
<td align="left"><strong>核心线程数</strong>。这些线程会一直存活（除非设置了 <code>allowCoreThreadTimeOut</code>）。</td>
<td align="left">- CPU 密集型任务：<code>N_cpu + 1</code>（N 为 CPU 核心数）<br>- I&#x2F;O 密集型任务：<code>N_cpu * 2</code> 或更高（因为线程常阻塞）</td>
</tr>
<tr>
<td align="left"><strong><code>maximumPoolSize</code></strong></td>
<td align="left"><strong>最大线程数</strong>。线程池允许创建的线程总数上限。</td>
<td align="left">- 通常设置为 <code>corePoolSize</code> 的 2-4 倍，用于应对突发流量。<br>- 需结合系统资源（CPU、内存、文件句柄等）设置。</td>
</tr>
<tr>
<td align="left"><strong><code>keepAliveTime</code></strong></td>
<td align="left"><strong>非核心线程的空闲存活时间</strong>。超过 <code>corePoolSize</code> 的线程，在空闲超过此时间后会被回收。</td>
<td align="left">- 一般设置为 30-60 秒。<br>- 如果希望核心线程也能回收，可设置 <code>allowCoreThreadTimeOut(true)</code>。</td>
</tr>
<tr>
<td align="left"><strong><code>unit</code></strong></td>
<td align="left"><code>keepAliveTime</code> 的时间单位（如 <code>SECONDS</code>, <code>MINUTES</code>）。</td>
<td align="left">- 根据业务需求选择。</td>
</tr>
<tr>
<td align="left"><strong><code>workQueue</code></strong></td>
<td align="left"><strong>工作队列</strong>。用于存放待执行的任务。</td>
<td align="left">- <strong>推荐有界队列</strong>（如 <code>ArrayBlockingQueue</code>），防止 OOM。<br>- 避免使用无界队列（如 <code>newFixedThreadPool</code> 默认的 <code>LinkedBlockingQueue</code>）。</td>
</tr>
<tr>
<td align="left"><strong><code>threadFactory</code></strong></td>
<td align="left"><strong>线程工厂</strong>。用于创建新线程。可以自定义线程名称、优先级、是否为守护线程等。</td>
<td align="left">- <strong>强烈建议自定义</strong>，为线程命名（如 <code>biz-pool-%d</code>），便于日志追踪和问题排查。</td>
</tr>
<tr>
<td align="left"><strong><code>handler</code></strong></td>
<td align="left"><strong>拒绝策略</strong>。当线程池无法处理新任务时的处理策略。</td>
<td align="left">- 根据业务选择合适的策略（见问题 3）。</td>
</tr>
</tbody></table>
<hr>
<h3 id="3-线程池的拒绝策略有哪些？适用场景？"><a href="#3-线程池的拒绝策略有哪些？适用场景？" class="headerlink" title="3. 线程池的拒绝策略有哪些？适用场景？"></a>3. 线程池的拒绝策略有哪些？适用场景？</h3><table>
<thead>
<tr>
<th align="left">拒绝策略</th>
<th align="left">类名</th>
<th align="left">行为</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>中止策略</strong></td>
<td align="left"><code>AbortPolicy</code>（默认）</td>
<td align="left">抛出 <code>RejectedExecutionException</code> 异常。</td>
<td align="left">- 对数据一致性要求高，宁愿失败也不愿丢失或延迟。<br>- 系统设计应能处理此异常。</td>
</tr>
<tr>
<td align="left"><strong>调用者运行策略</strong></td>
<td align="left"><code>CallerRunsPolicy</code></td>
<td align="left">由<strong>提交任务的线程</strong>（即调用者线程）自己来执行该任务。</td>
<td align="left">- 适用于<strong>非关键任务</strong>，可以接受任务执行变慢。<br>- 能起到“背压”作用，减缓任务提交速度。</td>
</tr>
<tr>
<td align="left"><strong>丢弃策略</strong></td>
<td align="left"><code>DiscardPolicy</code></td>
<td align="left"><strong>静默丢弃</strong>新提交的任务，不抛异常。</td>
<td align="left">- 适用于<strong>可丢失任务</strong>的场景，如日志收集、监控数据上报。</td>
</tr>
<tr>
<td align="left"><strong>丢弃最旧策略</strong></td>
<td align="left"><code>DiscardOldestPolicy</code></td>
<td align="left">丢弃<strong>队列中最老的一个任务</strong>（即将被执行的那个），然后尝试提交新任务。</td>
<td align="left">- 适用于<strong>实时性要求高</strong>的场景，如消息推送，宁愿丢旧消息也不愿队列积压。</td>
</tr>
</tbody></table>
<hr>
<h3 id="4-Executors-工厂方法的风险？为什么生产不推荐？"><a href="#4-Executors-工厂方法的风险？为什么生产不推荐？" class="headerlink" title="4. Executors 工厂方法的风险？为什么生产不推荐？"></a>4. <code>Executors</code> 工厂方法的风险？为什么生产不推荐？</h3><p><code>Executors</code> 提供了便捷的工厂方法，但<strong>在生产环境中应避免直接使用</strong>，原因如下：</p>
<table>
<thead>
<tr>
<th align="left">工厂方法</th>
<th align="left">风险</th>
<th align="left">详细说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>newFixedThreadPool(n)</code></td>
<td align="left"><strong>使用无界队列</strong></td>
<td align="left">内部使用 <code>new LinkedBlockingQueue&lt;&gt;()</code>（容量 <code>Integer.MAX_VALUE</code>）。如果任务处理速度跟不上提交速度，队列会无限增长，最终导致 <code>OutOfMemoryError</code>。</td>
</tr>
<tr>
<td align="left"><code>newCachedThreadPool()</code></td>
<td align="left"><strong>线程数无上限</strong></td>
<td align="left"><code>maximumPoolSize = Integer.MAX_VALUE</code>。在高并发下可能创建海量线程，耗尽系统资源（CPU、内存、文件句柄等），导致系统崩溃。</td>
</tr>
<tr>
<td align="left"><code>newSingleThreadExecutor()</code></td>
<td align="left"><strong>使用无界队列</strong></td>
<td align="left">同 <code>newFixedThreadPool</code>，存在 OOM 风险。</td>
</tr>
</tbody></table>
<p><strong>✅ 正确做法</strong>：<strong>直接使用 <code>ThreadPoolExecutor</code> 构造函数</strong>，显式指定所有参数，尤其是使用<strong>有界队列</strong>和<strong>合理的线程数上限</strong>。</p>
<hr>
<h3 id="5-如何优雅关闭线程池？"><a href="#5-如何优雅关闭线程池？" class="headerlink" title="5. 如何优雅关闭线程池？"></a>5. 如何优雅关闭线程池？</h3><p>目标是：<strong>停止接收新任务，并等待已提交的任务执行完毕</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 停止接收新任务</span></span><br><span class="line">executor.shutdown();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 等待任务完成（推荐设置超时）</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!executor.awaitTermination(<span class="number">60</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">        <span class="comment">// 超时后，强制关闭（中断正在执行的任务）</span></span><br><span class="line">        executor.shutdownNow();</span><br><span class="line">        <span class="comment">// 再次等待，确保任务响应中断</span></span><br><span class="line">        <span class="keyword">if</span> (!executor.awaitTermination(<span class="number">60</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;线程池未能正常关闭&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    <span class="comment">// 当前线程被中断，也强制关闭</span></span><br><span class="line">    executor.shutdownNow();</span><br><span class="line">    Thread.currentThread().interrupt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>关键方法</strong>：</p>
<ul>
<li><code>shutdown()</code>：平滑关闭，不再接收新任务，但会执行完队列中的任务。</li>
<li><code>shutdownNow()</code>：立即关闭，尝试中断所有正在执行的任务，并返回队列中未处理的任务。</li>
<li><code>awaitTermination(timeout, unit)</code>：阻塞等待线程池关闭，或超时。</li>
</ul>
<hr>
<h3 id="6-线程池如何防止-OOM？"><a href="#6-线程池如何防止-OOM？" class="headerlink" title="6. 线程池如何防止 OOM？"></a>6. 线程池如何防止 OOM？</h3><ol>
<li><strong>使用有界队列</strong>：如 <code>ArrayBlockingQueue(capacity)</code>，明确限制队列大小。</li>
<li><strong>合理设置线程数</strong>：避免 <code>maximumPoolSize</code> 过大，防止创建过多线程耗尽内存。</li>
<li><strong>配置合适的拒绝策略</strong>：当资源紧张时，通过拒绝策略（如 <code>AbortPolicy</code>）快速失败，而不是让任务无限堆积。</li>
<li><strong>监控队列大小</strong>：实时监控 <code>workQueue.size()</code>，及时发现积压。</li>
<li><strong>避免任务内存泄漏</strong>：确保任务本身不会持有大对象或导致内存泄漏。</li>
</ol>
<hr>
<h3 id="7-线程池监控与调优实践？"><a href="#7-线程池监控与调优实践？" class="headerlink" title="7. 线程池监控与调优实践？"></a>7. 线程池监控与调优实践？</h3><p><strong>监控指标（可通过 JMX 或自定义监控）：</strong></p>
<ul>
<li><code>getPoolSize()</code>：当前线程数。</li>
<li><code>getActiveCount()</code>：正在执行任务的线程数。</li>
<li><code>getQueue().size()</code>：队列中的任务数。</li>
<li><code>getCompletedTaskCount()</code>：已完成任务数。</li>
<li><code>getLargestPoolSize()</code>：曾达到的最大线程数。</li>
</ul>
<p><strong>调优实践：</strong></p>
<ol>
<li><strong>压力测试</strong>：模拟生产流量，观察监控指标。</li>
<li><strong>调整参数</strong>：<ul>
<li>如果 <code>queue.size()</code> 经常很大 → 增加 <code>corePoolSize</code> 或 <code>maximumPoolSize</code>，或优化任务处理速度。</li>
<li>如果 <code>activeCount</code> 接近 <code>maximumPoolSize</code> → 说明线程池在频繁扩容，可能需要增加 <code>corePoolSize</code>。</li>
<li>如果频繁触发拒绝策略 → 需要增加线程数、队列大小，或优化业务逻辑。</li>
</ul>
</li>
<li><strong>动态调优</strong>：高级场景下，可实现动态调整线程池参数（如 <code>setCorePoolSize()</code>）。</li>
</ol>
<hr>
<h3 id="8-线程池与-ForkJoinPool-区别？"><a href="#8-线程池与-ForkJoinPool-区别？" class="headerlink" title="8. 线程池与 ForkJoinPool 区别？"></a>8. 线程池与 <code>ForkJoinPool</code> 区别？</h3><table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left"><code>ThreadPoolExecutor</code></th>
<th align="left"><code>ForkJoinPool</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>设计目的</strong></td>
<td align="left">通用任务执行</td>
<td align="left"><strong>分治算法</strong>（Divide and Conquer），如递归、并行流（<code>parallelStream</code>）。</td>
</tr>
<tr>
<td align="left"><strong>任务模型</strong></td>
<td align="left"><code>Runnable</code> &#x2F; <code>Callable</code></td>
<td align="left"><code>RecursiveTask</code>（有返回值） &#x2F; <code>RecursiveAction</code>（无返回值）。</td>
</tr>
<tr>
<td align="left"><strong>工作窃取</strong></td>
<td align="left">❌ 不支持</td>
<td align="left">✅ <strong>核心特性</strong>！空闲线程会从其他线程的队列尾部“窃取”任务，提高 CPU 利用率。</td>
</tr>
<tr>
<td align="left"><strong>适用场景</strong></td>
<td align="left">I&#x2F;O 任务、定时任务、通用异步处理。</td>
<td align="left">CPU 密集型、可分解的计算任务（如归并排序、矩阵运算、大数据处理）。</td>
</tr>
<tr>
<td align="left"><strong>创建方式</strong></td>
<td align="left">显式构造或 <code>Executors</code></td>
<td align="left"><code>ForkJoinPool.commonPool()</code>（公共池）或自定义构造。</td>
</tr>
<tr>
<td align="left"><strong>默认线程数</strong></td>
<td align="left"><code>Executors</code> 方法有不同</td>
<td align="left"><code>commonPool</code> 默认线程数为 <code>N_cpu - 1</code>。</td>
</tr>
</tbody></table>
<p><strong>简单说</strong>：</p>
<ul>
<li><strong>普通线程池</strong>：适合处理<strong>独立的、不可分割的任务</strong>。</li>
<li><strong><code>ForkJoinPool</code></strong>：适合处理<strong>一个大任务可以拆分成多个小任务并行执行，最后合并结果</strong>的场景，利用“工作窃取”机制高效利用多核 CPU。</li>
</ul>
<hr>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>线程池是 Java 并发编程的基石。掌握其原理、参数调优、拒绝策略、关闭方式和监控方法，是构建高性能、高可用服务的必备技能。记住：<strong>避免使用 <code>Executors</code> 的快捷方法，优先使用 <code>ThreadPoolExecutor</code> 自定义有界线程池</strong>，这是生产环境的最佳实践。</p>
<blockquote>
<p><strong>参考资料：</strong></p>
<ul>
<li>《Java 并发编程实战》</li>
<li>《深入理解 Java 虚拟机》</li>
<li>官方文档：<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ThreadPoolExecutor.html">https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ThreadPoolExecutor.html</a></li>
<li>太完整了！这是我见过最详细的线程池讲解了: <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/350067478">https://zhuanlan.zhihu.com/p/350067478</a></li>
<li>线程池工作流程: <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_51456741/article/details/132366151">https://blog.csdn.net/weixin_51456741/article/details/132366151</a></li>
</ul>
</blockquote>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.picgo.net/2025/06/23/tom09183405464859c2.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.picgo.net/2025/06/23/tom09183405464859c2.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">Joie</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/07/07/%E5%A4%9A%E7%BA%BF%E7%A8%8B_%E7%BA%BF%E7%A8%8B%E6%B1%A0/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/07/07/%E5%A4%9A%E7%BA%BF%E7%A8%8B_%E7%BA%BF%E7%A8%8B%E6%B1%A0/')">多线程_线程池</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/07/07/%E5%A4%9A%E7%BA%BF%E7%A8%8B_%E7%BA%BF%E7%A8%8B%E6%B1%A0/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=多线程_线程池&amp;url=http://example.com/2025/07/07/%E5%A4%9A%E7%BA%BF%E7%A8%8B_%E7%BA%BF%E7%A8%8B%E6%B1%A0/&amp;pic=https://img.picgo.net/2025/07/07/6c4064c88ff621702204e7fe46a464266ce0015884687e07.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>多线程<span class="tagsPageCount">9</span></a><a class="post-meta__box__tags" href="/tags/%E5%B9%B6%E5%8F%91/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>并发<span class="tagsPageCount">10</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://origin.picgo.net/2025/08/04/1464965-20191014121056510-1360079349c5670982b9c8f769.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/07/06/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic3.zhimg.com/v2-b59d18a44f75449af26f34fd65d938cc_1440w.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">动态规划</div></div></a></div><div class="next-post pull-right"><a href="/2025/07/10/%E5%A4%9A%E7%BA%BF%E7%A8%8B_%E5%85%B1%E4%BA%AB%E6%A8%A1%E5%9E%8B/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.picgo.net/2025/07/14/jmm706db083f71abac3.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">多线程_共享模型</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2025/08/27/%E5%A4%9A%E7%BA%BF%E7%A8%8B_AQS%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" title="多线程_AQS源码分析"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/08/29/aqs-letter-logo-design-on-black-background-aqs-creative-initials-letter-logo-concept-aqs-letter-design-vector23c92936b0e2ac9c.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-08-27</div><div class="title">多线程_AQS源码分析</div></div></a></div><div><a href="/2025/07/14/%E5%A4%9A%E7%BA%BF%E7%A8%8B_CompletableFuture/" title="多线程_CompletableFuture"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.picgo.net/2025/07/14/e16bbae9e8c14ccea5dbca7108afb50f2ce119221e21affb.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-14</div><div class="title">多线程_CompletableFuture</div></div></a></div><div><a href="/2025/07/14/%E5%A4%9A%E7%BA%BF%E7%A8%8B_Threadlocal/" title="多线程_Threadlocal"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://javaguide.cn/assets/1-YS5yhxvD.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-14</div><div class="title">多线程_Threadlocal</div></div></a></div><div><a href="/2025/07/10/%E5%A4%9A%E7%BA%BF%E7%A8%8B_%E5%85%B1%E4%BA%AB%E6%A8%A1%E5%9E%8B/" title="多线程_共享模型"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.picgo.net/2025/07/14/jmm706db083f71abac3.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-10</div><div class="title">多线程_共享模型</div></div></a></div><div><a href="/2025/07/04/%E5%A4%9A%E7%BA%BF%E7%A8%8B_%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="多线程基础知识"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.picgo.net/2025/07/04/d024edf10a2542f19a69f198fac4a202e6b996209c5c57bc.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-04</div><div class="title">多线程基础知识</div></div></a></div><div><a href="/2025/07/11/%E5%A4%9A%E7%BA%BF%E7%A8%8B_%E6%97%A0%E9%94%81%E5%B9%B6%E5%8F%91/" title="多线程_无锁并发"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.picgo.net/2025/07/14/97bc61de389a4e3aa6b605bf4df3a3296c4fffa8a9280cb3.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-11</div><div class="title">多线程_无锁并发</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.picgo.net/2025/06/23/tom09183405464859c2.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Joie</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/BenedictTom" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/372204786" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Java-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%B8%8E-Executor-%E6%A1%86%E6%9E%B6%E5%85%A8%E8%A7%A3%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">Java 线程池与 Executor 框架全解析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-number">1.1.</span> <span class="toc-text">目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%84%8F%E4%B9%89%E4%B8%8E%E4%BC%98%E5%8A%BF"><span class="toc-number">1.2.</span> <span class="toc-text">线程池的意义与优势</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Executor-%E6%A1%86%E6%9E%B6%E6%A6%82%E8%A7%88"><span class="toc-number">1.3.</span> <span class="toc-text">Executor 框架概览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%8E%A5%E5%8F%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-number">1.4.</span> <span class="toc-text">核心接口与实现类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Executor"><span class="toc-number">1.4.1.</span> <span class="toc-text">1. Executor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-ExecutorService"><span class="toc-number">1.4.2.</span> <span class="toc-text">2. ExecutorService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-ScheduledExecutorService"><span class="toc-number">1.4.3.</span> <span class="toc-text">3. ScheduledExecutorService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%B8%BB%E8%A6%81%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-number">1.4.4.</span> <span class="toc-text">4. 主要实现类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.</span> <span class="toc-text">线程池的创建与使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Executors-%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">1.5.1.</span> <span class="toc-text">1. Executors 工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">1.5.2.</span> <span class="toc-text">2. 线程池的基本用法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ThreadPoolExecutor-%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90"><span class="toc-number">1.6.</span> <span class="toc-text">ThreadPoolExecutor 深入解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%9E%84%E9%80%A0%E5%8F%82%E6%95%B0"><span class="toc-number">1.6.1.</span> <span class="toc-text">1. 构造参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.6.2.</span> <span class="toc-text">2. 线程池运行流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.3.</span> <span class="toc-text">3. 任务队列类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5"><span class="toc-number">1.6.4.</span> <span class="toc-text">4. 拒绝策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9B%91%E6%8E%A7%E4%B8%8E%E7%AE%A1%E7%90%86"><span class="toc-number">1.6.5.</span> <span class="toc-text">5. 线程池监控与管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%8F%82%E6%95%B0%E8%B0%83%E4%BC%98%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.7.</span> <span class="toc-text">线程池参数调优建议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B8%E5%9E%8B%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.8.</span> <span class="toc-text">典型应用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98"><span class="toc-number">1.9.</span> <span class="toc-text">常见面试问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93%E4%B8%8E%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.10.</span> <span class="toc-text">小结与注意事项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%AE%9E%E7%8E%B0%EF%BC%88%E4%BC%98%E5%8C%96%E7%89%88%EF%BC%89"><span class="toc-number">1.11.</span> <span class="toc-text">自定义线程池的实现（优化版）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%87%8D%E8%AF%95%E7%AD%96%E7%95%A5%EF%BC%88RetryPolicy%EF%BC%89"><span class="toc-number">1.11.0.1.</span> <span class="toc-text">2. 重试策略（RetryPolicy）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%99%8D%E7%BA%A7%E7%AD%96%E7%95%A5%EF%BC%88FallbackPolicy%EF%BC%89"><span class="toc-number">1.11.0.2.</span> <span class="toc-text">3. 降级策略（FallbackPolicy）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5%E9%80%89%E6%8B%A9%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.11.1.</span> <span class="toc-text">拒绝策略选择建议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%A0%B9%E6%8D%AE%E4%B8%9A%E5%8A%A1%E9%87%8D%E8%A6%81%E6%80%A7%E9%80%89%E6%8B%A9"><span class="toc-number">1.11.1.1.</span> <span class="toc-text">1. 根据业务重要性选择</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%A0%B9%E6%8D%AE%E7%B3%BB%E7%BB%9F%E8%B4%9F%E8%BD%BD%E9%80%89%E6%8B%A9"><span class="toc-number">1.11.1.2.</span> <span class="toc-text">2. 根据系统负载选择</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%A0%B9%E6%8D%AE%E7%9B%91%E6%8E%A7%E9%9C%80%E6%B1%82%E9%80%89%E6%8B%A9"><span class="toc-number">1.11.1.3.</span> <span class="toc-text">3. 根据监控需求选择</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.11.2.</span> <span class="toc-text">最佳实践</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87"><span class="toc-number">1.11.3.</span> <span class="toc-text">监控指标</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fork-Join"><span class="toc-number">1.12.</span> <span class="toc-text">Fork &#x2F; Join</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">1.12.1.</span> <span class="toc-text">核心组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.12.2.</span> <span class="toc-text">工作流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="toc-number">1.12.3.</span> <span class="toc-text">示例代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9%E4%B8%8E%E4%BC%98%E5%8A%BF"><span class="toc-number">1.12.4.</span> <span class="toc-text">特点与优势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%EF%BC%9F"><span class="toc-number">1.12.5.</span> <span class="toc-text">1. 线程池的工作原理？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-ThreadPoolExecutor-%E5%90%84%E5%8F%82%E6%95%B0%E5%90%AB%E4%B9%89%E5%8F%8A%E8%B0%83%E4%BC%98%E5%BB%BA%E8%AE%AE%EF%BC%9F"><span class="toc-number">1.12.6.</span> <span class="toc-text">2. ThreadPoolExecutor 各参数含义及调优建议？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9F"><span class="toc-number">1.12.7.</span> <span class="toc-text">3. 线程池的拒绝策略有哪些？适用场景？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Executors-%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E7%9A%84%E9%A3%8E%E9%99%A9%EF%BC%9F%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%9F%E4%BA%A7%E4%B8%8D%E6%8E%A8%E8%8D%90%EF%BC%9F"><span class="toc-number">1.12.8.</span> <span class="toc-text">4. Executors 工厂方法的风险？为什么生产不推荐？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E5%85%B3%E9%97%AD%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%9F"><span class="toc-number">1.12.9.</span> <span class="toc-text">5. 如何优雅关闭线程池？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2-OOM%EF%BC%9F"><span class="toc-number">1.12.10.</span> <span class="toc-text">6. 线程池如何防止 OOM？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9B%91%E6%8E%A7%E4%B8%8E%E8%B0%83%E4%BC%98%E5%AE%9E%E8%B7%B5%EF%BC%9F"><span class="toc-number">1.12.11.</span> <span class="toc-text">7. 线程池监控与调优实践？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%B8%8E-ForkJoinPool-%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-number">1.12.12.</span> <span class="toc-text">8. 线程池与 ForkJoinPool 区别？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.12.13.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/11/02/K8S-Helm/" title="K8S-HELM"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/08/04/1464965-20191014121056510-1360079349c5670982b9c8f769.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="K8S-HELM"/></a><div class="content"><a class="title" href="/2025/11/02/K8S-Helm/" title="K8S-HELM">K8S-HELM</a><time datetime="2025-11-02T15:01:31.371Z" title="Created 2025-11-02 23:01:31">2025-11-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/02/SSE&amp;Webocket/" title="Sse &amp;&amp; Websocket"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/11/02/sse6b68036f4ccfa9cc.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Sse &amp;&amp; Websocket"/></a><div class="content"><a class="title" href="/2025/11/02/SSE&amp;Webocket/" title="Sse &amp;&amp; Websocket">Sse &amp;&amp; Websocket</a><time datetime="2025-11-02T14:47:20.149Z" title="Created 2025-11-02 22:47:20">2025-11-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/23/%E5%A4%9A%E7%BA%BF%E7%A8%8B_%E8%99%9A%E6%8B%9F%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%BC%8F/" title="Java 虚拟线程模式详解：从原理到实践"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/10/23/1739c9e15974460f19.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java 虚拟线程模式详解：从原理到实践"/></a><div class="content"><a class="title" href="/2025/10/23/%E5%A4%9A%E7%BA%BF%E7%A8%8B_%E8%99%9A%E6%8B%9F%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%BC%8F/" title="Java 虚拟线程模式详解：从原理到实践">Java 虚拟线程模式详解：从原理到实践</a><time datetime="2025-10-23T10:10:39.474Z" title="Created 2025-10-23 18:10:39">2025-10-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/02/AI_MCP/" title="FunctionCall、Agent、Mcp"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/10/23/mcp3bc2d880cef29b025.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="FunctionCall、Agent、Mcp"/></a><div class="content"><a class="title" href="/2025/10/02/AI_MCP/" title="FunctionCall、Agent、Mcp">FunctionCall、Agent、Mcp</a><time datetime="2025-10-02T14:04:39.023Z" title="Created 2025-10-02 22:04:39">2025-10-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/26/Redis_List/" title="Redis_List"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/08/07/1eb94f064cf74b04865bdaf1b3c8e9be6939674b9205c975.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redis_List"/></a><div class="content"><a class="title" href="/2025/09/26/Redis_List/" title="Redis_List">Redis_List</a><time datetime="2025-09-26T06:03:11.297Z" title="Created 2025-09-26 14:03:11">2025-09-26</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><div id="runtimeTextTip"></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 By <a class="footer-bar-link" href="/" title="Joie" target="_blank">Joie</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = []
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">Articles</div><div class="length-num">95</div></a><a href="/tags/" title="tag"><div class="headline">Tags</div><div class="length-num">43</div></a><a href="/categories/" title="category"><div class="headline">Categories</div><div class="length-num">31</div></a></div><span class="sidebar-menu-item-title">Function</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="Display Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>Display Mode</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">个人主页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://benedicttom.github.io/home/" title="个人主页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="个人主页"/><span class="back-menu-item-text">个人主页</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI/" style="font-size: 0.88rem;">AI<sup>1</sup></a><a href="/tags/AMQP/" style="font-size: 0.88rem;">AMQP<sup>1</sup></a><a href="/tags/CI-CD/" style="font-size: 0.88rem;">CI/CD<sup>1</sup></a><a href="/tags/ElasticSearch/" style="font-size: 0.88rem;">ElasticSearch<sup>3</sup></a><a href="/tags/Hexo/" style="font-size: 0.88rem;">Hexo<sup>1</sup></a><a href="/tags/Http/" style="font-size: 0.88rem;">Http<sup>2</sup></a><a href="/tags/I-O/" style="font-size: 0.88rem;">I/O<sup>2</sup></a><a href="/tags/Java/" style="font-size: 0.88rem;">Java<sup>10</sup></a><a href="/tags/K8S/" style="font-size: 0.88rem;">K8S<sup>1</sup></a><a href="/tags/MongoDB/" style="font-size: 0.88rem;">MongoDB<sup>1</sup></a><a href="/tags/Mysql/" style="font-size: 0.88rem;">Mysql<sup>2</sup></a><a href="/tags/ORM/" style="font-size: 0.88rem;">ORM<sup>3</sup></a><a href="/tags/Python/" style="font-size: 0.88rem;">Python<sup>5</sup></a><a href="/tags/Redis/" style="font-size: 0.88rem;">Redis<sup>7</sup></a><a href="/tags/Redisson/" style="font-size: 0.88rem;">Redisson<sup>1</sup></a><a href="/tags/Rpc/" style="font-size: 0.88rem;">Rpc<sup>2</sup></a><a href="/tags/Spring/" style="font-size: 0.88rem;">Spring<sup>3</sup></a><a href="/tags/Spring-Cloud/" style="font-size: 0.88rem;">Spring Cloud<sup>5</sup></a><a href="/tags/Spring-Data/" style="font-size: 0.88rem;">Spring Data<sup>5</sup></a><a href="/tags/Swagger/" style="font-size: 0.88rem;">Swagger<sup>1</sup></a><a href="/tags/http/" style="font-size: 0.88rem;">http<sup>1</sup></a><a href="/tags/%E4%B8%9A%E5%8A%A1/" style="font-size: 0.88rem;">业务<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 0.88rem;">云原生<sup>1</sup></a><a href="/tags/%E5%85%AB%E8%82%A1/" style="font-size: 0.88rem;">八股<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" style="font-size: 0.88rem;">分布式锁<sup>1</sup></a><a href="/tags/%E5%8A%9B%E6%89%A3/" style="font-size: 0.88rem;">力扣<sup>10</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 0.88rem;">多线程<sup>9</sup></a><a href="/tags/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/" style="font-size: 0.88rem;">定时任务<sup>3</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 0.88rem;">并发<sup>10</sup></a><a href="/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" style="font-size: 0.88rem;">开发工具<sup>2</sup></a><a href="/tags/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/" style="font-size: 0.88rem;">异步编程<sup>1</sup></a><a href="/tags/%E6%8E%A8%E8%8D%90/" style="font-size: 0.88rem;">推荐<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 0.88rem;">数据结构<sup>1</sup></a><a href="/tags/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C/" style="font-size: 0.88rem;">权限校验<sup>4</sup></a><a href="/tags/%E6%A0%91/" style="font-size: 0.88rem;">树<sup>1</sup></a><a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 0.88rem;">消息队列<sup>5</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">算法<sup>2</sup></a><a href="/tags/%E7%BC%93%E5%AD%98/" style="font-size: 0.88rem;">缓存<sup>3</sup></a><a href="/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 0.88rem;">运维<sup>2</sup></a><a href="/tags/%E9%9B%86%E5%90%88/" style="font-size: 0.88rem;">集合<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2025 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2025 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Joie 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("04/01/2025 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "";
        img.title = "";
        img.alt = "";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>