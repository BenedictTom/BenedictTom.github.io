<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>权限校验_Shiro | Joie's Blog</title><meta name="keywords" content="权限校验"><meta name="author" content="Joie"><meta name="copyright" content="Joie"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="权限校验_Shiro"><meta name="application-name" content="权限校验_Shiro"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="权限校验_Shiro"><meta property="og:url" content="http://example.com/2025/07/24/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C_Shiro/index.html"><meta property="og:site_name" content="Joie's Blog"><meta property="og:description" content="SecurityManager在 Apache Shiro 中，SecurityManager 是整个安全框架的核心组件，它负责管理所有的安全相关的操作。下面将介绍 SecurityManager 的继承结构，并列举一些常用的实现类及其应用场景。 SecurityManager 继承结构 Secur"><meta property="og:locale" content="en"><meta property="og:image" content="https://img.picgo.net/2025/07/28/551994ea3dcf7d3b61c743.jpg"><meta property="article:author" content="Joie"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://img.picgo.net/2025/07/28/551994ea3dcf7d3b61c743.jpg"><meta name="description" content="SecurityManager在 Apache Shiro 中，SecurityManager 是整个安全框架的核心组件，它负责管理所有的安全相关的操作。下面将介绍 SecurityManager 的继承结构，并列举一些常用的实现类及其应用场景。 SecurityManager 继承结构 Secur"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/07/24/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C_Shiro/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"Here","backTitle":"Welcome"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":"api","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"Author: Joie","link":"Link: ","source":"Source: Joie's Blog","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.","copySuccess":"Copy success, copy and reprint please mark the address of this article"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Joie\'s Blog',
  title: '权限校验_Shiro',
  postAI: '',
  pageFillDescription: 'SecurityManager, SecurityManager 继承结构, 常用实现类及应用场景, SessionManager, SessionManager 继承结构及常用实现, SessionManager 继承结构, 常用实现类及场景, 常用 API, SimpleCookie, SimpleCookie 的主要作用, SimpleCookie 常用方法, 示例代码, AuthenticationInfo, AuthenticationInfo 继承结构, 常用实现类及场景, 常用 API, 场景应用, CredentialsMatcher, CredentialsMatcher 继承结构及常用实现, CredentialsMatcher 继承结构, 常用实现类及场景, 常用 API, 总结, Permission, Permission 接口, 常用的 Permission 实现类及其应用场景, 常用 API, 示例代码, 场景应用, SecurityUtils, SecurityUtils 的主要功能, 常用方法介绍, 获取当前用户（Subject）, 设置和获取 SecurityManager, 其他常用操作, 使用场景, 示例代码, ShiroFilterFactoryBean, 主要功能, 核心属性, 示例代码, 关键点解释, 使用场景, ShiroFilterChainDefinition, 主要功能, 为什么使用 ShiroFilterChainDefinition？, 实现示例, 关键点解释, 总结, 必须配置ShiroFilterFactoryBean？, 使用 Shiro Starter 的情况, 手动配置的情况, 示例：手动配置 ShiroFilterFactoryBean, 结论, 使用 Shiro Starter (shiro-spring-boot-web-starter), 步骤：, 手动配置 Shiro + Spring Boot 自动配置, 步骤：, 总结, ✅ 你的做法是完全正确的, 🧠 为什么可以不用 ShiroFilterFactoryBean？, 1. Shiro 自动配置机制, 2. ShiroFilterChainDefinition 是更高级别的抽象, 3. 自动创建 ShiroFilterFactoryBean, ✅ 什么时候需要手动配置 ShiroFilterFactoryBean？, 🔁 总结对比, ✅ 最佳实践建议, 📌 示例：两者结合使用, 自定义过滤器, 1. 创建自定义过滤器, 示例：创建一个简单的自定义过滤器, 2. 注册自定义过滤器, 示例：将自定义过滤器注册为 Bean 并添加到过滤器链, 3. 使用过滤器链, 注意事项, Shiro中的缓存机制, 使用 Java 配置, 1. 添加依赖, 2. 配置 CacheManager, 注意事项, CacheManager, CacheManager 概述, CacheManager 架构设置, 核心组件, 配置架构, 常用实现类, 开发中的常用 API, CacheManager, Cache, 在 Realm 中使用缓存, 分布式会话, 使用 Redis 实现 Shiro 分布式会话, 1. 添加依赖, 2. 配置 RedisSessionDAO, 3. 配置 SecurityManager, 4. 配置 Shiro Filter, 注意事项, 🧱 Shiro 中 AccessControlFilter 的完整继承结构（从上到下）, 🧩 各层级类说明, 1. javax.servlet.Filter（Java EE 标准接口）, 2. OncePerRequestFilter, 3. NameableFilter, 4. AdviceFilter, 5. PathMatchingFilter, 6. AccessControlFilter（关键抽象类）, 📌 常见子类说明, ✅ AuthenticatingFilter（认证相关）, ✅ AuthorizationFilter（授权相关）, ✅ ValidatingFilter（验证相关）, ✅ NoSessionCreationFilter, ✅ SslFilter, ✅ LogoutFilter, ✅ UserAgentFilter, 🧠 小结在中是整个安全框架的核心组件它负责管理所有的安全相关的操作下面将介绍的继承结构并列举一些常用的实现类及其应用场景继承结构接口这是安全管理器的顶级接口定义了安全管理的基本方法它涵盖了认证授权会话管理和加密等核心功能接口专门用于处理用户认证的接口默认实现为接口负责权限控制授权的接口默认实现为接口管理会话生命周期的接口提供了和分别用于应用和非应用接口缓存管理器接口用于缓存认证信息和授权信息以提高性能常见的实现有接口记住我功能的管理接口允许用户在关闭浏览器后仍然保持登录状态类这是的一个通用实现适用于大多数场景提供了对上述各个组件的支持类特别针对应用优化的实现集成了更多的相关特性如过滤器链等常用实现类及应用场景用途作为最基本的实现适合于各种类型的应用程序无论是桌面应用还是简单的命令行工具特点灵活性高可以自定义等组件场景当你需要完全控制每一个安全方面的细节时使用用途专为应用设计的安全管理器内置了许多与请求响应相关的功能特点支持基于的访问控制集成的链来保护资源场景任何基于技术栈构建的应用程序包括但不限于应用传统的应用等用途从文件中加载配置创建实例特点便于快速设置和测试但不适合生产环境场景开发阶段或小型项目中用于简化配置过程用途实现了接口通过连接到数据库进行身份验证和授权特点直接与关系型数据库交互支持标准查询场景当你的用户数据存储在关系型数据库中时使用用途根据具体需求定制实现特点高度可定制化可以根据不同的业务逻辑调整认证和授权策略场景对于有特殊安全需求的企业级应用来说非常有用继承结构及常用实现在中负责管理会话的生命周期它定义了如何创建访问和销毁会话的基本操作提供了灵活的接口以及多个具体的实现类来满足不同的应用场景需求继承结构接口定义了管理会话的基本方法如创建检索删除会话等类实现了接口提供了默认的会话管理功能适用于非应用程序类继承自特别为应用优化支持基于的会话管理类一个简单的会话管理器它直接使用容器如的会话机制而不是自己的会话管理机制常用实现类及场景用途用于非环境下的会话管理特点提供了一个基本的内存中的会话存储也可以配置为持久化到数据库或其他存储介质中场景适合桌面应用或命令行工具等不需要会话管理的应用场景用途针对应用设计的会话管理器可以与的过滤器链一起工作以保护资源特点提供了对和重写的内置支持并且允许你定制会话超时时间等参数场景适用于任何需要管理用户会话的应用程序例如应用用途利用容器提供的原生会话管理功能特点非常轻量级不包含特定的功能因此无法享受提供的高级特性如分布式会话场景当你希望尽可能减少对现有应用架构的影响或者已经有一个成熟的会话管理方案时使用常用以下是一些常用的相关创建一个新的会话实例根据给定的获取现有的会话实例获取设置当前使用的实例用于持久化会话数据获取设置全局会话超时时间毫秒适用于所有新创建的会话验证所有的活动会话是否已过期并清理过期会话这些可以帮助开发者有效地管理和维护用户的会话状态确保安全性和用户体验的一致性在中是一个用于处理的简单实现它提供了对的创建设置和读取等功能并且可以很容易地集成到的安全框架中特别是与和一起使用的主要作用会话管理使用来存储会话这样即使用户关闭浏览器后重新打开仍然可以通过恢复之前的会话状态记住我功能通过可以利用存储用户的登录状态即使用户的会话过期或关闭了浏览器只要未过期下次访问时就可以自动登录自定义属性开发者可以通过设置各种属性如的名称值路径域名有效期等从而更好地控制的行为常用方法和设置或获取的名称和设置或获取的值和设置或获取的最大存活时间秒如果设置为负数则表示只在当前浏览器会话期间有效如果设置为则表示立即删除该和设置或获取的路径只有当请求的路径与的路径匹配时浏览器才会发送该和设置或获取的域允许跨子域共享和设置或判断是否只能通过请求访问防止访问有助于防范攻击和设置或判断是否仅通过发送提高安全性示例代码以下是一个简单的例子展示了如何使用配置的记住我功能创建一个名为的实例设置的最大存活时间为天创建并设置上面创建的将配置到中在这个示例中我们创建了一个名为的并设置了它的最大存活时间为天然后我们将这个应用到了中最终将配置给的实现了记住我功能在中是一个接口用于封装从数据源如数据库等获取的认证信息它主要用于验证用户的身份信息是否正确下面将详细介绍的继承结构常用的实现类及其应用场景和常用继承结构接口定义了认证信息的基本结构包括主体和凭证它是所有认证信息对象的顶层接口类实现了接口提供了一个简单的认证信息实现通常用于存储用户名密码对或类似的简单认证信息类已废弃早期版本中存在现在已被弃用不再推荐使用类尽管不是直接继承自但每个都需要返回一个实现了接口的对象作为认证结果的一部分常用实现类及场景用途这是一个非常基础且通用的实现适用于大多数场景特点可以包含一个或多个主体以及一个凭证此外还可以附加一些其他信息比如角色或权限等场景几乎所有的应用程序都可以使用来表示认证信息特别是那些只需要用户名和密码进行身份验证的应用示例代码创建一个实例主体凭证名称常用尽管提供了许多有用的方法这里列出几个最常用的获取主体集合主体通常是用户的唯一标识符例如用户名获取凭证这通常是用户的密码或其哈希值如果在创建对象时提供了盐值则可以通过此方法获取和设置主体和凭证通常在创建实例后不需要调用这些方法因为可以在构造函数中直接指定场景应用基本认证流程在大多数情况下被用来封装用户提供的用户名和密码并与存储在数据库或其他安全存储中的哈希密码进行比较集成第三方认证服务当与或等第三方认证服务集成时也可以使用来封装从这些服务获得的认证信息自定义开发者可以根据自己的需求创建自定义的并在其中使用来封装认证信息例如在企业级应用中可能需要根据复杂的业务逻辑来决定如何认证用户通过理解和正确使用开发者能够有效地处理用户的身份验证过程确保应用程序的安全性和可靠性对于更复杂的需求还允许你实现自己的来满足特定的业务要求继承结构及常用实现在中是一个用于验证提交的凭证如密码是否与存储的凭证相匹配的重要接口它允许开发者自定义凭证匹配逻辑以适应不同的安全需求继承结构接口定义了方法该方法用于比较用户提供的凭证通常是从登录表单获取的和系统中存储的凭证通常是加密后的密码是否匹配类直接实现了接口提供了一个简单的基于等值比较的凭证匹配器适用于明文密码或者直接可比较的凭证类型类继承自专门用于处理哈希过的凭证例如等它支持对盐值的支持并且可以指定哈希算法以及迭代次数实现开发者可以根据具体的安全要求实现自己的比如集成第三方认证服务或使用更复杂的加密算法常用实现类及场景用途简单地比较两个凭证是否相同如果凭证是明文字符串或可以直接比较的数据则适合使用此匹配器特点不支持哈希或加密的凭证仅适用于非常基础的应用场景场景不适合生产环境中的应用因为安全性较低容易受到攻击用途专为处理经过哈希算法处理的凭证而设计支持多种哈希算法如等并且支持加盐以增加安全性特点可以通过设置哈希算法名称盐值位置哈希迭代次数等参数来增强安全性场景广泛应用于需要较高安全性的应用中特别是那些涉及敏感信息保护的情况示例代码设置哈希算法设置哈希迭代次数常用对于这里有一些常用的配置选项设置哈希算法名称如设置哈希算法的迭代次数增加这个值可以提高安全性但会增加计算时间设置是否将存储的凭证编码为十六进制字符串默认为设置盐值样式有可选决定如何处理盐值此外方法是核心方法用来实际执行凭证匹配在这个方法中会调用具体的来判断提交的凭证是否与存储的凭证相匹配总结选择合适的对于确保应用程序的安全至关重要对于大多数现代应用来说推荐使用因为它提供了更好的安全性特别是在处理用户密码时通过合理配置哈希算法盐值和迭代次数可以有效地防止诸如彩虹表攻击等常见的密码破解技术如果你的应用有特殊的安全需求也可以考虑实现自定义的在中是一个核心概念用于表示用户可以执行的操作或访问的资源权限是细粒度的安全控制机制允许你精确地定义哪些用户或角色能够对特定资源执行何种操作接口接口定义了如何检查某个身份是否被授权执行某一操作提供了几种不同的实现它们各自适用于不同场景常用的实现类及其应用场景用途这是默认的权限实现支持通过通配符来定义复杂的权限规则特点灵活且强大可以通过点分隔的字符串定义层次化的权限结构并使用通配符进行匹配格式例如表示可以在任何实例上创建用户示例执行更新用户的逻辑场景适用于大多数需要细粒度权限控制的应用场景尤其是当你的应用有复杂权限需求时较少使用用途基于位运算的权限实现主要用于需要高效处理大量权限的情况特点通过位掩码来表示权限虽然效率高但不够直观通常只在特殊情况下使用场景对于性能要求极高且权限体系相对简单的场景可能有用但在现代应用中不常见用途根据具体业务需求自定义权限实现特点灵活性强可以根据实际需求设计权限模型场景当你需要实现特定领域的权限模型时如基于图的权限管理基于时间窗口的权限等常用检查当前用户是否有指定权限检查当前用户是否拥有所有列出的权限如果当前用户没有指定权限则抛出异常和虽然不是直接与相关但在实际开发中经常配合使用用于检查用户的角色信息示例代码下面是一个使用的简单例子获取当前登录的用户检查用户是否具有指定权限或者使用更通用的权限检查强制性权限检查场景应用资源级权限控制在应用中可以为每个页面按钮甚至是请求设置权限确保只有授权用户才能访问或操作模块化权限管理对于大型企业级应用权限往往按照模块划分比如财务模块人力资源模块等使用可以方便地定义和管理这些模块的权限动态权限分配在某些场景下权限不是固定的而是根据用户行为或环境变化而改变例如在线教育平台中讲师可能只能对自己教授的课程拥有编辑权限这时可以通过动态生成权限字符串来实现这种灵活的权限控制是框架中的一个实用工具类它提供了静态方法来获取当前执行上下文的安全相关信息如当前用户即以及与安全管理器相关的操作它是连接应用程序代码和安全机制的桥梁的主要功能获取当前用户通过方法可以获取当前执行线程的对象表示当前用户或正在执行的代码的身份和权限设置和获取设置全局的实例返回当前应用中配置的创建无会话的匿名根据给定的创建一个新的实例这在测试或者需要临时创建非活跃的实例时非常有用常用方法介绍获取当前用户这是使用最频繁的方法之一用于获取当前执行环境下的你可以利用这个对象来进行认证授权等操作设置和获取设置获取在初始化环境时通常需要先设置一个实例之后可以通过方法在整个应用程序中访问它其他常用操作检查是否已认证用户已登录登录登出登录登出权限检查执行删除用户的逻辑使用场景身份验证通过获取后可以进行用户的身份验证操作权限控制在服务层或控制器层检查当前用户是否有执行某些操作的权限会话管理管理用户的会话信息例如获取会话属性注销会话等跨模块安全集成在不同的模块之间共享安全上下文确保一致的安全策略示例代码下面是一个简单的例子展示了如何使用来实现用户登录和权限检查获取当前用户创建用户名密码令牌登录权限检查登出是与集成时的一个核心组件它用于创建和配置实例是框架中的一个过滤器负责拦截所有进入应用的请求并根据配置的安全规则决定是否允许这些请求继续执行主要功能安全管理通过对象来管理安全相关的操作包括认证授权等过滤器链定义允许你为不同的定义不同的过滤器链从而实现细粒度的访问控制自定义过滤器支持添加自定义的过滤器以满足特定的安全需求未授权未登录处理可以设置当用户尝试访问无权限资源或未登录时跳转到的页面核心属性设置实例这是的核心组件负责所有的安全操作注册自定义过滤器键值对形式键为过滤器名称值为具体的过滤器实例定义和对应的过滤器链通常是一个结构键为模式值为相应的过滤器链如表示需要登录验证指定登录页面的如果用户未登录且试图访问受保护的资源时将被重定向到这里成功登录后的默认跳转地址未经授权的访问将被重定向至此示例代码下面是一个简单的配置示例设置注册自定义过滤器配置过滤链定义公共资源无需认证管理员角色可访问所有其他路径都需要认证设置登录页面设置未授权页面关键点解释过滤链定义匹配所有以开头的路径使用过滤器表示匿名访问即不需要任何认证即可访问只有拥有角色的用户才能访问以开头的所有路径所有其他路径都需要经过过滤器进行认证和当用户尝试访问需要认证但尚未登录的资源时会被重定向到设置的登录页面当用户尝试访问没有权限的资源时会被重定向到未授权页面使用场景应用的安全控制通过可以为你的应用添加强大的安全控制机制确保只有经过认证并具有适当权限的用户才能访问特定资源安全性除了传统的页面外也可以用来保护接口确保只有合法的客户端能够调用这些接口中用于定义过滤器链的一个接口它允许开发者以一种结构化的方式为不同的模式指定相应的过滤器链从而实现细粒度的安全控制在环境下通过实现接口可以灵活地配置哪些需要进行认证授权等安全检查主要功能模式与过滤器的映射允许你为不同的模式指定一个或多个过滤器这样当请求匹配某个模式时对应的过滤器链就会被应用支持多种内置过滤器如需要登录角色检查权限检查匿名访问无需认证等自定义过滤器除了使用提供的内置过滤器外还可以注册和使用自定义的过滤器为什么使用在传统的配置中我们通常会直接在中通过方法来设置过滤器链然而使用可以提供更加灵活和模块化的配置方式特别是在环境下它可以让你更好地组织和管理你的过滤器链配置实现示例下面是一个简单的示例展示了如何在应用中实现来配置过滤器链定义过滤器链允许匿名访问的资源需要管理员角色才能访问的资源所有其他路径都需要认证如果你需要进一步定制的行为可能还需要配置获取之前定义的过滤器链在这个例子中我们创建了一个的实例并为其添加了几个过滤器链规则允许匿名访问即不需要任何认证即可访问这些资源只有拥有角色的用户才能访问这些资源所有其他路径都需要经过认证关键点解释这里使用而不是普通的因为过滤器链定义是有顺序的可以保证插入顺序从而确保优先级较高的规则先被匹配第一个参数是模式第二个参数是过滤器链字符串可以包含多个过滤器名称中间用逗号分隔将模式和对应的过滤器链添加到中总结提供了一种灵活且易于维护的方式来配置的过滤器链通过这种方式你可以轻松地为应用程序的不同部分设置适当的安全策略无论是保护还是页面这种配置方法特别适合于应用程序因为它能够很好地与其他组件集成使得整个安全配置过程更加简洁明了必须配置在项目中集成时是否需要配置取决于你选择的集成方式简单来说如果你使用提供的如那么大部分的基础配置会被自动处理包括创建和配置在这种情况下你可能不需要手动配置除非你需要进行一些自定义设置如果选择手动集成到你的应用程序中则需要你自己创建并配置以便能够正确地设置过滤器链安全管理器等关键组件使用的情况当你通过添加依赖来集成时许多默认配置已经被预先设置好例如和基本的配置可能会被自动加载你可以通过简单的配置文件如或来调整一些基础设置但是对于更复杂的需求或自定义逻辑仍然可能需要提供额外的配置类来覆盖默认行为手动配置的情况在手动配置的情况下你需要明确地定义并为其设置必要的属性比如过滤器链定义登录页面等这是因为你需要完全控制如何初始化的核心组件以及它们之间的交互方式示例手动配置下面是一个手动配置的简化示例设置注册自定义过滤器配置过滤器链定义公共资源无需认证管理员角色可访问所有其他路径都需要认证设置登录页面设置未授权页面结论对于大多数标准需求使用的包通常就足够了它提供了足够的灵活性和简便性来满足常见的安全需求而无需手动配置当你的项目有特殊的安全需求如复杂的权限模型特定的过滤器逻辑或是对现有流程的高度定制化要求时则可能需要手动配置以实现这些高级功能因此是否需要配置主要取决于项目的具体需求以及你所选择的集成方法在使用与集成时有两种常见的方法一种是通过使用提供的另一种是手动配置的各个组件这两种方式的主要区别在于配置的自动化程度和灵活性使用提供了一个专门针对的它简化了的集成过程使得开发者可以更快地开始使用的功能而不需要过多的手动配置步骤添加依赖在你的文件中加入的依赖确保使用最新版本配置文件可以在或中配置一些基本的设置自定义创建一个继承自的类来实现用户认证和授权逻辑实现和方法自动配置会自动扫描并注册必要的如等你只需要提供自定义的和其他可能需要的配置即可手动配置自动配置在这种方式下你需要手动创建并配置的核心组件如等但是依然可以利用的特性来简化一些工作步骤添加依赖同样需要添加和的依赖但不一定是包根据实际情况选择版本创建配置类编写一个配置类来初始化的各个组件其他配置自定义这部分与方式相同你需要实现自己的类来处理认证和授权逻辑配置过滤器链在上面的方法中配置过滤器链定义哪些需要进行安全控制启用由于没有来自动完成这些步骤你需要确保所有必需的都被正确创建并且在应用启动时能够正常工作总结方式更加简单快捷适合快速开发和标准化项目因为很多默认设置已经为你准备好只需少量配置或自定义代码即可运行手动配置方式提供了更高的灵活性允许你完全掌控的每一个细节适合对安全性有特殊要求或需要定制化解决方案的情况根据你的需求选择合适的方式来集成到应用中如果你想要快速上手并且不需要太多自定义设置那么使用是最好的选择反之如果你需要更多的控制权则可以选择手动配置的方式是的你提到的通过直接注入的方式是在中推荐的一种更现代更简洁的配置方式而且确实可以不使用来手动配置过滤器链下面我们来详细解释你的做法是完全正确的你使用了这种方式是官方从版本开始推荐的基于的配置方式它通过声明一个来替代传统的配置为什么可以不用自动配置机制当你使用了的如时已经通过自动配置类如为你配置好了以及的创建逻辑如果检测到是更高级别的抽象是一个接口用于定义路径和过滤器链的映射关系它比更加模块化易于维护是其默认实现它的职责是定义到的映射关系自动创建在的自动配置中如果检测到你定义了则会自动创建并配置并将你定义的链规则应用上去你可以理解为自动配置伪代码注册为什么时候需要手动配置虽然简化了配置但在以下场景中你仍然需要手动配置场景是否需要手动配置只需配置过滤器链如不需要需要自定义过滤器如验证码等需要需要设置登录页成功页未授权页需要需要设置全局配置需要需要自定义需要总结对比方式是否推荐适用场景是否需要推荐简单过滤器链配置不需要必要时高级定制自定义过滤器跳转页等需要最佳实践建议如果你只是配置基本的权限控制如使用就足够了如果你需要添加自定义过滤器设置登录页面登出处理等高级功能可以在配置的基础上再手动配置示例两者结合使用这样可以同时利用自动配置和手动配置的优势实现更灵活的安全策略自定义过滤器在中自定义过滤器可以让你扩展或修改默认的安全行为以满足特定的应用需求下面是如何创建和配置自定义过滤器的详细步骤创建自定义过滤器首先你需要创建一个类继承或其他合适的基类如然后根据需要覆盖相应的方法来实现你的逻辑示例创建一个简单的自定义过滤器判断是否允许访问资源返回表示允许访问表示拒绝访问这里只是示例实际逻辑需要你根据业务需求编写当访问被拒绝时的操作可以在这里执行重定向返回错误信息等操作返回表示继续处理下一个过滤器返回表示已经处理完毕不再继续方法用于判断当前请求是否有权限访问指定的资源方法则是在返回时调用你可以在此方法中处理访问被拒绝的情况例如重定向到登录页面或者返回错误信息注册自定义过滤器接下来在配置类中注册这个自定义过滤器并将其添加到过滤器链中示例将自定义过滤器注册为并添加到过滤器链添加自定义过滤器到路径注册自定义过滤器将自定义过滤器添加到中这里我们通过方法将自定义过滤器添加到了的过滤器集合中并在过滤器链定义中使用来引用这个过滤器使用过滤器链现在任何对路径下的请求都会经过处理你可以根据业务需求调整和方法中的逻辑注意事项顺序如果你有多个过滤器作用于同一个模式请注意它们的执行顺序通常更具体的规则应该放在前面异常处理确保在自定义过滤器中正确处理异常情况避免因为未捕获的异常导致请求流程中断性能考虑对于高并发场景尽量保持过滤器逻辑简单高效减少不必要的计算或数据库查询中的缓存机制在使用的或类似的时设置可以通过配置类或利用的自动配置功能来完成虽然和提供了灵活的配置选项但默认情况下并没有直接提供针对缓存的配置文件如或不过你可以通过编写配置类或者扩展自动配置来集成和配置使用配置通常情况下你将需要创建一个配置类来定义并将其注入到的中下面是一个如何为配置缓存的例子添加依赖首先确保你的项目中包含了必要的依赖项例如和支持库确保选择与版本兼容的版本配置接下来你需要创建一个配置类来设置这里我们以为例设置连接信息如果有密码其他过滤器链等配置注意事项缓存过期时间根据业务需求调整缓存的有效期避免因缓存中的数据更新不及时导致的安全问题分布式环境下的缓存一致性如果你的应用部署在一个分布式环境中确保所有节点之间的缓存同步例如使用这样的集中式缓存解决方案可以帮助解决这个问题缓存大小限制合理设置缓存的最大容量避免因缓存过大而导致内存溢出或其他性能问题概述在中是一个用于管理缓存实例的接口它为提供了统一的缓存抽象层使得开发者可以方便地将不同的缓存技术如等集成到的认证和授权流程中而无需关心具体的缓存实现细节通过可以显著提升性能尤其是在处理大量并发请求时架构设置核心组件这是缓存体系的核心接口负责创建和管理实例表示一个具体的数据缓存每个实例都与特定的命名空间相关联用于存储特定类型的数据例如认证信息或授权信息的核心安全管理器通常会配置一个来优化其性能安全领域对象代表了一个数据源可以通过配置来使用提供的缓存功能配置架构通常情况下你需要执行以下步骤来设置选择并配置一个合适的实现将其注入到和相关的中启用的缓存功能以便利用缓存加速认证和授权过程常用实现类支持多种实现以下是几个常见的例子基于实现的缓存管理器适合于需要内存级高速缓存的应用场景来自第三方库如果你正在使用作为缓存后端可以选择此实现这是一种简单的内存缓存管理器适用于小规模应用或开发测试环境开发中的常用获取指定名称的缓存实例如果该名称的缓存不存在则可能会自动创建一个新的缓存实例取决于具体实现将给定的键值对放入缓存中根据给定的键检索缓存中的值从缓存中移除指定键对应的条目清空整个缓存在中使用缓存为了在中启用缓存你可以这样做启用缓存启用认证缓存启用授权缓存设置缓存管理器分布式会话在分布式环境中确保会话数据的一致性和可用性是一个关键挑战对于而言实现分布式会话管理通常涉及到将的会话存储从默认的内存或本地文件系统迁移到一个分布式的存储解决方案如数据库或其他支持分布式访问的存储系统以下是如何使用来实现分布式会话管理的示例使用实现分布式会话添加依赖首先你需要添加必要的依赖项包括和集成库确保选择与你的版本兼容的库版本根据需要选择合适的版本同时不要忘记添加相关的依赖配置接下来在配置类中配置以便可以将数据存储到中如果有密码这里的关键是它负责与进行交互来存储和检索的会话信息配置确保将注入到中配置最后别忘了配置的过滤器链定义虽然这部分与分布式会话无直接关系但它对于整个安全框架的运行至关重要定义你的过滤器链规则注意事项序列化由于是基于键值对存储的因此所有存储在中的对象都需要能够被序列化确保你的会话对象实现了接口过期时间根据业务需求设置适当的会话超时时间并确保中存储的会话数据也遵循这一策略安全性考虑对存储在中的敏感信息进行加密处理防止未授权访问的是其安全过滤器体系中的一个核心抽象类用于控制对资源的访问它位于包下是许多具体安全过滤器的基类下面我将为你详细列出的完整继承结构并以文字结构图的方式呈现由于无法画图用缩进表示继承关系同时对每个类进行简要说明中的完整继承结构从上到下各层级类说明标准接口所有过滤器的顶级接口定义了方法或实现确保每个请求只被过滤一次防止在请求处理过程中被多次调用为过滤器提供一个名称用于在配置中引用提供类似的拦截能力提供了等生命周期方法支持基于路径匹配的过滤器可以通过配置指定哪些路径需要该过滤器生效关键抽象类提供了访问控制的基础逻辑定义了两个关键方法判断是否允许访问当访问被拒绝时执行的逻辑常见子类说明认证相关用于处理认证逻辑的基类子类包括认证表单登录允许匿名访问已登录用户可访问踢出重复登录用户授权相关用于处理授权逻辑的基类子类包括按角色控制访问按权限控制访问按端口限制访问验证相关用于验证或子类如禁止创建新会话适用于无状态强制使用访问处理登出逻辑根据进行访问控制小结是中所有安全过滤器的基类它提供了访问控制的通用逻辑它的子类分为认证类和授权类两大类实际开发中你可以通过继承或其子类来自定义过滤器实现特定的认证授权逻辑的过滤器体系设计清晰层次分明适合扩展和集成参考资料集成配置集成十八整合整合实现认证和权限鉴定实现基于实现的单点登录系统实现登录授权单点登录',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-07-29 16:07:19',
  postMainColor: '#5b144dff',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://img.picgo.net/2025/06/23/tom09183405464859c2.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">个人主页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://benedicttom.github.io/home/" title="个人主页"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="个人主页"/><span class="back-menu-item-text">个人主页</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">Joie's Blog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> Newest Comments</span></div><div class="aside-list"><span>loading...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AMQP/" style="font-size: 1.05rem;">AMQP<sup>1</sup></a><a href="/tags/CI-CD/" style="font-size: 1.05rem;">CI/CD<sup>1</sup></a><a href="/tags/ElasticSearch/" style="font-size: 1.05rem;">ElasticSearch<sup>3</sup></a><a href="/tags/Hexo/" style="font-size: 1.05rem;">Hexo<sup>1</sup></a><a href="/tags/Http/" style="font-size: 1.05rem;">Http<sup>2</sup></a><a href="/tags/Java/" style="font-size: 1.05rem;">Java<sup>6</sup></a><a href="/tags/MongoDB/" style="font-size: 1.05rem;">MongoDB<sup>1</sup></a><a href="/tags/Mysql/" style="font-size: 1.05rem;">Mysql<sup>2</sup></a><a href="/tags/ORM/" style="font-size: 1.05rem;">ORM<sup>2</sup></a><a href="/tags/Python/" style="font-size: 1.05rem;">Python<sup>3</sup></a><a href="/tags/Redis/" style="font-size: 1.05rem;">Redis<sup>5</sup></a><a href="/tags/Rpc/" style="font-size: 1.05rem;">Rpc<sup>2</sup></a><a href="/tags/Spring-Cloud/" style="font-size: 1.05rem;">Spring Cloud<sup>3</sup></a><a href="/tags/Spring-Data/" style="font-size: 1.05rem;">Spring Data<sup>5</sup></a><a href="/tags/Swagger/" style="font-size: 1.05rem;">Swagger<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 1.05rem;">云原生<sup>1</sup></a><a href="/tags/%E5%85%AB%E8%82%A1/" style="font-size: 1.05rem;">八股<sup>1</sup></a><a href="/tags/%E5%8A%9B%E6%89%A3/" style="font-size: 1.05rem;">力扣<sup>10</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 1.05rem;">多线程<sup>7</sup></a><a href="/tags/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/" style="font-size: 1.05rem;">定时任务<sup>3</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 1.05rem;">并发<sup>7</sup></a><a href="/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" style="font-size: 1.05rem;">开发工具<sup>2</sup></a><a href="/tags/%E6%8E%A8%E8%8D%90/" style="font-size: 1.05rem;">推荐<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 1.05rem;">数据结构<sup>4</sup></a><a href="/tags/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C/" style="font-size: 1.05rem;">权限校验<sup>3</sup></a><a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 1.05rem;">架构<sup>1</sup></a><a href="/tags/%E6%A0%91/" style="font-size: 1.05rem;">树<sup>1</sup></a><a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 1.05rem;">消息队列<sup>4</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">算法<sup>1</sup></a><a href="/tags/%E7%BC%93%E5%AD%98/" style="font-size: 1.05rem;">缓存<sup>2</sup></a><a href="/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 1.05rem;">运维<sup>2</sup></a><a href="/tags/%E9%9B%86%E5%90%88/" style="font-size: 1.05rem;">集合<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>Archives</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/08/"><span class="card-archive-list-date">August 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">31</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">July 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">28</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">June 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C/" itemprop="url">权限校验</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>权限校验</span></a></span></div></div><h1 class="post-title" itemprop="name headline">权限校验_Shiro</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-07-24T03:16:16.534Z" title="Created 2025-07-24 11:16:16">2025-07-24</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-07-29T08:07:19.933Z" title="Updated 2025-07-29 16:07:19">2025-07-29</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为北京"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>北京</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://img.picgo.net/2025/07/28/551994ea3dcf7d3b61c743.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/07/24/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C_Shiro/"><header><a class="post-meta-categories" href="/categories/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C/" itemprop="url">权限校验</a><a href="/tags/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C/" tabindex="-1" itemprop="url">权限校验</a><h1 id="CrawlerTitle" itemprop="name headline">权限校验_Shiro</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Joie</span><time itemprop="dateCreated datePublished" datetime="2025-07-24T03:16:16.534Z" title="Created 2025-07-24 11:16:16">2025-07-24</time><time itemprop="dateCreated datePublished" datetime="2025-07-29T08:07:19.933Z" title="Updated 2025-07-29 16:07:19">2025-07-29</time></header><h2 id="SecurityManager"><a href="#SecurityManager" class="headerlink" title="SecurityManager"></a>SecurityManager</h2><p>在 Apache Shiro 中，<code>SecurityManager</code> 是整个安全框架的核心组件，它负责管理所有的安全相关的操作。下面将介绍 <code>SecurityManager</code> 的继承结构，并列举一些常用的实现类及其应用场景。</p>
<h3 id="SecurityManager-继承结构"><a href="#SecurityManager-继承结构" class="headerlink" title="SecurityManager 继承结构"></a>SecurityManager 继承结构</h3><ol>
<li><p><strong>SecurityManager 接口</strong>：</p>
<ul>
<li>这是 Shiro 安全管理器的顶级接口，定义了安全管理的基本方法。它涵盖了认证、授权、会话管理和加密等核心功能。</li>
</ul>
</li>
<li><p><strong>Authenticator 接口</strong>：</p>
<ul>
<li>专门用于处理用户认证的接口。默认实现为 <code>ModularRealmAuthenticator</code>。</li>
</ul>
</li>
<li><p><strong>Authorizer 接口</strong>：</p>
<ul>
<li>负责权限控制（授权）的接口。默认实现为 <code>ModularRealmAuthorizer</code>。</li>
</ul>
</li>
<li><p><strong>SessionManager 接口</strong>：</p>
<ul>
<li>管理会话生命周期的接口。Shiro 提供了 <code>DefaultWebSessionManager</code> 和 <code>DefaultSessionManager</code> 分别用于 Web 应用和非 Web 应用。</li>
</ul>
</li>
<li><p><strong>CacheManager 接口</strong>：</p>
<ul>
<li>缓存管理器接口，用于缓存认证信息和授权信息以提高性能。常见的实现有 <code>EhCacheManager</code>。</li>
</ul>
</li>
<li><p><strong>RememberMeManager 接口</strong>：</p>
<ul>
<li>记住我功能的管理接口，允许用户在关闭浏览器后仍然保持登录状态。</li>
</ul>
</li>
<li><p><strong>DefaultSecurityManager 类</strong>：</p>
<ul>
<li>这是 <code>SecurityManager</code> 的一个通用实现，适用于大多数场景，提供了对上述各个组件的支持。</li>
</ul>
</li>
<li><p><strong>DefaultWebSecurityManager 类</strong>：</p>
<ul>
<li>特别针对 Web 应用优化的 <code>SecurityManager</code> 实现，集成了更多的 Web 相关特性，如过滤器链等。</li>
</ul>
</li>
</ol>
<h3 id="常用实现类及应用场景"><a href="#常用实现类及应用场景" class="headerlink" title="常用实现类及应用场景"></a>常用实现类及应用场景</h3><ul>
<li><p><strong>DefaultSecurityManager</strong>：</p>
<ul>
<li><strong>用途</strong>：作为最基本的 <code>SecurityManager</code> 实现，适合于各种类型的应用程序，无论是桌面应用还是简单的命令行工具。</li>
<li><strong>特点</strong>：灵活性高，可以自定义 Authenticator, Authorizer, SessionManager 等组件。</li>
<li><strong>场景</strong>：当你需要完全控制每一个安全方面的细节时使用。</li>
</ul>
</li>
<li><p><strong>DefaultWebSecurityManager</strong>：</p>
<ul>
<li><strong>用途</strong>：专为 Web 应用设计的安全管理器，内置了许多与 HTTP 请求&#x2F;响应相关的功能。</li>
<li><strong>特点</strong>：支持基于 URL 的访问控制，集成 Shiro 的 Filter 链来保护 Web 资源。</li>
<li><strong>场景</strong>：任何基于 Web 技术栈构建的应用程序，包括但不限于 Spring Boot Web 应用、传统的 Servlet 应用等。</li>
</ul>
</li>
<li><p><strong>IniSecurityManagerFactory</strong>：</p>
<ul>
<li><strong>用途</strong>：从 INI 文件中加载配置创建 <code>SecurityManager</code> 实例。</li>
<li><strong>特点</strong>：便于快速设置和测试，但不适合生产环境。</li>
<li><strong>场景</strong>：开发阶段或小型项目中用于简化配置过程。</li>
</ul>
</li>
<li><p><strong>JdbcRealm &#x2F; JndiJdbcRealm</strong>：</p>
<ul>
<li><strong>用途</strong>：实现了 Realm 接口，通过 JDBC 连接到数据库进行身份验证和授权。</li>
<li><strong>特点</strong>：直接与关系型数据库交互，支持标准 SQL 查询。</li>
<li><strong>场景</strong>：当你的用户数据存储在关系型数据库中时使用。</li>
</ul>
</li>
<li><p><strong>Custom Realm</strong>：</p>
<ul>
<li><strong>用途</strong>：根据具体需求定制 Realm 实现。</li>
<li><strong>特点</strong>：高度可定制化，可以根据不同的业务逻辑调整认证和授权策略。</li>
<li><strong>场景</strong>：对于有特殊安全需求的企业级应用来说非常有用。</li>
</ul>
</li>
</ul>
<h2 id="SessionManager"><a href="#SessionManager" class="headerlink" title="SessionManager"></a>SessionManager</h2><h3 id="SessionManager-继承结构及常用实现"><a href="#SessionManager-继承结构及常用实现" class="headerlink" title="SessionManager 继承结构及常用实现"></a>SessionManager 继承结构及常用实现</h3><p>在 Apache Shiro 中，<code>SessionManager</code> 负责管理会话的生命周期。它定义了如何创建、访问和销毁会话的基本操作。Shiro 提供了灵活的 <code>SessionManager</code> 接口以及多个具体的实现类来满足不同的应用场景需求。</p>
<h4 id="SessionManager-继承结构"><a href="#SessionManager-继承结构" class="headerlink" title="SessionManager 继承结构"></a>SessionManager 继承结构</h4><ol>
<li><p><strong>SessionManager 接口</strong>：</p>
<ul>
<li>定义了管理会话的基本方法，如创建、检索、删除会话等。</li>
</ul>
</li>
<li><p><strong>DefaultSessionManager 类</strong>：</p>
<ul>
<li>实现了 <code>SessionManager</code> 接口，提供了默认的会话管理功能，适用于非 Web 应用程序。</li>
</ul>
</li>
<li><p><strong>DefaultWebSessionManager 类</strong>：</p>
<ul>
<li>继承自 <code>DefaultSessionManager</code>，特别为 Web 应用优化，支持基于 HTTP 的会话管理。</li>
</ul>
</li>
<li><p><strong>ServletContainerSessionManager 类</strong>：</p>
<ul>
<li>一个简单的 Web 会话管理器，它直接使用 Servlet 容器（如 Tomcat）的会话机制而不是 Shiro 自己的会话管理机制。</li>
</ul>
</li>
</ol>
<h4 id="常用实现类及场景"><a href="#常用实现类及场景" class="headerlink" title="常用实现类及场景"></a>常用实现类及场景</h4><ul>
<li><p><strong>DefaultSessionManager</strong>：</p>
<ul>
<li><strong>用途</strong>：用于非 Web 环境下的会话管理。</li>
<li><strong>特点</strong>：提供了一个基本的内存中的会话存储，也可以配置为持久化到数据库或其他存储介质中。</li>
<li><strong>场景</strong>：适合桌面应用或命令行工具等不需要 HTTP 会话管理的应用场景。</li>
</ul>
</li>
<li><p><strong>DefaultWebSessionManager</strong>：</p>
<ul>
<li><strong>用途</strong>：针对 Web 应用设计的会话管理器，可以与 Shiro 的过滤器链一起工作以保护 Web 资源。</li>
<li><strong>特点</strong>：提供了对 Cookie 和 URL 重写的内置支持，并且允许你定制会话超时时间等参数。</li>
<li><strong>场景</strong>：适用于任何需要管理用户会话的 Web 应用程序，例如 Spring Boot Web 应用。</li>
</ul>
</li>
<li><p><strong>ServletContainerSessionManager</strong>：</p>
<ul>
<li><strong>用途</strong>：利用 Servlet 容器提供的原生会话管理功能。</li>
<li><strong>特点</strong>：非常轻量级，不包含 Shiro 特定的功能，因此无法享受 Shiro 提供的高级特性如分布式会话。</li>
<li><strong>场景</strong>：当你希望尽可能减少对现有应用架构的影响，或者已经有一个成熟的会话管理方案时使用。</li>
</ul>
</li>
</ul>
<h4 id="常用-API"><a href="#常用-API" class="headerlink" title="常用 API"></a>常用 API</h4><p>以下是一些常用的 <code>SessionManager</code> 相关 API：</p>
<ul>
<li><p><strong>createSession()</strong>：</p>
<ul>
<li>创建一个新的会话实例。</li>
</ul>
</li>
<li><p><strong>getSession(SessionKey key)</strong>：</p>
<ul>
<li>根据给定的 <code>SessionKey</code> 获取现有的会话实例。</li>
</ul>
</li>
<li><p><strong>getSessionDAO() &#x2F; setSessionDAO(SessionDAO sessionDAO)</strong>：</p>
<ul>
<li>获取&#x2F;设置当前使用的 <code>SessionDAO</code> 实例，用于持久化会话数据。</li>
</ul>
</li>
<li><p><strong>getGlobalSessionTimeout() &#x2F; setGlobalSessionTimeout(long globalSessionTimeout)</strong>：</p>
<ul>
<li>获取&#x2F;设置全局会话超时时间（毫秒），适用于所有新创建的会话。</li>
</ul>
</li>
<li><p><strong>validateSessions()</strong>：</p>
<ul>
<li>验证所有的活动会话是否已过期，并清理过期会话。</li>
</ul>
</li>
</ul>
<p>这些 API 可以帮助开发者有效地管理和维护用户的会话状态，确保安全性和用户体验的一致性。</p>
<h2 id="SimpleCookie"><a href="#SimpleCookie" class="headerlink" title="SimpleCookie"></a>SimpleCookie</h2><p>在 Apache Shiro 中，<code>SimpleCookie</code> 是一个用于处理 HTTP Cookie 的简单实现。它提供了对 Cookie 的创建、设置和读取等功能，并且可以很容易地集成到 Shiro 的安全框架中，特别是与 <code>SessionManager</code> 和 <code>RememberMeManager</code> 一起使用。</p>
<h3 id="SimpleCookie-的主要作用"><a href="#SimpleCookie-的主要作用" class="headerlink" title="SimpleCookie 的主要作用"></a>SimpleCookie 的主要作用</h3><ol>
<li><p><strong>会话管理</strong>：Shiro 使用 <code>SimpleCookie</code> 来存储会话 ID（sessionId），这样即使用户关闭浏览器后重新打开，仍然可以通过 Cookie 恢复之前的会话状态。</p>
</li>
<li><p><strong>记住我功能（Remember Me）</strong>：通过 <code>RememberMeManager</code>，Shiro 可以利用 <code>SimpleCookie</code> 存储用户的登录状态。即使用户的会话过期或关闭了浏览器，只要 Cookie 未过期，下次访问时就可以自动登录。</p>
</li>
<li><p><strong>自定义 Cookie 属性</strong>：开发者可以通过 <code>SimpleCookie</code> 设置各种属性，如 cookie 的名称、值、路径、域名、有效期等，从而更好地控制 Cookie 的行为。</p>
</li>
</ol>
<h3 id="SimpleCookie-常用方法"><a href="#SimpleCookie-常用方法" class="headerlink" title="SimpleCookie 常用方法"></a>SimpleCookie 常用方法</h3><ul>
<li><p><strong>setName(String name)</strong> 和 <strong>getName()</strong>：</p>
<ul>
<li>设置或获取 Cookie 的名称。</li>
</ul>
</li>
<li><p><strong>setValue(String value)</strong> 和 <strong>getValue()</strong>：</p>
<ul>
<li>设置或获取 Cookie 的值。</li>
</ul>
</li>
<li><p><strong>setMaxAge(int maxAge)</strong> 和 <strong>getMaxAge()</strong>：</p>
<ul>
<li>设置或获取 Cookie 的最大存活时间（秒）。如果设置为负数，则表示 Cookie 只在当前浏览器会话期间有效；如果设置为0，则表示立即删除该 Cookie。</li>
</ul>
</li>
<li><p><strong>setPath(String path)</strong> 和 <strong>getPath()</strong>：</p>
<ul>
<li>设置或获取 Cookie 的路径。只有当请求的 URL 路径与 Cookie 的路径匹配时，浏览器才会发送该 Cookie。</li>
</ul>
</li>
<li><p><strong>setDomain(String domain)</strong> 和 <strong>getDomain()</strong>：</p>
<ul>
<li>设置或获取 Cookie 的域。允许跨子域共享 Cookie。</li>
</ul>
</li>
<li><p><strong>setHttpOnly(boolean httpOnly)</strong> 和 <strong>isHttpOnly()</strong>：</p>
<ul>
<li>设置或判断 Cookie 是否只能通过 HTTP(S) 请求访问，防止 JavaScript 访问，有助于防范 XSS 攻击。</li>
</ul>
</li>
<li><p><strong>setSecure(boolean secure)</strong> 和 <strong>isSecure()</strong>：</p>
<ul>
<li>设置或判断是否仅通过 HTTPS 发送 Cookie，提高安全性。</li>
</ul>
</li>
</ul>
<h3 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h3><p>以下是一个简单的例子，展示了如何使用 <code>SimpleCookie</code> 配置 Shiro 的记住我功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.shiro.web.servlet.SimpleCookie;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.mgt.CookieRememberMeManager;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个名为 &quot;rememberMe&quot; 的 SimpleCookie 实例</span></span><br><span class="line"><span class="type">SimpleCookie</span> <span class="variable">rememberMeCookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleCookie</span>(<span class="string">&quot;rememberMe&quot;</span>);</span><br><span class="line"><span class="comment">// 设置 Cookie 的最大存活时间为7天</span></span><br><span class="line">rememberMeCookie.setMaxAge(<span class="number">7</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>); <span class="comment">// 7 days in seconds</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 RememberMeManager 并设置上面创建的 Cookie</span></span><br><span class="line"><span class="type">CookieRememberMeManager</span> <span class="variable">rememberMeManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CookieRememberMeManager</span>();</span><br><span class="line">rememberMeManager.setCookie(rememberMeCookie);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 RememberMeManager 配置到 SecurityManager 中</span></span><br><span class="line">securityManager.setRememberMeManager(rememberMeManager);</span><br></pre></td></tr></table></figure>

<p>在这个示例中，我们创建了一个名为 <code>&quot;rememberMe&quot;</code> 的 Cookie，并设置了它的最大存活时间为7天。然后，我们将这个 Cookie 应用到了 <code>CookieRememberMeManager</code> 中，最终将 <code>RememberMeManager</code> 配置给 Shiro 的 <code>SecurityManager</code>，实现了“记住我”功能。</p>
<h2 id="AuthenticationInfo"><a href="#AuthenticationInfo" class="headerlink" title="AuthenticationInfo"></a>AuthenticationInfo</h2><p>在 Apache Shiro 中，<code>AuthenticationInfo</code> 是一个接口，用于封装从数据源（如数据库、LDAP 等）获取的认证信息。它主要用于验证用户的身份信息是否正确。下面将详细介绍 <code>AuthenticationInfo</code> 的继承结构、常用的实现类及其应用场景和常用 API。</p>
<h3 id="AuthenticationInfo-继承结构"><a href="#AuthenticationInfo-继承结构" class="headerlink" title="AuthenticationInfo 继承结构"></a>AuthenticationInfo 继承结构</h3><ol>
<li><p><strong>AuthenticationInfo 接口</strong>：</p>
<ul>
<li>定义了认证信息的基本结构，包括主体（Principal）和凭证（Credentials）。它是所有认证信息对象的顶层接口。</li>
</ul>
</li>
<li><p><strong>SimpleAuthenticationInfo 类</strong>：</p>
<ul>
<li>实现了 <code>AuthenticationInfo</code> 接口，提供了一个简单的认证信息实现。通常用于存储用户名&#x2F;密码对或类似的简单认证信息。</li>
</ul>
</li>
<li><p><strong>Account 类</strong>（已废弃）：</p>
<ul>
<li>早期版本中存在，现在已被弃用，不再推荐使用。</li>
</ul>
</li>
<li><p><strong>Realm 类</strong>：</p>
<ul>
<li>尽管不是直接继承自 <code>AuthenticationInfo</code>，但每个 Realm 都需要返回一个实现了 <code>AuthenticationInfo</code> 接口的对象作为认证结果的一部分。</li>
</ul>
</li>
</ol>
<h3 id="常用实现类及场景-1"><a href="#常用实现类及场景-1" class="headerlink" title="常用实现类及场景"></a>常用实现类及场景</h3><ul>
<li><strong>SimpleAuthenticationInfo</strong>：<ul>
<li><strong>用途</strong>：这是一个非常基础且通用的 <code>AuthenticationInfo</code> 实现，适用于大多数场景。</li>
<li><strong>特点</strong>：可以包含一个或多个主体（Principals），以及一个凭证（Credentials）。此外，还可以附加一些其他信息，比如角色或权限等。</li>
<li><strong>场景</strong>：几乎所有的应用程序都可以使用 <code>SimpleAuthenticationInfo</code> 来表示认证信息，特别是那些只需要用户名和密码进行身份验证的应用。</li>
<li><strong>示例代码</strong>：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.SimpleAuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.crypto.hash.SimpleHash;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 SimpleAuthenticationInfo 实例</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">principal</span> <span class="operator">=</span> <span class="string">&quot;username&quot;</span>; <span class="comment">// 主体</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">hashedCredentials</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleHash</span>(<span class="string">&quot;SHA-256&quot;</span>, <span class="string">&quot;password&quot;</span>, <span class="string">&quot;salt&quot;</span>, <span class="number">1024</span>).toHex(); <span class="comment">// 凭证</span></span><br><span class="line"><span class="type">String</span> <span class="variable">realmName</span> <span class="operator">=</span> <span class="string">&quot;myRealm&quot;</span>; <span class="comment">// Realm 名称</span></span><br><span class="line"></span><br><span class="line"><span class="type">SimpleAuthenticationInfo</span> <span class="variable">info</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleAuthenticationInfo</span>(principal, hashedCredentials, realmName);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="常用-API-1"><a href="#常用-API-1" class="headerlink" title="常用 API"></a>常用 API</h3><p>尽管 <code>SimpleAuthenticationInfo</code> 提供了许多有用的方法，这里列出几个最常用的：</p>
<ul>
<li><p><strong>getPrincipals()</strong>：</p>
<ul>
<li>获取主体集合。主体通常是用户的唯一标识符，例如用户名。</li>
</ul>
</li>
<li><p><strong>getCredentials()</strong>：</p>
<ul>
<li>获取凭证。这通常是用户的密码或其哈希值。</li>
</ul>
</li>
<li><p><strong>getCredentialsSalt()</strong>：</p>
<ul>
<li>如果在创建 <code>SimpleAuthenticationInfo</code> 对象时提供了盐值，则可以通过此方法获取。</li>
</ul>
</li>
<li><p><strong>setPrincipals(PrincipalCollection principals)</strong> 和 <strong>setCredentials(Object credentials)</strong>：</p>
<ul>
<li>设置主体和凭证，通常在创建实例后不需要调用这些方法，因为可以在构造函数中直接指定。</li>
</ul>
</li>
</ul>
<h3 id="场景应用"><a href="#场景应用" class="headerlink" title="场景应用"></a>场景应用</h3><ol>
<li><p><strong>基本认证流程</strong>：</p>
<ul>
<li>在大多数情况下，<code>SimpleAuthenticationInfo</code> 被用来封装用户提供的用户名和密码，并与存储在数据库或其他安全存储中的哈希密码进行比较。</li>
</ul>
</li>
<li><p><strong>集成第三方认证服务</strong>：</p>
<ul>
<li>当与 LDAP、OAuth 或 SAML 等第三方认证服务集成时，也可以使用 <code>SimpleAuthenticationInfo</code> 来封装从这些服务获得的认证信息。</li>
</ul>
</li>
<li><p><strong>自定义 Realm</strong>：</p>
<ul>
<li>开发者可以根据自己的需求创建自定义的 <code>Realm</code>，并在其中使用 <code>SimpleAuthenticationInfo</code> 来封装认证信息。例如，在企业级应用中，可能需要根据复杂的业务逻辑来决定如何认证用户。</li>
</ul>
</li>
</ol>
<p>通过理解和正确使用 <code>SimpleAuthenticationInfo</code>，开发者能够有效地处理用户的身份验证过程，确保应用程序的安全性和可靠性。对于更复杂的需求，Shiro 还允许你实现自己的 <code>AuthenticationInfo</code> 来满足特定的业务要求。</p>
<h2 id="CredentialsMatcher"><a href="#CredentialsMatcher" class="headerlink" title="CredentialsMatcher"></a>CredentialsMatcher</h2><h3 id="CredentialsMatcher-继承结构及常用实现"><a href="#CredentialsMatcher-继承结构及常用实现" class="headerlink" title="CredentialsMatcher 继承结构及常用实现"></a>CredentialsMatcher 继承结构及常用实现</h3><p>在 Apache Shiro 中，<code>CredentialsMatcher</code> 是一个用于验证提交的凭证（如密码）是否与存储的凭证相匹配的重要接口。它允许开发者自定义凭证匹配逻辑，以适应不同的安全需求。</p>
<h4 id="CredentialsMatcher-继承结构"><a href="#CredentialsMatcher-继承结构" class="headerlink" title="CredentialsMatcher 继承结构"></a>CredentialsMatcher 继承结构</h4><ol>
<li><p><strong>CredentialsMatcher 接口</strong>：</p>
<ul>
<li>定义了 <code>doCredentialsMatch(AuthenticationToken token, AuthenticationInfo info)</code> 方法，该方法用于比较用户提供的凭证（通常是从登录表单获取的）和系统中存储的凭证（通常是加密后的密码）是否匹配。</li>
</ul>
</li>
<li><p><strong>SimpleCredentialsMatcher 类</strong>：</p>
<ul>
<li>直接实现了 <code>CredentialsMatcher</code> 接口，提供了一个简单的基于等值比较的凭证匹配器。适用于明文密码或者直接可比较的凭证类型。</li>
</ul>
</li>
<li><p><strong>HashedCredentialsMatcher 类</strong>：</p>
<ul>
<li>继承自 <code>SimpleCredentialsMatcher</code>，专门用于处理哈希过的凭证（例如 SHA-256、MD5 等）。它支持对盐值的支持，并且可以指定哈希算法以及迭代次数。</li>
</ul>
</li>
<li><p><strong>Custom CredentialsMatcher 实现</strong>：</p>
<ul>
<li>开发者可以根据具体的安全要求实现自己的 <code>CredentialsMatcher</code>，比如集成第三方认证服务或使用更复杂的加密算法。</li>
</ul>
</li>
</ol>
<h4 id="常用实现类及场景-2"><a href="#常用实现类及场景-2" class="headerlink" title="常用实现类及场景"></a>常用实现类及场景</h4><ul>
<li><p><strong>SimpleCredentialsMatcher</strong>：</p>
<ul>
<li><strong>用途</strong>：简单地比较两个凭证是否相同。如果凭证是明文字符串或可以直接比较的数据，则适合使用此匹配器。</li>
<li><strong>特点</strong>：不支持哈希或加密的凭证，仅适用于非常基础的应用场景。</li>
<li><strong>场景</strong>：不适合生产环境中的应用，因为安全性较低，容易受到攻击。</li>
</ul>
</li>
<li><p><strong>HashedCredentialsMatcher</strong>：</p>
<ul>
<li><strong>用途</strong>：专为处理经过哈希算法处理的凭证而设计，支持多种哈希算法（如 SHA-256、MD5 等），并且支持加盐以增加安全性。</li>
<li><strong>特点</strong>：可以通过设置哈希算法名称、盐值位置、哈希迭代次数等参数来增强安全性。</li>
<li><strong>场景</strong>：广泛应用于需要较高安全性的Web应用中，特别是那些涉及敏感信息保护的情况。</li>
<li><strong>示例代码</strong>：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HashedCredentialsMatcher</span> <span class="variable">matcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashedCredentialsMatcher</span>();</span><br><span class="line">matcher.setHashAlgorithmName(<span class="string">&quot;SHA-256&quot;</span>); <span class="comment">// 设置哈希算法</span></span><br><span class="line">matcher.setHashIterations(<span class="number">1024</span>); <span class="comment">// 设置哈希迭代次数</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="常用-API-2"><a href="#常用-API-2" class="headerlink" title="常用 API"></a>常用 API</h4><p>对于 <code>HashedCredentialsMatcher</code>，这里有一些常用的配置选项：</p>
<ul>
<li><p><strong>setHashAlgorithmName(String algorithmName)</strong>：</p>
<ul>
<li>设置哈希算法名称（如 “SHA-256”, “MD5”）。</li>
</ul>
</li>
<li><p><strong>setHashIterations(int iterations)</strong>：</p>
<ul>
<li>设置哈希算法的迭代次数，增加这个值可以提高安全性但会增加计算时间。</li>
</ul>
</li>
<li><p><strong>setStoredCredentialsHexEncoded(boolean hexEncoded)</strong>：</p>
<ul>
<li>设置是否将存储的凭证编码为十六进制字符串，默认为 true。</li>
</ul>
</li>
<li><p><strong>setSaltStyle(SaltStyle style)</strong>：</p>
<ul>
<li>设置盐值样式，有 NONE、PREFIX、SUFFIX 可选，决定如何处理盐值。</li>
</ul>
</li>
</ul>
<p>此外，<code>doCredentialsMatch</code> 方法是核心方法，用来实际执行凭证匹配：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">doCredentialsMatch</span><span class="params">(AuthenticationToken token, AuthenticationInfo info)</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">tokenCredentials</span> <span class="operator">=</span> getCredentials(token);</span><br><span class="line">    <span class="type">Object</span> <span class="variable">accountCredentials</span> <span class="operator">=</span> getCredentials(info);</span><br><span class="line">    <span class="keyword">return</span> equals(tokenCredentials, accountCredentials);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个方法中，Shiro 会调用具体的 <code>CredentialsMatcher</code> 来判断提交的凭证是否与存储的凭证相匹配。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>选择合适的 <code>CredentialsMatcher</code> 对于确保应用程序的安全至关重要。对于大多数现代 Web 应用来说，推荐使用 <code>HashedCredentialsMatcher</code>，因为它提供了更好的安全性，特别是在处理用户密码时。通过合理配置哈希算法、盐值和迭代次数，可以有效地防止诸如彩虹表攻击等常见的密码破解技术。如果你的应用有特殊的安全需求，也可以考虑实现自定义的 <code>CredentialsMatcher</code>。</p>
<h2 id="Permission"><a href="#Permission" class="headerlink" title="Permission"></a>Permission</h2><p>在 Apache Shiro 中，<code>Permission</code> 是一个核心概念，用于表示用户可以执行的操作或访问的资源。权限（Permissions）是细粒度的安全控制机制，允许你精确地定义哪些用户或角色能够对特定资源执行何种操作。</p>
<h4 id="Permission-接口"><a href="#Permission-接口" class="headerlink" title="Permission 接口"></a>Permission 接口</h4><p><code>Permission</code> 接口定义了如何检查某个身份是否被授权执行某一操作。Shiro 提供了几种不同的 <code>Permission</code> 实现，它们各自适用于不同场景。</p>
<h3 id="常用的-Permission-实现类及其应用场景"><a href="#常用的-Permission-实现类及其应用场景" class="headerlink" title="常用的 Permission 实现类及其应用场景"></a>常用的 Permission 实现类及其应用场景</h3><ol>
<li><p><strong>WildcardPermission</strong>：</p>
<ul>
<li><strong>用途</strong>：这是 Shiro 默认的权限实现，支持通过通配符来定义复杂的权限规则。</li>
<li><strong>特点</strong>：灵活且强大，可以通过点分隔的字符串定义层次化的权限结构，并使用通配符进行匹配。</li>
<li><strong>格式</strong>：<code>domain:action:instance</code>，例如 <code>&quot;user:create:*&quot;</code> 表示可以在任何实例上创建用户。</li>
<li><strong>示例</strong>：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Subject</span> <span class="variable">currentUser</span> <span class="operator">=</span> SecurityUtils.getSubject();</span><br><span class="line"><span class="keyword">if</span> (currentUser.isPermitted(<span class="string">&quot;user:update&quot;</span>)) &#123;</span><br><span class="line">    <span class="comment">// 执行更新用户的逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>场景</strong>：适用于大多数需要细粒度权限控制的应用场景，尤其是当你的应用有复杂权限需求时。</li>
</ul>
</li>
<li><p><strong>BitPermission</strong>（较少使用）：</p>
<ul>
<li><strong>用途</strong>：基于位运算的权限实现，主要用于需要高效处理大量权限的情况。</li>
<li><strong>特点</strong>：通过位掩码来表示权限，虽然效率高但不够直观，通常只在特殊情况下使用。</li>
<li><strong>场景</strong>：对于性能要求极高且权限体系相对简单的场景可能有用，但在现代应用中不常见。</li>
</ul>
</li>
<li><p><strong>Custom Permission Implementations</strong>：</p>
<ul>
<li><strong>用途</strong>：根据具体业务需求自定义权限实现。</li>
<li><strong>特点</strong>：灵活性强，可以根据实际需求设计权限模型。</li>
<li><strong>场景</strong>：当你需要实现特定领域的权限模型时，如基于图的权限管理、基于时间窗口的权限等。</li>
</ul>
</li>
</ol>
<h3 id="常用-API-3"><a href="#常用-API-3" class="headerlink" title="常用 API"></a>常用 API</h3><ul>
<li><p><strong>isPermitted(String permission)</strong>：</p>
<ul>
<li>检查当前用户是否有指定权限。</li>
</ul>
</li>
<li><p><strong>isPermittedAll(String… permissions)</strong>：</p>
<ul>
<li>检查当前用户是否拥有所有列出的权限。</li>
</ul>
</li>
<li><p><strong>checkPermission(String permission)</strong>：</p>
<ul>
<li>如果当前用户没有指定权限，则抛出 <code>AuthorizationException</code> 异常。</li>
</ul>
</li>
<li><p><strong>hasRole(String roleIdentifier)</strong> 和 <strong>hasAllRoles(Collection<String> roleIdentifiers)</strong>：</p>
<ul>
<li>虽然不是直接与 <code>Permission</code> 相关，但在实际开发中经常配合使用，用于检查用户的角色信息。</li>
</ul>
</li>
</ul>
<h3 id="示例代码-1"><a href="#示例代码-1" class="headerlink" title="示例代码"></a>示例代码</h3><p>下面是一个使用 <code>WildcardPermission</code> 的简单例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PermissionExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取当前登录的用户</span></span><br><span class="line">        <span class="type">Subject</span> <span class="variable">currentUser</span> <span class="operator">=</span> SecurityUtils.getSubject();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查用户是否具有指定权限</span></span><br><span class="line">        <span class="keyword">if</span> (currentUser.isPermitted(<span class="string">&quot;user:read:12345&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;You are permitted to read user with ID 12345.&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;You do not have permission to read user with ID 12345.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 或者使用更通用的权限检查</span></span><br><span class="line">        <span class="keyword">if</span> (currentUser.isPermitted(<span class="string">&quot;user:*&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;You have general permissions over users.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 强制性权限检查</span></span><br><span class="line">        currentUser.checkPermission(<span class="string">&quot;user:delete:67890&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;User is allowed to delete user with ID 67890.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="场景应用-1"><a href="#场景应用-1" class="headerlink" title="场景应用"></a>场景应用</h3><ol>
<li><p><strong>资源级权限控制</strong>：</p>
<ul>
<li>在 Web 应用中，可以为每个页面、按钮甚至是 AJAX 请求设置权限，确保只有授权用户才能访问或操作。</li>
</ul>
</li>
<li><p><strong>模块化权限管理</strong>：</p>
<ul>
<li>对于大型企业级应用，权限往往按照模块划分，比如财务模块、人力资源模块等。使用 <code>WildcardPermission</code> 可以方便地定义和管理这些模块的权限。</li>
</ul>
</li>
<li><p><strong>动态权限分配</strong>：</p>
<ul>
<li>在某些场景下，权限不是固定的，而是根据用户行为或环境变化而改变。例如，在线教育平台中，讲师可能只能对自己教授的课程拥有编辑权限，这时可以通过动态生成权限字符串来实现这种灵活的权限控制。</li>
</ul>
</li>
</ol>
<h2 id="SecurityUtils"><a href="#SecurityUtils" class="headerlink" title="SecurityUtils"></a>SecurityUtils</h2><p><code>SecurityUtils</code> 是 Apache Shiro 框架中的一个实用工具类，它提供了静态方法来获取当前执行上下文的安全相关信息，如当前用户（即 <code>Subject</code>），以及与安全管理器（<code>SecurityManager</code>）相关的操作。它是连接应用程序代码和 Shiro 安全机制的桥梁。</p>
<h3 id="SecurityUtils-的主要功能"><a href="#SecurityUtils-的主要功能" class="headerlink" title="SecurityUtils 的主要功能"></a>SecurityUtils 的主要功能</h3><ol>
<li><p><strong>获取当前用户（Subject）</strong>：</p>
<ul>
<li>通过 <code>SecurityUtils.getSubject()</code> 方法可以获取当前执行线程的 <code>Subject</code> 对象。<code>Subject</code> 表示当前用户或正在执行的代码的身份和权限。</li>
</ul>
</li>
<li><p><strong>设置和获取 <code>SecurityManager</code></strong>：</p>
<ul>
<li><code>setSecurityManager(SecurityManager securityManager)</code>：设置全局的 <code>SecurityManager</code> 实例。</li>
<li><code>getSecurityManager()</code>：返回当前应用中配置的 <code>SecurityManager</code>。</li>
</ul>
</li>
<li><p><strong>创建无会话的匿名 Subject</strong>：</p>
<ul>
<li><code>createSubject(SubjectContext context)</code>：根据给定的 <code>SubjectContext</code> 创建一个新的 <code>Subject</code> 实例，这在测试或者需要临时创建非活跃的 <code>Subject</code> 实例时非常有用。</li>
</ul>
</li>
</ol>
<h3 id="常用方法介绍"><a href="#常用方法介绍" class="headerlink" title="常用方法介绍"></a>常用方法介绍</h3><h4 id="获取当前用户（Subject）"><a href="#获取当前用户（Subject）" class="headerlink" title="获取当前用户（Subject）"></a>获取当前用户（Subject）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Subject</span> <span class="variable">currentUser</span> <span class="operator">=</span> SecurityUtils.getSubject();</span><br></pre></td></tr></table></figure>

<ul>
<li>这是使用最频繁的方法之一，用于获取当前执行环境下的 <code>Subject</code>。你可以利用这个 <code>Subject</code> 对象来进行认证、授权等操作。</li>
</ul>
<h4 id="设置和获取-SecurityManager"><a href="#设置和获取-SecurityManager" class="headerlink" title="设置和获取 SecurityManager"></a>设置和获取 <code>SecurityManager</code></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置 SecurityManager</span></span><br><span class="line">SecurityUtils.setSecurityManager(securityManager);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 SecurityManager</span></span><br><span class="line"><span class="type">SecurityManager</span> <span class="variable">securityManager</span> <span class="operator">=</span> SecurityUtils.getSecurityManager();</span><br></pre></td></tr></table></figure>

<ul>
<li>在初始化 Shiro 环境时，通常需要先设置一个 <code>SecurityManager</code> 实例，之后可以通过 <code>getSecurityManager()</code> 方法在整个应用程序中访问它。</li>
</ul>
<h4 id="其他常用操作"><a href="#其他常用操作" class="headerlink" title="其他常用操作"></a>其他常用操作</h4><ul>
<li><p><strong>检查是否已认证</strong>：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (currentUser.isAuthenticated()) &#123;</span><br><span class="line">    <span class="comment">// 用户已登录</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>登录&#x2F;登出</strong>：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登录</span></span><br><span class="line"><span class="type">UsernamePasswordToken</span> <span class="variable">token</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordToken</span>(username, password);</span><br><span class="line">currentUser.login(token);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登出</span></span><br><span class="line">currentUser.logout();</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>权限检查</strong>：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (currentUser.isPermitted(<span class="string">&quot;user:delete:12345&quot;</span>)) &#123;</span><br><span class="line">    <span class="comment">// 执行删除用户的逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ul>
<li><p><strong>身份验证</strong>：通过 <code>SecurityUtils.getSubject()</code> 获取 <code>Subject</code> 后，可以进行用户的身份验证操作。</p>
</li>
<li><p><strong>权限控制</strong>：在服务层或控制器层检查当前用户是否有执行某些操作的权限。</p>
</li>
<li><p><strong>会话管理</strong>：管理用户的会话信息，例如获取会话属性、注销会话等。</p>
</li>
<li><p><strong>跨模块安全集成</strong>：在不同的模块之间共享安全上下文，确保一致的安全策略。</p>
</li>
</ul>
<h3 id="示例代码-2"><a href="#示例代码-2" class="headerlink" title="示例代码"></a>示例代码</h3><p>下面是一个简单的例子，展示了如何使用 <code>SecurityUtils</code> 来实现用户登录和权限检查：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取当前用户</span></span><br><span class="line">        <span class="type">Subject</span> <span class="variable">currentUser</span> <span class="operator">=</span> SecurityUtils.getSubject();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建用户名密码令牌</span></span><br><span class="line">        <span class="type">UsernamePasswordToken</span> <span class="variable">token</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordToken</span>(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 登录</span></span><br><span class="line">            currentUser.login(token);</span><br><span class="line">            System.out.println(<span class="string">&quot;User [&quot;</span> + currentUser.getPrincipal() + <span class="string">&quot;] logged in successfully.&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 权限检查</span></span><br><span class="line">            <span class="keyword">if</span> (currentUser.isPermitted(<span class="string">&quot;user:read&quot;</span>)) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Has permission to read user data.&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Does not have permission to read user data.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 登出</span></span><br><span class="line">            currentUser.logout();</span><br><span class="line">            System.out.println(<span class="string">&quot;User logged out successfully.&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Login failed: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="ShiroFilterFactoryBean"><a href="#ShiroFilterFactoryBean" class="headerlink" title="ShiroFilterFactoryBean"></a>ShiroFilterFactoryBean</h2><p><code>ShiroFilterFactoryBean</code> 是 Apache Shiro 与 Spring 集成时的一个核心组件，它用于创建和配置 <code>ShiroFilter</code> 实例。<code>ShiroFilter</code> 是 Shiro 框架中的一个 Servlet 过滤器，负责拦截所有进入应用的请求，并根据配置的安全规则决定是否允许这些请求继续执行。</p>
<h3 id="主要功能"><a href="#主要功能" class="headerlink" title="主要功能"></a>主要功能</h3><ol>
<li><strong>安全管理</strong>：通过 <code>SecurityManager</code> 对象来管理安全相关的操作，包括认证、授权等。</li>
<li><strong>过滤器链定义</strong>：允许你为不同的 URL 定义不同的过滤器链，从而实现细粒度的访问控制。</li>
<li><strong>自定义过滤器</strong>：支持添加自定义的过滤器，以满足特定的安全需求。</li>
<li><strong>未授权&#x2F;未登录处理</strong>：可以设置当用户尝试访问无权限资源或未登录时跳转到的页面。</li>
</ol>
<h3 id="核心属性"><a href="#核心属性" class="headerlink" title="核心属性"></a>核心属性</h3><ul>
<li><strong>securityManager</strong>：设置 <code>SecurityManager</code> 实例，这是 Shiro 的核心组件，负责所有的安全操作。</li>
<li><strong>filters</strong>：注册自定义过滤器，键值对形式，键为过滤器名称，值为具体的过滤器实例。</li>
<li><strong>filterChainDefinitionMap</strong>：定义 URL 和对应的过滤器链，通常是一个 Map 结构，键为 URL 模式，值为相应的过滤器链（如 “authc” 表示需要登录验证)。</li>
<li><strong>loginUrl</strong>：指定登录页面的 URL，如果用户未登录且试图访问受保护的资源时将被重定向到这里。</li>
<li><strong>successUrl</strong>：成功登录后的默认跳转地址。</li>
<li><strong>unauthorizedUrl</strong>：未经授权的访问将被重定向至此URL。</li>
</ul>
<h3 id="示例代码-3"><a href="#示例代码-3" class="headerlink" title="示例代码"></a>示例代码</h3><p>下面是一个简单的 <code>ShiroFilterFactoryBean</code> 配置示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.web.ShiroFilterFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.SecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.filter.authc.AnonymousFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;shiroFilter&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ShiroFilterFactoryBean <span class="title function_">shiroFilterFactoryBean</span><span class="params">(SecurityManager securityManager)</span> &#123;</span><br><span class="line">        <span class="type">ShiroFilterFactoryBean</span> <span class="variable">shiroFilterFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShiroFilterFactoryBean</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置 SecurityManager</span></span><br><span class="line">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 注册自定义过滤器</span></span><br><span class="line">        Map&lt;String, Filter&gt; filters = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        filters.put(<span class="string">&quot;anon&quot;</span>, <span class="keyword">new</span> <span class="title class_">AnonymousFilter</span>());</span><br><span class="line">        shiroFilterFactoryBean.setFilters(filters);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 配置过滤链定义</span></span><br><span class="line">        Map&lt;String, String&gt; filterChainDefinitionMap = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">&quot;/public/**&quot;</span>, <span class="string">&quot;anon&quot;</span>); <span class="comment">// 公共资源，无需认证</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">&quot;/admin/**&quot;</span>, <span class="string">&quot;roles[admin]&quot;</span>); <span class="comment">// 管理员角色可访问</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">&quot;/**&quot;</span>, <span class="string">&quot;authc&quot;</span>); <span class="comment">// 所有其他路径都需要认证</span></span><br><span class="line">        </span><br><span class="line">        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置登录页面</span></span><br><span class="line">        shiroFilterFactoryBean.setLoginUrl(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置未授权页面</span></span><br><span class="line">        shiroFilterFactoryBean.setUnauthorizedUrl(<span class="string">&quot;/unauthorized&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> shiroFilterFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="关键点解释"><a href="#关键点解释" class="headerlink" title="关键点解释"></a>关键点解释</h3><ul>
<li><p><strong>过滤链定义 (<code>filterChainDefinitionMap</code>)</strong>：</p>
<ul>
<li><code>/public/**</code>: 匹配所有以 <code>/public/</code> 开头的路径，使用 <code>anon</code> 过滤器表示匿名访问，即不需要任何认证即可访问。</li>
<li><code>/admin/**</code>: 只有拥有 <code>admin</code> 角色的用户才能访问以 <code>/admin/</code> 开头的所有路径。</li>
<li><code>/**</code>: 所有其他路径都需要经过 <code>authc</code> 过滤器进行认证。</li>
</ul>
</li>
<li><p><strong><code>setLoginUrl</code> 和 <code>setUnauthorizedUrl</code></strong>：</p>
<ul>
<li>当用户尝试访问需要认证但尚未登录的资源时，会被重定向到设置的登录页面。</li>
<li>当用户尝试访问没有权限的资源时，会被重定向到未授权页面。</li>
</ul>
</li>
</ul>
<h3 id="使用场景-1"><a href="#使用场景-1" class="headerlink" title="使用场景"></a>使用场景</h3><ul>
<li><strong>Web 应用的安全控制</strong>：通过 <code>ShiroFilterFactoryBean</code> 可以为你的 Web 应用添加强大的安全控制机制，确保只有经过认证并具有适当权限的用户才能访问特定资源。</li>
<li><strong>REST API 安全性</strong>：除了传统的 Web 页面外，也可以用来保护 RESTful API 接口，确保只有合法的客户端能够调用这些接口。</li>
</ul>
<h2 id="ShiroFilterChainDefinition"><a href="#ShiroFilterChainDefinition" class="headerlink" title="ShiroFilterChainDefinition"></a><code>ShiroFilterChainDefinition</code></h2><p>Apache Shiro 中用于定义过滤器链（Filter Chain）的一个接口。它允许开发者以一种结构化的方式为不同的 URL 模式指定相应的过滤器链，从而实现细粒度的安全控制。在 Spring Boot 环境下，通过实现 <code>ShiroFilterChainDefinition</code> 接口，可以灵活地配置哪些 URL 需要进行认证、授权等安全检查。</p>
<h3 id="主要功能-1"><a href="#主要功能-1" class="headerlink" title="主要功能"></a>主要功能</h3><ul>
<li><strong>URL 模式与过滤器的映射</strong>：允许你为不同的 URL 模式指定一个或多个过滤器，这样当请求匹配某个 URL 模式时，对应的过滤器链就会被应用。</li>
<li><strong>支持多种内置过滤器</strong>：如 <code>authc</code>（需要登录）、<code>roles</code>（角色检查）、<code>perms</code>（权限检查）、<code>anon</code>（匿名访问，无需认证）等。</li>
<li><strong>自定义过滤器</strong>：除了使用 Shiro 提供的内置过滤器外，还可以注册和使用自定义的过滤器。</li>
</ul>
<h3 id="为什么使用-ShiroFilterChainDefinition？"><a href="#为什么使用-ShiroFilterChainDefinition？" class="headerlink" title="为什么使用 ShiroFilterChainDefinition？"></a>为什么使用 ShiroFilterChainDefinition？</h3><p>在传统的 Shiro 配置中，我们通常会直接在 <code>ShiroFilterFactoryBean</code> 中通过 <code>setFilterChainDefinitionMap()</code> 方法来设置过滤器链。然而，使用 <code>ShiroFilterChainDefinition</code> 可以提供更加灵活和模块化的配置方式，特别是在 Spring Boot 环境下，它可以让你更好地组织和管理你的过滤器链配置。</p>
<h3 id="实现示例"><a href="#实现示例" class="headerlink" title="实现示例"></a>实现示例</h3><p>下面是一个简单的示例，展示了如何在 Spring Boot 应用中实现 <code>ShiroFilterChainDefinition</code> 来配置过滤器链：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.web.ShiroFilterChainDefinition;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.filter.mgt.DefaultFilterChainManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.servlet.AbstractShiroFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ShiroFilterChainDefinition <span class="title function_">shiroFilterChainDefinition</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DefaultFilterChainDefinition</span> <span class="variable">chainDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultFilterChainDefinition</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定义过滤器链</span></span><br><span class="line">        Map&lt;String, String&gt; filterChainMap = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 允许匿名访问的资源</span></span><br><span class="line">        filterChainMap.put(<span class="string">&quot;/public/**&quot;</span>, <span class="string">&quot;anon&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 需要管理员角色才能访问的资源</span></span><br><span class="line">        filterChainMap.put(<span class="string">&quot;/admin/**&quot;</span>, <span class="string">&quot;roles[admin]&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 所有其他路径都需要认证</span></span><br><span class="line">        filterChainMap.put(<span class="string">&quot;/**&quot;</span>, <span class="string">&quot;authc&quot;</span>);</span><br><span class="line"></span><br><span class="line">        chainDefinition.addPathDefinitions(filterChainMap);</span><br><span class="line">        <span class="keyword">return</span> chainDefinition;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果你需要进一步定制Shiro Filter的行为，可能还需要配置ShiroFilterFactoryBean</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    @Bean(name = &quot;shiroFilter&quot;)</span></span><br><span class="line"><span class="comment">    public ShiroFilterFactoryBean shiroFilterFactoryBean(SecurityManager securityManager) throws Exception &#123;</span></span><br><span class="line"><span class="comment">        ShiroFilterFactoryBean shiroFilterFactoryBean = new ShiroFilterFactoryBean();</span></span><br><span class="line"><span class="comment">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        // 获取之前定义的过滤器链</span></span><br><span class="line"><span class="comment">        Map&lt;String, String&gt; filterChainDefinitionMap = shiroFilterChainDefinition().getFilterChainMap();</span></span><br><span class="line"><span class="comment">        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        return shiroFilterFactoryBean;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，我们创建了一个 <code>DefaultFilterChainDefinition</code> 的实例，并为其添加了几个过滤器链规则：</p>
<ol>
<li><code>/public/**</code>：允许匿名访问，即不需要任何认证即可访问这些资源。</li>
<li><code>/admin/**</code>：只有拥有 <code>admin</code> 角色的用户才能访问这些资源。</li>
<li><code>/**</code>：所有其他路径都需要经过认证 (<code>authc</code>)。</li>
</ol>
<h3 id="关键点解释-1"><a href="#关键点解释-1" class="headerlink" title="关键点解释"></a>关键点解释</h3><ul>
<li><strong>LinkedHashMap</strong>：这里使用 <code>LinkedHashMap</code> 而不是普通的 <code>HashMap</code>，因为过滤器链定义是有顺序的，<code>LinkedHashMap</code> 可以保证插入顺序，从而确保优先级较高的规则先被匹配。</li>
<li><strong>filterChainMap.put()</strong>：第一个参数是 URL 模式，第二个参数是过滤器链字符串，可以包含多个过滤器名称，中间用逗号分隔。</li>
<li><strong>addPathDefinitions()</strong>：将 URL 模式和对应的过滤器链添加到 <code>ShiroFilterChainDefinition</code> 中。</li>
</ul>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p><code>ShiroFilterChainDefinition</code> 提供了一种灵活且易于维护的方式来配置 Shiro 的过滤器链。通过这种方式，你可以轻松地为应用程序的不同部分设置适当的安全策略，无论是保护 REST API 还是 Web 页面。这种配置方法特别适合于 Spring Boot 应用程序，因为它能够很好地与其他 Spring 组件集成，使得整个安全配置过程更加简洁明了。</p>
<h2 id="必须配置ShiroFilterFactoryBean？"><a href="#必须配置ShiroFilterFactoryBean？" class="headerlink" title="必须配置ShiroFilterFactoryBean？"></a>必须配置ShiroFilterFactoryBean？</h2><p>在 Spring Boot 项目中集成 Apache Shiro 时，是否需要配置 <code>ShiroFilterFactoryBean</code> 取决于你选择的集成方式。简单来说：</p>
<ul>
<li><p><strong>如果你使用 Shiro 提供的 Starter（如 <code>shiro-spring-boot-web-starter</code>），那么大部分的基础配置会被自动处理</strong>，包括创建和配置 <code>ShiroFilterFactoryBean</code>。在这种情况下，你可能不需要手动配置 <code>ShiroFilterFactoryBean</code>，除非你需要进行一些自定义设置。</p>
</li>
<li><p><strong>如果选择手动集成 Shiro 到你的 Spring Boot 应用程序中</strong>，则需要你自己创建并配置 <code>ShiroFilterFactoryBean</code>，以便能够正确地设置过滤器链、安全管理器等关键组件。</p>
</li>
</ul>
<h3 id="使用-Shiro-Starter-的情况"><a href="#使用-Shiro-Starter-的情况" class="headerlink" title="使用 Shiro Starter 的情况"></a>使用 Shiro Starter 的情况</h3><p>当你通过添加依赖 <code>shiro-spring-boot-web-starter</code> 来集成 Shiro 时，许多默认配置已经被预先设置好。例如，<code>SecurityManager</code> 和基本的 <code>ShiroFilterFactoryBean</code> 配置可能会被自动加载。你可以通过简单的配置文件（如 <code>application.yml</code> 或 <code>application.properties</code>）来调整一些基础设置。但是，对于更复杂的需求或自定义逻辑，仍然可能需要提供额外的配置类来覆盖默认行为。</p>
<h3 id="手动配置的情况"><a href="#手动配置的情况" class="headerlink" title="手动配置的情况"></a>手动配置的情况</h3><p>在手动配置 Shiro 的情况下，你需要明确地定义 <code>ShiroFilterFactoryBean</code> 并为其设置必要的属性，比如 <code>SecurityManager</code>、过滤器链定义（filter chain definitions）、登录页面 URL 等。这是因为你需要完全控制如何初始化 Shiro 的核心组件以及它们之间的交互方式。</p>
<h3 id="示例：手动配置-ShiroFilterFactoryBean"><a href="#示例：手动配置-ShiroFilterFactoryBean" class="headerlink" title="示例：手动配置 ShiroFilterFactoryBean"></a>示例：手动配置 <code>ShiroFilterFactoryBean</code></h3><p>下面是一个手动配置 <code>ShiroFilterFactoryBean</code> 的简化示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.web.ShiroFilterFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.SecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.filter.authc.AnonymousFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;shiroFilter&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ShiroFilterFactoryBean <span class="title function_">shiroFilterFactoryBean</span><span class="params">(SecurityManager securityManager)</span> &#123;</span><br><span class="line">        <span class="type">ShiroFilterFactoryBean</span> <span class="variable">shiroFilterFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShiroFilterFactoryBean</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置 SecurityManager</span></span><br><span class="line">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 注册自定义过滤器</span></span><br><span class="line">        Map&lt;String, Filter&gt; filters = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        filters.put(<span class="string">&quot;anon&quot;</span>, <span class="keyword">new</span> <span class="title class_">AnonymousFilter</span>());</span><br><span class="line">        shiroFilterFactoryBean.setFilters(filters);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 配置过滤器链定义</span></span><br><span class="line">        Map&lt;String, String&gt; filterChainDefinitionMap = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">&quot;/public/**&quot;</span>, <span class="string">&quot;anon&quot;</span>); <span class="comment">// 公共资源，无需认证</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">&quot;/admin/**&quot;</span>, <span class="string">&quot;roles[admin]&quot;</span>); <span class="comment">// 管理员角色可访问</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">&quot;/**&quot;</span>, <span class="string">&quot;authc&quot;</span>); <span class="comment">// 所有其他路径都需要认证</span></span><br><span class="line">        </span><br><span class="line">        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置登录页面</span></span><br><span class="line">        shiroFilterFactoryBean.setLoginUrl(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置未授权页面</span></span><br><span class="line">        shiroFilterFactoryBean.setUnauthorizedUrl(<span class="string">&quot;/unauthorized&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> shiroFilterFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><ul>
<li><p><strong>对于大多数标准需求</strong>，使用 Shiro 的 Starter 包通常就足够了，它提供了足够的灵活性和简便性来满足常见的安全需求，而无需手动配置 <code>ShiroFilterFactoryBean</code>。</p>
</li>
<li><p><strong>当你的项目有特殊的安全需求</strong>，如复杂的权限模型、特定的过滤器逻辑或是对现有流程的高度定制化要求时，则可能需要手动配置 <code>ShiroFilterFactoryBean</code> 以实现这些高级功能。</p>
</li>
</ul>
<p>因此，是否需要配置 <code>ShiroFilterFactoryBean</code> 主要取决于项目的具体需求以及你所选择的集成方法。</p>
<p>在使用 Apache Shiro 与 Spring Boot 集成时，有两种常见的方法：一种是通过使用 Shiro 提供的 Starter（<code>shiro-spring-boot-web-starter</code>），另一种是手动配置 Shiro 的各个组件。这两种方式的主要区别在于配置的自动化程度和灵活性。</p>
<h3 id="使用-Shiro-Starter-shiro-spring-boot-web-starter"><a href="#使用-Shiro-Starter-shiro-spring-boot-web-starter" class="headerlink" title="使用 Shiro Starter (shiro-spring-boot-web-starter)"></a>使用 Shiro Starter (shiro-spring-boot-web-starter)</h3><p>Shiro 提供了一个专门针对 Spring Boot 的 starter，它简化了 Shiro 的集成过程，使得开发者可以更快地开始使用 Shiro 的功能而不需要过多的手动配置。</p>
<h4 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h4><ol>
<li><p><strong>添加依赖</strong>：<br>在你的 <code>pom.xml</code> 文件中加入 Shiro 的 Starter 依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring-boot-web-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- 确保使用最新版本 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置文件</strong>：<br>可以在 <code>application.yml</code> 或 <code>application.properties</code> 中配置一些基本的 Shiro 设置。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">shiro:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">sessionManager:</span></span><br><span class="line">    <span class="attr">sessionIdCookieEnabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">sessionIdUrlRewritingEnabled:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">securityManager:</span></span><br><span class="line">    <span class="attr">realm:</span> <span class="string">yourCustomRealmBeanName</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>自定义 Realm</strong>：<br>创建一个继承自 <code>AuthorizingRealm</code> 的类来实现用户认证和授权逻辑。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyShiroRealm</span> <span class="keyword">extends</span> <span class="title class_">AuthorizingRealm</span> &#123;</span><br><span class="line">    <span class="comment">// 实现 doGetAuthenticationInfo 和 doGetAuthorizationInfo 方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>自动配置</strong>：<br>Spring Boot 会自动扫描并注册必要的 Bean，如 <code>SecurityManager</code>、<code>ShiroFilterFactoryBean</code> 等。你只需要提供自定义的 Realm 和其他可能需要的配置即可。</p>
</li>
</ol>
<h3 id="手动配置-Shiro-Spring-Boot-自动配置"><a href="#手动配置-Shiro-Spring-Boot-自动配置" class="headerlink" title="手动配置 Shiro + Spring Boot 自动配置"></a>手动配置 Shiro + Spring Boot 自动配置</h3><p>在这种方式下，你需要手动创建并配置 Shiro 的核心组件，如 <code>SecurityManager</code>、<code>ShiroFilterFactoryBean</code> 等，但是依然可以利用 Spring Boot 的特性来简化一些工作。</p>
<h4 id="步骤：-1"><a href="#步骤：-1" class="headerlink" title="步骤："></a>步骤：</h4><ol>
<li><p><strong>添加依赖</strong>：<br>同样需要添加 Shiro 和 Spring 的依赖，但不一定是 Starter 包。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- 根据实际情况选择版本 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建配置类</strong>：<br>编写一个配置类来初始化 Shiro 的各个组件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityManager <span class="title function_">securityManager</span><span class="params">(Realm myShiroRealm)</span> &#123;</span><br><span class="line">        <span class="type">DefaultWebSecurityManager</span> <span class="variable">securityManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultWebSecurityManager</span>();</span><br><span class="line">        securityManager.setRealm(myShiroRealm);</span><br><span class="line">        <span class="keyword">return</span> securityManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Realm <span class="title function_">myShiroRealm</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyShiroRealm</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ShiroFilterFactoryBean <span class="title function_">shiroFilterFactoryBean</span><span class="params">(SecurityManager securityManager)</span> &#123;</span><br><span class="line">        <span class="type">ShiroFilterFactoryBean</span> <span class="variable">shiroFilterFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShiroFilterFactoryBean</span>();</span><br><span class="line">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class="line">        <span class="comment">// 其他配置...</span></span><br><span class="line">        <span class="keyword">return</span> shiroFilterFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>自定义 Realm</strong>：<br>这部分与 Starter 方式相同，你需要实现自己的 Realm 类来处理认证和授权逻辑。</p>
</li>
<li><p><strong>配置过滤器链</strong>：<br>在上面的 <code>shiroFilterFactoryBean</code> 方法中配置过滤器链，定义哪些 URL 需要进行安全控制。</p>
</li>
<li><p><strong>启用 Shiro</strong>：<br>由于没有 Starter 来自动完成这些步骤，你需要确保所有必需的 Bean 都被正确创建，并且在应用启动时能够正常工作。</p>
</li>
</ol>
<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><ul>
<li><strong>Starter 方式</strong> 更加简单快捷，适合快速开发和标准化项目，因为很多默认设置已经为你准备好，只需少量配置或自定义代码即可运行。</li>
<li><strong>手动配置方式</strong> 提供了更高的灵活性，允许你完全掌控 Shiro 的每一个细节，适合对安全性有特殊要求或需要定制化解决方案的情况。</li>
</ul>
<p>根据你的需求选择合适的方式来集成 Shiro 到 Spring Boot 应用中。如果你想要快速上手并且不需要太多自定义设置，那么使用 Starter 是最好的选择；反之，如果你需要更多的控制权，则可以选择手动配置的方式。</p>
<p>是的，你提到的 <strong>通过 <code>ShiroFilterChainDefinition</code> 直接注入的方式</strong> 是 <strong>Shiro 在 Spring Boot 中推荐的一种更现代、更简洁的配置方式</strong>，而且 <strong>确实可以不使用 <code>ShiroFilterFactoryBean</code></strong> 来手动配置过滤器链。</p>
<p>下面我们来详细解释：</p>
<hr>
<h2 id="✅-你的做法是完全正确的"><a href="#✅-你的做法是完全正确的" class="headerlink" title="✅ 你的做法是完全正确的"></a>✅ 你的做法是完全正确的</h2><p>你使用了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ShiroFilterChainDefinition <span class="title function_">shiroFilterChainDefinition</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">DefaultShiroFilterChainDefinition</span> <span class="variable">chainDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultShiroFilterChainDefinition</span>();</span><br><span class="line">    chainDefinition.addPathDefinition(<span class="string">&quot;/logout&quot;</span>, <span class="string">&quot;logout&quot;</span>);</span><br><span class="line">    chainDefinition.addPathDefinition(<span class="string">&quot;/error&quot;</span>, <span class="string">&quot;anon&quot;</span>);</span><br><span class="line">    chainDefinition.addPathDefinition(<span class="string">&quot;/druid/**&quot;</span>, <span class="string">&quot;authc, roles[admin]&quot;</span>);</span><br><span class="line">    chainDefinition.addPathDefinition(<span class="string">&quot;/static/**&quot;</span>, <span class="string">&quot;anon&quot;</span>);</span><br><span class="line">    chainDefinition.addPathDefinition(<span class="string">&quot;/**&quot;</span>, <span class="string">&quot;authc&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> chainDefinition;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种方式是 <strong>Shiro 官方从 1.4 版本开始推荐的基于 <code>ShiroFilterChainDefinition</code> 的配置方式</strong>，它通过声明一个 <code>ShiroFilterChainDefinition</code> Bean 来替代传统的 <code>ShiroFilterFactoryBean</code> 配置。</p>
<hr>
<h2 id="🧠-为什么可以不用-ShiroFilterFactoryBean？"><a href="#🧠-为什么可以不用-ShiroFilterFactoryBean？" class="headerlink" title="🧠 为什么可以不用 ShiroFilterFactoryBean？"></a>🧠 为什么可以不用 <code>ShiroFilterFactoryBean</code>？</h2><h3 id="1-Shiro-自动配置机制"><a href="#1-Shiro-自动配置机制" class="headerlink" title="1. Shiro 自动配置机制"></a>1. <strong>Shiro 自动配置机制</strong></h3><p>当你使用了 Shiro 的 Spring Boot Starter（如 <code>shiro-spring-boot-web-starter</code>）时，Shiro 已经通过自动配置类（如 <code>ShiroAutoConfiguration</code>）为你配置好了：</p>
<ul>
<li><code>SecurityManager</code></li>
<li><code>ShiroFilter</code></li>
<li>以及 <code>ShiroFilterFactoryBean</code> 的创建逻辑（如果检测到 <code>ShiroFilterChainDefinition</code>）</li>
</ul>
<h3 id="2-ShiroFilterChainDefinition-是更高级别的抽象"><a href="#2-ShiroFilterChainDefinition-是更高级别的抽象" class="headerlink" title="2. ShiroFilterChainDefinition 是更高级别的抽象"></a>2. <strong>ShiroFilterChainDefinition 是更高级别的抽象</strong></h3><p><code>ShiroFilterChainDefinition</code> 是一个接口，用于定义 URL 路径和过滤器链的映射关系，它比 <code>ShiroFilterFactoryBean.setFilterChainDefinitionMap()</code> 更加模块化、易于维护。</p>
<ul>
<li><code>DefaultShiroFilterChainDefinition</code> 是其默认实现。</li>
<li>它的职责是：<strong>定义 URL 到 Filter Chain 的映射关系</strong>。</li>
</ul>
<h3 id="3-自动创建-ShiroFilterFactoryBean"><a href="#3-自动创建-ShiroFilterFactoryBean" class="headerlink" title="3. 自动创建 ShiroFilterFactoryBean"></a>3. <strong>自动创建 <code>ShiroFilterFactoryBean</code></strong></h3><p>在 Spring Boot 的自动配置中，如果检测到你定义了 <code>ShiroFilterChainDefinition</code> Bean，则会自动创建并配置 <code>ShiroFilterFactoryBean</code>，并将你定义的链规则应用上去。</p>
<p>你可以理解为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自动配置伪代码</span></span><br><span class="line"><span class="keyword">if</span> (beanFactory.containsBean(<span class="string">&quot;shiroFilterChainDefinition&quot;</span>)) &#123;</span><br><span class="line">    <span class="type">ShiroFilterFactoryBean</span> <span class="variable">filterFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShiroFilterFactoryBean</span>();</span><br><span class="line">    filterFactoryBean.setSecurityManager(securityManager);</span><br><span class="line">    filterFactoryBean.setFilterChainDefinitionMap(</span><br><span class="line">        shiroFilterChainDefinition.getFilterChainMap()</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 注册为 Bean</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="✅-什么时候需要手动配置-ShiroFilterFactoryBean？"><a href="#✅-什么时候需要手动配置-ShiroFilterFactoryBean？" class="headerlink" title="✅ 什么时候需要手动配置 ShiroFilterFactoryBean？"></a>✅ 什么时候需要手动配置 <code>ShiroFilterFactoryBean</code>？</h2><p>虽然 <code>ShiroFilterChainDefinition</code> 简化了配置，但在以下场景中你仍然需要手动配置 <code>ShiroFilterFactoryBean</code>：</p>
<table>
<thead>
<tr>
<th>场景</th>
<th>是否需要手动配置</th>
</tr>
</thead>
<tbody><tr>
<td>只需配置过滤器链（如 anon、authc、roles）</td>
<td>❌ 不需要</td>
</tr>
<tr>
<td>需要自定义过滤器（如 JWT、验证码等）</td>
<td>✅ 需要</td>
</tr>
<tr>
<td>需要设置登录页、成功页、未授权页</td>
<td>✅ 需要</td>
</tr>
<tr>
<td>需要设置全局 Cookie、Session 配置</td>
<td>✅ 需要</td>
</tr>
<tr>
<td>需要自定义 FilterChainResolver</td>
<td>✅ 需要</td>
</tr>
</tbody></table>
<hr>
<h2 id="🔁-总结对比"><a href="#🔁-总结对比" class="headerlink" title="🔁 总结对比"></a>🔁 总结对比</h2><table>
<thead>
<tr>
<th>方式</th>
<th>是否推荐</th>
<th>适用场景</th>
<th>是否需要 <code>ShiroFilterFactoryBean</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>ShiroFilterChainDefinition</code></td>
<td>✅ 推荐</td>
<td>简单过滤器链配置</td>
<td>❌ 不需要</td>
</tr>
<tr>
<td><code>ShiroFilterFactoryBean</code></td>
<td>✅ 必要时</td>
<td>高级定制（自定义过滤器、跳转页等）</td>
<td>✅ 需要</td>
</tr>
</tbody></table>
<hr>
<h2 id="✅-最佳实践建议"><a href="#✅-最佳实践建议" class="headerlink" title="✅ 最佳实践建议"></a>✅ 最佳实践建议</h2><ul>
<li>如果你只是配置基本的权限控制（如 <code>/admin/** = roles[admin]</code>），使用 <code>ShiroFilterChainDefinition</code> 就足够了。</li>
<li>如果你需要添加自定义过滤器、设置登录页面、登出处理等高级功能，可以在配置 <code>ShiroFilterChainDefinition</code> 的基础上，再手动配置 <code>ShiroFilterFactoryBean</code>。</li>
</ul>
<hr>
<h2 id="📌-示例：两者结合使用"><a href="#📌-示例：两者结合使用" class="headerlink" title="📌 示例：两者结合使用"></a>📌 示例：两者结合使用</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ShiroFilterChainDefinition <span class="title function_">shiroFilterChainDefinition</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">DefaultShiroFilterChainDefinition</span> <span class="variable">chain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultShiroFilterChainDefinition</span>();</span><br><span class="line">    chain.addPathDefinition(<span class="string">&quot;/logout&quot;</span>, <span class="string">&quot;logout&quot;</span>);</span><br><span class="line">    chain.addPathDefinition(<span class="string">&quot;/public/**&quot;</span>, <span class="string">&quot;anon&quot;</span>);</span><br><span class="line">    chain.addPathDefinition(<span class="string">&quot;/admin/**&quot;</span>, <span class="string">&quot;roles[admin]&quot;</span>);</span><br><span class="line">    chain.addPathDefinition(<span class="string">&quot;/**&quot;</span>, <span class="string">&quot;authc&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> chain;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title function_">shiroFilterFactoryBean</span><span class="params">(SecurityManager securityManager,</span></span><br><span class="line"><span class="params">                                                    ShiroFilterChainDefinition chainDefinition)</span> &#123;</span><br><span class="line">    <span class="type">ShiroFilterFactoryBean</span> <span class="variable">filterFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShiroFilterFactoryBean</span>();</span><br><span class="line">    filterFactoryBean.setSecurityManager(securityManager);</span><br><span class="line">    filterFactoryBean.setFilterChainDefinitionMap(chainDefinition.getFilterChainMap());</span><br><span class="line">    filterFactoryBean.setLoginUrl(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">    filterFactoryBean.setUnauthorizedUrl(<span class="string">&quot;/unauthorized&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> filterFactoryBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样可以同时利用自动配置和手动配置的优势，实现更灵活的安全策略。</p>
<hr>
<h2 id="自定义过滤器"><a href="#自定义过滤器" class="headerlink" title="自定义过滤器"></a>自定义过滤器</h2><p>在 Apache Shiro 中自定义过滤器可以让你扩展或修改默认的安全行为，以满足特定的应用需求。下面是如何创建和配置自定义过滤器的详细步骤。</p>
<h3 id="1-创建自定义过滤器"><a href="#1-创建自定义过滤器" class="headerlink" title="1. 创建自定义过滤器"></a>1. 创建自定义过滤器</h3><p>首先，你需要创建一个类继承 <code>org.apache.shiro.web.filter.AccessControlFilter</code> 或其他合适的基类（如 <code>PathMatchingFilter</code>）。然后根据需要覆盖相应的方法来实现你的逻辑。</p>
<h4 id="示例：创建一个简单的自定义过滤器"><a href="#示例：创建一个简单的自定义过滤器" class="headerlink" title="示例：创建一个简单的自定义过滤器"></a>示例：创建一个简单的自定义过滤器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.shiro.web.filter.AccessControlFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCustomFilter</span> <span class="keyword">extends</span> <span class="title class_">AccessControlFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isAccessAllowed</span><span class="params">(ServletRequest request, ServletResponse response, Object mappedValue)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 判断是否允许访问资源</span></span><br><span class="line">        <span class="comment">// 返回 true 表示允许访问，false 表示拒绝访问</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 这里只是示例，实际逻辑需要你根据业务需求编写</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">onAccessDenied</span><span class="params">(ServletRequest request, ServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 当访问被拒绝时的操作</span></span><br><span class="line">        <span class="comment">// 可以在这里执行重定向、返回错误信息等操作</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 返回 false 表示继续处理下一个过滤器；返回 true 表示已经处理完毕，不再继续</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>isAccessAllowed()</code></strong> 方法用于判断当前请求是否有权限访问指定的资源。</li>
<li><strong><code>onAccessDenied()</code></strong> 方法则是在 <code>isAccessAllowed()</code> 返回 <code>false</code> 时调用，你可以在此方法中处理访问被拒绝的情况，例如重定向到登录页面或者返回错误信息。</li>
</ul>
<h3 id="2-注册自定义过滤器"><a href="#2-注册自定义过滤器" class="headerlink" title="2. 注册自定义过滤器"></a>2. 注册自定义过滤器</h3><p>接下来，在 Spring Boot 配置类中注册这个自定义过滤器，并将其添加到过滤器链中。</p>
<h4 id="示例：将自定义过滤器注册为-Bean-并添加到过滤器链"><a href="#示例：将自定义过滤器注册为-Bean-并添加到过滤器链" class="headerlink" title="示例：将自定义过滤器注册为 Bean 并添加到过滤器链"></a>示例：将自定义过滤器注册为 Bean 并添加到过滤器链</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.web.ShiroFilterFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.filter.mgt.DefaultFilterChainManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ShiroFilterChainDefinition <span class="title function_">shiroFilterChainDefinition</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DefaultShiroFilterChainDefinition</span> <span class="variable">chainDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultShiroFilterChainDefinition</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加自定义过滤器到路径 /custom/**</span></span><br><span class="line">        chainDefinition.addPathDefinition(<span class="string">&quot;/custom/**&quot;</span>, <span class="string">&quot;myCustom&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> chainDefinition;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;shiroFilter&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ShiroFilterFactoryBean <span class="title function_">shiroFilterFactoryBean</span><span class="params">(SecurityManager securityManager,</span></span><br><span class="line"><span class="params">                                                          ShiroFilterChainDefinition chainDefinition)</span> &#123;</span><br><span class="line">        <span class="type">ShiroFilterFactoryBean</span> <span class="variable">shiroFilterFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShiroFilterFactoryBean</span>();</span><br><span class="line">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 注册自定义过滤器</span></span><br><span class="line">        Map&lt;String, String&gt; filterChainMap = chainDefinition.getFilterChainMap();</span><br><span class="line">        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainMap);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将自定义过滤器添加到 ShiroFilterFactoryBean 中</span></span><br><span class="line">        shiroFilterFactoryBean.getFilters().put(<span class="string">&quot;myCustom&quot;</span>, <span class="keyword">new</span> <span class="title class_">MyCustomFilter</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> shiroFilterFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里我们通过 <code>getFilters().put()</code> 方法将自定义过滤器添加到了 <code>ShiroFilterFactoryBean</code> 的过滤器集合中，并在过滤器链定义中使用 <code>&quot;myCustom&quot;</code> 来引用这个过滤器。</p>
<h3 id="3-使用过滤器链"><a href="#3-使用过滤器链" class="headerlink" title="3. 使用过滤器链"></a>3. 使用过滤器链</h3><p>现在，任何对 <code>/custom/**</code> 路径下的请求都会经过 <code>MyCustomFilter</code> 处理。你可以根据业务需求调整 <code>isAccessAllowed()</code> 和 <code>onAccessDenied()</code> 方法中的逻辑。</p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li><strong>顺序</strong>：如果你有多个过滤器作用于同一个 URL 模式，请注意它们的执行顺序。通常，更具体的规则应该放在前面。</li>
<li><strong>异常处理</strong>：确保在自定义过滤器中正确处理异常情况，避免因为未捕获的异常导致请求流程中断。</li>
<li><strong>性能考虑</strong>：对于高并发场景，尽量保持过滤器逻辑简单高效，减少不必要的计算或数据库查询。</li>
</ul>
<h2 id="Shiro中的缓存机制"><a href="#Shiro中的缓存机制" class="headerlink" title="Shiro中的缓存机制"></a>Shiro中的缓存机制</h2><p>在使用 Apache Shiro 的 Spring Boot Starter (<code>shiro-spring-boot-web-starter</code> 或类似的) 时，设置 <code>CacheManager</code> 可以通过 Java 配置类或利用 Spring Boot 的自动配置功能来完成。虽然 Shiro 和 Spring Boot 提供了灵活的配置选项，但默认情况下，并没有直接提供针对缓存的配置文件（如 <code>application.properties</code> 或 <code>application.yml</code>）。不过，你可以通过编写配置类或者扩展 Spring Boot 自动配置来集成和配置 <code>CacheManager</code>。</p>
<h3 id="使用-Java-配置"><a href="#使用-Java-配置" class="headerlink" title="使用 Java 配置"></a>使用 Java 配置</h3><p>通常情况下，你将需要创建一个配置类来定义 <code>CacheManager</code> 并将其注入到 Shiro 的 <code>SecurityManager</code> 中。下面是一个如何为 Shiro 配置 Redis 缓存的例子：</p>
<h4 id="1-添加依赖"><a href="#1-添加依赖" class="headerlink" title="1. 添加依赖"></a>1. 添加依赖</h4><p>首先，确保你的项目中包含了必要的依赖项，例如 Shiro 和 Redis 支持库。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring-boot-web-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- 确保选择与Shiro版本兼容的版本 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-配置-CacheManager"><a href="#2-配置-CacheManager" class="headerlink" title="2. 配置 CacheManager"></a>2. 配置 CacheManager</h4><p>接下来，你需要创建一个配置类来设置 <code>CacheManager</code>。这里我们以 Redis 为例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.shiro.cache.CacheManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.cache.ehcache.EhCacheManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.Realm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.web.ShiroFilterFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.SecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.mgt.DefaultWebSecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.crazycake.shiro.RedisCacheManager;</span><br><span class="line"><span class="keyword">import</span> org.crazycake.shiro.RedisManager;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisManager <span class="title function_">redisManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">RedisManager</span> <span class="variable">redisManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisManager</span>();</span><br><span class="line">        <span class="comment">// 设置Redis连接信息</span></span><br><span class="line">        redisManager.setHost(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        redisManager.setPort(<span class="number">6379</span>);</span><br><span class="line">        <span class="comment">// 如果有密码</span></span><br><span class="line">        <span class="comment">// redisManager.setPassword(&quot;yourpassword&quot;);</span></span><br><span class="line">        <span class="keyword">return</span> redisManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">(RedisManager redisManager)</span> &#123;</span><br><span class="line">        <span class="type">RedisCacheManager</span> <span class="variable">cacheManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisCacheManager</span>();</span><br><span class="line">        cacheManager.setRedisManager(redisManager);</span><br><span class="line">        <span class="keyword">return</span> cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Realm <span class="title function_">myRealm</span><span class="params">(CacheManager cacheManager)</span> &#123;</span><br><span class="line">        <span class="type">MyCustomRealm</span> <span class="variable">realm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyCustomRealm</span>();</span><br><span class="line">        realm.setCacheManager(cacheManager);</span><br><span class="line">        realm.setCachingEnabled(<span class="literal">true</span>);</span><br><span class="line">        realm.setAuthenticationCachingEnabled(<span class="literal">true</span>);</span><br><span class="line">        realm.setAuthorizationCachingEnabled(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> realm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityManager <span class="title function_">securityManager</span><span class="params">(Realm realm, CacheManager cacheManager)</span> &#123;</span><br><span class="line">        <span class="type">DefaultWebSecurityManager</span> <span class="variable">securityManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultWebSecurityManager</span>();</span><br><span class="line">        securityManager.setRealm(realm);</span><br><span class="line">        securityManager.setCacheManager(cacheManager);</span><br><span class="line">        <span class="keyword">return</span> securityManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;shiroFilter&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ShiroFilterFactoryBean <span class="title function_">shiroFilterFactoryBean</span><span class="params">(SecurityManager securityManager)</span> &#123;</span><br><span class="line">        <span class="type">ShiroFilterFactoryBean</span> <span class="variable">shiroFilterFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShiroFilterFactoryBean</span>();</span><br><span class="line">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class="line">        <span class="comment">// 其他过滤器链等配置...</span></span><br><span class="line">        <span class="keyword">return</span> shiroFilterFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="注意事项-1"><a href="#注意事项-1" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li><strong>缓存过期时间</strong>：根据业务需求调整缓存的有效期，避免因缓存中的数据更新不及时导致的安全问题。</li>
<li><strong>分布式环境下的缓存一致性</strong>：如果你的应用部署在一个分布式环境中，确保所有节点之间的缓存同步。例如，使用 Redis 这样的集中式缓存解决方案可以帮助解决这个问题。</li>
<li><strong>缓存大小限制</strong>：合理设置缓存的最大容量，避免因缓存过大而导致内存溢出或其他性能问题。</li>
</ul>
<h2 id="CacheManager"><a href="#CacheManager" class="headerlink" title="CacheManager"></a>CacheManager</h2><h3 id="CacheManager-概述"><a href="#CacheManager-概述" class="headerlink" title="CacheManager 概述"></a>CacheManager 概述</h3><p>在 Apache Shiro 中，<code>CacheManager</code> 是一个用于管理缓存实例的接口。它为 Shiro 提供了统一的缓存抽象层，使得开发者可以方便地将不同的缓存技术（如 Ehcache、Redis 等）集成到 Shiro 的认证和授权流程中，而无需关心具体的缓存实现细节。通过 <code>CacheManager</code>，Shiro 可以显著提升性能，尤其是在处理大量并发请求时。</p>
<h3 id="CacheManager-架构设置"><a href="#CacheManager-架构设置" class="headerlink" title="CacheManager 架构设置"></a>CacheManager 架构设置</h3><h4 id="核心组件"><a href="#核心组件" class="headerlink" title="核心组件"></a>核心组件</h4><ol>
<li><strong><code>CacheManager</code></strong>：这是 Shiro 缓存体系的核心接口，负责创建和管理 <code>Cache</code> 实例。</li>
<li><strong><code>Cache</code></strong>：表示一个具体的数据缓存，每个 <code>Cache</code> 实例都与特定的命名空间相关联，用于存储特定类型的数据（例如认证信息或授权信息）。</li>
<li><strong><code>SecurityManager</code></strong>：Shiro 的核心安全管理器，通常会配置一个 <code>CacheManager</code> 来优化其性能。</li>
<li><strong><code>Realm</code></strong>：安全领域对象，代表了一个数据源，可以通过配置来使用 <code>CacheManager</code> 提供的缓存功能。</li>
</ol>
<h4 id="配置架构"><a href="#配置架构" class="headerlink" title="配置架构"></a>配置架构</h4><p>通常情况下，你需要执行以下步骤来设置 <code>CacheManager</code>：</p>
<ol>
<li><strong>选择并配置一个合适的 <code>CacheManager</code> 实现</strong>。</li>
<li><strong>将其注入到 <code>SecurityManager</code> 和相关的 <code>Realm</code> 中</strong>。</li>
<li><strong>启用 <code>Realm</code> 的缓存功能</strong>，以便利用缓存加速认证和授权过程。</li>
</ol>
<h3 id="常用实现类"><a href="#常用实现类" class="headerlink" title="常用实现类"></a>常用实现类</h3><p>Shiro 支持多种 <code>CacheManager</code> 实现，以下是几个常见的例子：</p>
<ul>
<li><p><strong><code>EhCacheManager</code></strong>：基于 Ehcache 实现的缓存管理器，适合于需要内存级高速缓存的应用场景。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.shiro.cache.ehcache.EhCacheManager;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> EhCacheManager <span class="title function_">cacheManager</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EhCacheManager</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong><code>RedisCacheManager</code></strong>（来自第三方库 <code>shiro-redis</code>）：如果你正在使用 Redis 作为缓存后端，可以选择此实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.crazycake.shiro.RedisCacheManager;</span><br><span class="line"><span class="keyword">import</span> org.crazycake.shiro.RedisManager;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RedisCacheManager <span class="title function_">cacheManager</span><span class="params">(RedisManager redisManager)</span> &#123;</span><br><span class="line">    <span class="type">RedisCacheManager</span> <span class="variable">cacheManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisCacheManager</span>();</span><br><span class="line">    cacheManager.setRedisManager(redisManager);</span><br><span class="line">    <span class="keyword">return</span> cacheManager;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RedisManager <span class="title function_">redisManager</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">RedisManager</span> <span class="variable">redisManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisManager</span>();</span><br><span class="line">    redisManager.setHost(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">    redisManager.setPort(<span class="number">6379</span>);</span><br><span class="line">    <span class="keyword">return</span> redisManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong><code>MemoryConstrainedCacheManager</code></strong>：这是一种简单的内存缓存管理器，适用于小规模应用或开发测试环境。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.shiro.cache.MemoryConstrainedCacheManager;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MemoryConstrainedCacheManager <span class="title function_">cacheManager</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MemoryConstrainedCacheManager</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="开发中的常用-API"><a href="#开发中的常用-API" class="headerlink" title="开发中的常用 API"></a>开发中的常用 API</h3><h4 id="CacheManager-1"><a href="#CacheManager-1" class="headerlink" title="CacheManager"></a><code>CacheManager</code></h4><ul>
<li><p><strong><code>getCache(String name)</code></strong>：获取指定名称的缓存实例。如果该名称的缓存不存在，则可能会自动创建一个新的缓存实例（取决于具体实现）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cache&lt;Object, Object&gt; authenticationCache = cacheManager.getCache(<span class="string">&quot;authenticationCache&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Cache"><a href="#Cache" class="headerlink" title="Cache"></a><code>Cache</code></h4><ul>
<li><p><strong><code>put(Object key, Object value)</code></strong>：将给定的键值对放入缓存中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">authenticationCache.put(user.getId(), user);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong><code>Object get(Object key)</code></strong>：根据给定的键检索缓存中的值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">cachedUser</span> <span class="operator">=</span> (User) authenticationCache.get(user.getId());</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong><code>remove(Object key)</code></strong>：从缓存中移除指定键对应的条目。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">authenticationCache.remove(user.getId());</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong><code>clear()</code></strong>：清空整个缓存。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">authenticationCache.clear();</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="在-Realm-中使用缓存"><a href="#在-Realm-中使用缓存" class="headerlink" title="在 Realm 中使用缓存"></a>在 <code>Realm</code> 中使用缓存</h4><p>为了在 <code>Realm</code> 中启用缓存，你可以这样做：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MyCustomRealm <span class="title function_">myCustomRealm</span><span class="params">(CacheManager cacheManager)</span> &#123;</span><br><span class="line">    <span class="type">MyCustomRealm</span> <span class="variable">realm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyCustomRealm</span>();</span><br><span class="line">    realm.setCachingEnabled(<span class="literal">true</span>); <span class="comment">// 启用缓存</span></span><br><span class="line">    realm.setAuthenticationCachingEnabled(<span class="literal">true</span>); <span class="comment">// 启用认证缓存</span></span><br><span class="line">    realm.setAuthorizationCachingEnabled(<span class="literal">true</span>); <span class="comment">// 启用授权缓存</span></span><br><span class="line">    realm.setCacheManager(cacheManager); <span class="comment">// 设置缓存管理器</span></span><br><span class="line">    <span class="keyword">return</span> realm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="分布式会话"><a href="#分布式会话" class="headerlink" title="分布式会话"></a>分布式会话</h2><p>在分布式环境中，确保会话数据的一致性和可用性是一个关键挑战。对于 Apache Shiro 而言，实现分布式会话管理通常涉及到将 Shiro 的会话存储从默认的内存或本地文件系统迁移到一个分布式的存储解决方案，如 Redis、数据库或其他支持分布式访问的存储系统。以下是如何使用 Redis 来实现 Shiro 分布式会话管理的示例。</p>
<h3 id="使用-Redis-实现-Shiro-分布式会话"><a href="#使用-Redis-实现-Shiro-分布式会话" class="headerlink" title="使用 Redis 实现 Shiro 分布式会话"></a>使用 Redis 实现 Shiro 分布式会话</h3><h4 id="1-添加依赖-1"><a href="#1-添加依赖-1" class="headerlink" title="1. 添加依赖"></a>1. 添加依赖</h4><p>首先，你需要添加必要的 Maven 依赖项，包括 Shiro 和 Shiro-redis 集成库（<code>shiro-redis</code>）。确保选择与你的 Shiro 版本兼容的 <code>shiro-redis</code> 库版本。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring-boot-web-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.crazycake<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- 根据需要选择合适的版本 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>同时，不要忘记添加 Redis 相关的依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-配置-RedisSessionDAO"><a href="#2-配置-RedisSessionDAO" class="headerlink" title="2. 配置 RedisSessionDAO"></a>2. 配置 RedisSessionDAO</h4><p>接下来，在 Spring Boot 配置类中配置 <code>RedisSessionDAO</code>，以便 Shiro 可以将 session 数据存储到 Redis 中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.shiro.session.mgt.eis.SessionDAO;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.web.config.DefaultShiroFilterChainDefinition;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.web.config.ShiroFilterChainDefinition;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.session.mgt.DefaultWebSessionManager;</span><br><span class="line"><span class="keyword">import</span> org.crazycake.shiro.RedisCacheManager;</span><br><span class="line"><span class="keyword">import</span> org.crazycake.shiro.RedisManager;</span><br><span class="line"><span class="keyword">import</span> org.crazycake.shiro.RedisSessionDAO;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisManager <span class="title function_">redisManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">RedisManager</span> <span class="variable">redisManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisManager</span>();</span><br><span class="line">        redisManager.setHost(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        redisManager.setPort(<span class="number">6379</span>);</span><br><span class="line">        <span class="comment">// 如果有密码</span></span><br><span class="line">        <span class="comment">// redisManager.setPassword(&quot;yourpassword&quot;);</span></span><br><span class="line">        <span class="keyword">return</span> redisManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SessionDAO <span class="title function_">sessionDAO</span><span class="params">(RedisManager redisManager)</span> &#123;</span><br><span class="line">        <span class="type">RedisSessionDAO</span> <span class="variable">sessionDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisSessionDAO</span>();</span><br><span class="line">        sessionDAO.setRedisManager(redisManager);</span><br><span class="line">        <span class="keyword">return</span> sessionDAO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DefaultWebSessionManager <span class="title function_">sessionManager</span><span class="params">(SessionDAO sessionDAO)</span> &#123;</span><br><span class="line">        <span class="type">DefaultWebSessionManager</span> <span class="variable">sessionManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultWebSessionManager</span>();</span><br><span class="line">        sessionManager.setSessionDAO(sessionDAO);</span><br><span class="line">        <span class="keyword">return</span> sessionManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的关键是 <code>RedisSessionDAO</code>，它负责与 Redis 进行交互来存储和检索 Shiro 的会话信息。</p>
<h4 id="3-配置-SecurityManager"><a href="#3-配置-SecurityManager" class="headerlink" title="3. 配置 SecurityManager"></a>3. 配置 SecurityManager</h4><p>确保将 <code>sessionManager</code> 注入到 <code>SecurityManager</code> 中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SecurityManager <span class="title function_">securityManager</span><span class="params">(DefaultWebSessionManager sessionManager, Realm realm)</span> &#123;</span><br><span class="line">    <span class="type">DefaultWebSecurityManager</span> <span class="variable">securityManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultWebSecurityManager</span>();</span><br><span class="line">    securityManager.setRealm(realm);</span><br><span class="line">    securityManager.setSessionManager(sessionManager);</span><br><span class="line">    <span class="keyword">return</span> securityManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-配置-Shiro-Filter"><a href="#4-配置-Shiro-Filter" class="headerlink" title="4. 配置 Shiro Filter"></a>4. 配置 Shiro Filter</h4><p>最后，别忘了配置 Shiro 的过滤器链定义，虽然这部分与分布式会话无直接关系，但它对于整个安全框架的运行至关重要。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ShiroFilterChainDefinition <span class="title function_">shiroFilterChainDefinition</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">DefaultShiroFilterChainDefinition</span> <span class="variable">chainDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultShiroFilterChainDefinition</span>();</span><br><span class="line">    <span class="comment">// 定义你的过滤器链规则</span></span><br><span class="line">    <span class="keyword">return</span> chainDefinition;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="注意事项-2"><a href="#注意事项-2" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li><strong>序列化</strong>：由于 Redis 是基于键值对存储的，因此所有存储在 Redis 中的对象都需要能够被序列化。确保你的会话对象实现了 <code>Serializable</code> 接口。</li>
<li><strong>过期时间</strong>：根据业务需求设置适当的会话超时时间，并确保 Redis 中存储的会话数据也遵循这一策略。</li>
<li><strong>安全性</strong>：考虑对存储在 Redis 中的敏感信息进行加密处理，防止未授权访问。</li>
</ul>
<p>Apache Shiro 的 <code>AccessControlFilter</code> 是其安全过滤器体系中的一个核心抽象类，用于控制对资源的访问。它位于 <code>org.apache.shiro.web.filter</code> 包下，是许多具体安全过滤器的基类。</p>
<p>下面我将为你详细列出 <strong><code>AccessControlFilter</code> 的完整继承结构</strong>，并以<strong>文字结构图</strong>的方式呈现（由于无法画图，用缩进表示继承关系），同时对每个类进行简要说明。</p>
<hr>
<h2 id="🧱-Shiro-中-AccessControlFilter-的完整继承结构（从上到下）"><a href="#🧱-Shiro-中-AccessControlFilter-的完整继承结构（从上到下）" class="headerlink" title="🧱 Shiro 中 AccessControlFilter 的完整继承结构（从上到下）"></a>🧱 Shiro 中 <code>AccessControlFilter</code> 的完整继承结构（从上到下）</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">javax.servlet.Filter</span><br><span class="line">└── org.apache.shiro.web.servlet.OncePerRequestFilter</span><br><span class="line">    └── org.apache.shiro.web.servlet.NameableFilter</span><br><span class="line">        └── org.apache.shiro.web.servlet.AdviceFilter</span><br><span class="line">            └── org.apache.shiro.web.filter.PathMatchingFilter</span><br><span class="line">                └── org.apache.shiro.web.filter.AccessControlFilter</span><br><span class="line">                    ├── org.apache.shiro.web.filter.authc.AuthenticatingFilter</span><br><span class="line">                    │   ├── org.apache.shiro.web.filter.authc.BasicHttpAuthenticationFilter</span><br><span class="line">                    │   ├── org.apache.shiro.web.filter.authc.FormAuthenticationFilter</span><br><span class="line">                    │   ├── org.apache.shiro.web.filter.authc.KickoutSessionControlFilter</span><br><span class="line">                    │   └── org.apache.shiro.web.filter.authc.AnonymousFilter</span><br><span class="line">                    │   └── org.apache.shiro.web.filter.authc.UserFilter</span><br><span class="line">                    │</span><br><span class="line">                    ├── org.apache.shiro.web.filter.authz.AuthorizationFilter</span><br><span class="line">                    │   ├── org.apache.shiro.web.filter.authz.RolesAuthorizationFilter</span><br><span class="line">                    │   ├── org.apache.shiro.web.filter.authz.PermissionsAuthorizationFilter</span><br><span class="line">                    │   └── org.apache.shiro.web.filter.authz.PortFilter</span><br><span class="line">                    │</span><br><span class="line">                    ├── org.apache.shiro.web.filter.mgt.ValidatingFilter</span><br><span class="line">                    │   └── org.apache.shiro.web.filter.mgt.JwtFilter</span><br><span class="line">                    │</span><br><span class="line">                    ├── org.apache.shiro.web.filter.session.NoSessionCreationFilter</span><br><span class="line">                    │</span><br><span class="line">                    ├── org.apache.shiro.web.filter.authz.SslFilter</span><br><span class="line">                    │</span><br><span class="line">                    ├── org.apache.shiro.web.filter.authz.LogoutFilter</span><br><span class="line">                    │</span><br><span class="line">                    └── org.apache.shiro.web.filter.authz.UserAgentFilter</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="🧩-各层级类说明"><a href="#🧩-各层级类说明" class="headerlink" title="🧩 各层级类说明"></a>🧩 各层级类说明</h2><h3 id="1-javax-servlet-Filter（Java-EE-标准接口）"><a href="#1-javax-servlet-Filter（Java-EE-标准接口）" class="headerlink" title="1. javax.servlet.Filter（Java EE 标准接口）"></a>1. <code>javax.servlet.Filter</code>（Java EE 标准接口）</h3><ul>
<li>所有过滤器的顶级接口。</li>
<li>定义了 <code>doFilter()</code> 方法（Servlet 2.x）或 <code>doFilterInternal()</code>（Shiro 实现）。</li>
</ul>
<hr>
<h3 id="2-OncePerRequestFilter"><a href="#2-OncePerRequestFilter" class="headerlink" title="2. OncePerRequestFilter"></a>2. <code>OncePerRequestFilter</code></h3><ul>
<li>确保每个请求只被过滤一次。</li>
<li>防止在请求处理过程中被多次调用。</li>
</ul>
<hr>
<h3 id="3-NameableFilter"><a href="#3-NameableFilter" class="headerlink" title="3. NameableFilter"></a>3. <code>NameableFilter</code></h3><ul>
<li>为过滤器提供一个名称（name），用于在配置中引用。</li>
</ul>
<hr>
<h3 id="4-AdviceFilter"><a href="#4-AdviceFilter" class="headerlink" title="4. AdviceFilter"></a>4. <code>AdviceFilter</code></h3><ul>
<li>提供类似 AOP 的拦截能力。</li>
<li>提供了 <code>before()</code>、<code>after()</code>、<code>afterCompletion()</code> 等生命周期方法。</li>
</ul>
<hr>
<h3 id="5-PathMatchingFilter"><a href="#5-PathMatchingFilter" class="headerlink" title="5. PathMatchingFilter"></a>5. <code>PathMatchingFilter</code></h3><ul>
<li>支持基于路径匹配的过滤器。</li>
<li>可以通过配置指定哪些路径需要该过滤器生效。</li>
</ul>
<hr>
<h3 id="6-AccessControlFilter（关键抽象类）"><a href="#6-AccessControlFilter（关键抽象类）" class="headerlink" title="6. AccessControlFilter（关键抽象类）"></a>6. <code>AccessControlFilter</code>（关键抽象类）</h3><ul>
<li>提供了访问控制的基础逻辑。</li>
<li>定义了两个关键方法：<ul>
<li><code>boolean isAccessAllowed(ServletRequest request, ServletResponse response, Object mappedValue)</code>：判断是否允许访问。</li>
<li><code>boolean onAccessDenied(ServletRequest request, ServletResponse response)</code>：当访问被拒绝时执行的逻辑。</li>
</ul>
</li>
</ul>
<hr>
<h2 id="📌-常见子类说明"><a href="#📌-常见子类说明" class="headerlink" title="📌 常见子类说明"></a>📌 常见子类说明</h2><h3 id="✅-AuthenticatingFilter（认证相关）"><a href="#✅-AuthenticatingFilter（认证相关）" class="headerlink" title="✅ AuthenticatingFilter（认证相关）"></a>✅ <code>AuthenticatingFilter</code>（认证相关）</h3><ul>
<li>用于处理认证逻辑的基类。</li>
<li>子类包括：<ul>
<li><code>BasicHttpAuthenticationFilter</code>：HTTP Basic 认证。</li>
<li><code>FormAuthenticationFilter</code>：表单登录。</li>
<li><code>AnonymousFilter</code>：允许匿名访问。</li>
<li><code>UserFilter</code>：已登录用户可访问。</li>
<li><code>KickoutSessionControlFilter</code>：踢出重复登录用户。</li>
</ul>
</li>
</ul>
<h3 id="✅-AuthorizationFilter（授权相关）"><a href="#✅-AuthorizationFilter（授权相关）" class="headerlink" title="✅ AuthorizationFilter（授权相关）"></a>✅ <code>AuthorizationFilter</code>（授权相关）</h3><ul>
<li>用于处理授权逻辑的基类。</li>
<li>子类包括：<ul>
<li><code>RolesAuthorizationFilter</code>：按角色控制访问。</li>
<li><code>PermissionsAuthorizationFilter</code>：按权限控制访问。</li>
<li><code>PortFilter</code>：按端口限制访问。</li>
</ul>
</li>
</ul>
<h3 id="✅-ValidatingFilter（验证相关）"><a href="#✅-ValidatingFilter（验证相关）" class="headerlink" title="✅ ValidatingFilter（验证相关）"></a>✅ <code>ValidatingFilter</code>（验证相关）</h3><ul>
<li>用于验证 Token 或 JWT。</li>
<li>子类如 <code>JwtFilter</code>。</li>
</ul>
<h3 id="✅-NoSessionCreationFilter"><a href="#✅-NoSessionCreationFilter" class="headerlink" title="✅ NoSessionCreationFilter"></a>✅ <code>NoSessionCreationFilter</code></h3><ul>
<li>禁止创建新会话，适用于无状态 API。</li>
</ul>
<h3 id="✅-SslFilter"><a href="#✅-SslFilter" class="headerlink" title="✅ SslFilter"></a>✅ <code>SslFilter</code></h3><ul>
<li>强制使用 HTTPS 访问。</li>
</ul>
<h3 id="✅-LogoutFilter"><a href="#✅-LogoutFilter" class="headerlink" title="✅ LogoutFilter"></a>✅ <code>LogoutFilter</code></h3><ul>
<li>处理登出逻辑。</li>
</ul>
<h3 id="✅-UserAgentFilter"><a href="#✅-UserAgentFilter" class="headerlink" title="✅ UserAgentFilter"></a>✅ <code>UserAgentFilter</code></h3><ul>
<li>根据 User-Agent 进行访问控制。</li>
</ul>
<hr>
<h2 id="🧠-小结"><a href="#🧠-小结" class="headerlink" title="🧠 小结"></a>🧠 小结</h2><ul>
<li><code>AccessControlFilter</code> 是 Shiro 中所有安全过滤器的基类，它提供了访问控制的通用逻辑。</li>
<li>它的子类分为 <strong>认证类（AuthenticatingFilter）</strong> 和 <strong>授权类（AuthorizationFilter）</strong> 两大类。</li>
<li>实际开发中，你可以通过继承 <code>AccessControlFilter</code> 或其子类来自定义过滤器，实现特定的认证&#x2F;授权逻辑。</li>
<li>Shiro 的过滤器体系设计清晰、层次分明，适合扩展和集成。</li>
</ul>
<hr>
<blockquote>
<p><strong>参考资料：</strong></p>
<ul>
<li>Shiro集成Springboot：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000014479154">https://segmentfault.com/a/1190000014479154</a></li>
<li>Shiro配置：<a target="_blank" rel="noopener" href="https://shiro.apache.org/documentation.html">https://shiro.apache.org/documentation.html</a></li>
<li>Shiro集成Springboot：<a target="_blank" rel="noopener" href="https://shiro.apache.org/spring-boot.html">https://shiro.apache.org/spring-boot.html</a></li>
<li>Spring Boot3.0(十八)：整合shiro+jwt：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/663925382">https://zhuanlan.zhihu.com/p/663925382</a></li>
<li>Shiro整合JWT实现认证和权限鉴定：<a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/1296302">https://developer.aliyun.com/article/1296302</a>   </li>
<li>Shiro实现Oauth2.0：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1815267">https://cloud.tencent.com/developer/article/1815267</a>   </li>
<li>基于SpringBoot+Shiro+JWT实现的SSO单点登录系统：<a target="_blank" rel="noopener" href="https://juejin.cn/post/">https://juejin.cn/post/</a></li>
<li>springboot + shiro + cas 实现 登录 + 授权 + sso单点登录 :<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_33101675/article/details/105577898">https://blog.csdn.net/qq_33101675/article/details/105577898</a></li>
</ul>
</blockquote>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.picgo.net/2025/06/23/tom09183405464859c2.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.picgo.net/2025/06/23/tom09183405464859c2.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">Joie</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/07/24/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C_Shiro/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/07/24/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C_Shiro/')">权限校验_Shiro</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/07/24/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C_Shiro/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=权限校验_Shiro&amp;url=http://example.com/2025/07/24/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C_Shiro/&amp;pic=https://img.picgo.net/2025/07/28/551994ea3dcf7d3b61c743.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>权限校验<span class="tagsPageCount">3</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://origin.picgo.net/2025/08/10/mongo767c67668fc74417.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/07/23/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1_XXL-JOB/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.picgo.net/2025/07/23/screenshot-20250723-16444655694926d0080920.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">定时任务_XXL-JOB</div></div></a></div><div class="next-post pull-right"><a href="/2025/07/25/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C_CST/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.picgo.net/2025/08/01/Frame-28-1024x838ca25f53ef910b53f.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">权限校验_CST</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2025/07/25/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C_CST/" title="权限校验_CST"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.picgo.net/2025/08/01/Frame-28-1024x838ca25f53ef910b53f.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-25</div><div class="title">权限校验_CST</div></div></a></div><div><a href="/2025/07/29/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C_SpringSecurity/" title="权限校验_SpringSecurity"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.picgo.net/2025/08/01/k5c6isf4ci6ippivd60vb0ab2f6eec10f7b3.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-29</div><div class="title">权限校验_SpringSecurity</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.picgo.net/2025/06/23/tom09183405464859c2.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Joie</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/BenedictTom" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/372204786" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SecurityManager"><span class="toc-number">1.</span> <span class="toc-text">SecurityManager</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SecurityManager-%E7%BB%A7%E6%89%BF%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.</span> <span class="toc-text">SecurityManager 继承结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%AE%9E%E7%8E%B0%E7%B1%BB%E5%8F%8A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.2.</span> <span class="toc-text">常用实现类及应用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SessionManager"><span class="toc-number">2.</span> <span class="toc-text">SessionManager</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SessionManager-%E7%BB%A7%E6%89%BF%E7%BB%93%E6%9E%84%E5%8F%8A%E5%B8%B8%E7%94%A8%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.1.</span> <span class="toc-text">SessionManager 继承结构及常用实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SessionManager-%E7%BB%A7%E6%89%BF%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.1.</span> <span class="toc-text">SessionManager 继承结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%AE%9E%E7%8E%B0%E7%B1%BB%E5%8F%8A%E5%9C%BA%E6%99%AF"><span class="toc-number">2.1.2.</span> <span class="toc-text">常用实现类及场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8-API"><span class="toc-number">2.1.3.</span> <span class="toc-text">常用 API</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SimpleCookie"><span class="toc-number">3.</span> <span class="toc-text">SimpleCookie</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SimpleCookie-%E7%9A%84%E4%B8%BB%E8%A6%81%E4%BD%9C%E7%94%A8"><span class="toc-number">3.1.</span> <span class="toc-text">SimpleCookie 的主要作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SimpleCookie-%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">3.2.</span> <span class="toc-text">SimpleCookie 常用方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="toc-number">3.3.</span> <span class="toc-text">示例代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AuthenticationInfo"><span class="toc-number">4.</span> <span class="toc-text">AuthenticationInfo</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AuthenticationInfo-%E7%BB%A7%E6%89%BF%E7%BB%93%E6%9E%84"><span class="toc-number">4.1.</span> <span class="toc-text">AuthenticationInfo 继承结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%AE%9E%E7%8E%B0%E7%B1%BB%E5%8F%8A%E5%9C%BA%E6%99%AF-1"><span class="toc-number">4.2.</span> <span class="toc-text">常用实现类及场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8-API-1"><span class="toc-number">4.3.</span> <span class="toc-text">常用 API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E5%BA%94%E7%94%A8"><span class="toc-number">4.4.</span> <span class="toc-text">场景应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CredentialsMatcher"><span class="toc-number">5.</span> <span class="toc-text">CredentialsMatcher</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CredentialsMatcher-%E7%BB%A7%E6%89%BF%E7%BB%93%E6%9E%84%E5%8F%8A%E5%B8%B8%E7%94%A8%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.1.</span> <span class="toc-text">CredentialsMatcher 继承结构及常用实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CredentialsMatcher-%E7%BB%A7%E6%89%BF%E7%BB%93%E6%9E%84"><span class="toc-number">5.1.1.</span> <span class="toc-text">CredentialsMatcher 继承结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%AE%9E%E7%8E%B0%E7%B1%BB%E5%8F%8A%E5%9C%BA%E6%99%AF-2"><span class="toc-number">5.1.2.</span> <span class="toc-text">常用实现类及场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8-API-2"><span class="toc-number">5.1.3.</span> <span class="toc-text">常用 API</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">5.2.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Permission"><span class="toc-number">6.</span> <span class="toc-text">Permission</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Permission-%E6%8E%A5%E5%8F%A3"><span class="toc-number">6.0.1.</span> <span class="toc-text">Permission 接口</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84-Permission-%E5%AE%9E%E7%8E%B0%E7%B1%BB%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">6.1.</span> <span class="toc-text">常用的 Permission 实现类及其应用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8-API-3"><span class="toc-number">6.2.</span> <span class="toc-text">常用 API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-1"><span class="toc-number">6.3.</span> <span class="toc-text">示例代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E5%BA%94%E7%94%A8-1"><span class="toc-number">6.4.</span> <span class="toc-text">场景应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SecurityUtils"><span class="toc-number">7.</span> <span class="toc-text">SecurityUtils</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SecurityUtils-%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="toc-number">7.1.</span> <span class="toc-text">SecurityUtils 的主要功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95%E4%BB%8B%E7%BB%8D"><span class="toc-number">7.2.</span> <span class="toc-text">常用方法介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%EF%BC%88Subject%EF%BC%89"><span class="toc-number">7.2.1.</span> <span class="toc-text">获取当前用户（Subject）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%92%8C%E8%8E%B7%E5%8F%96-SecurityManager"><span class="toc-number">7.2.2.</span> <span class="toc-text">设置和获取 SecurityManager</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">7.2.3.</span> <span class="toc-text">其他常用操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">7.3.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-2"><span class="toc-number">7.4.</span> <span class="toc-text">示例代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ShiroFilterFactoryBean"><span class="toc-number">8.</span> <span class="toc-text">ShiroFilterFactoryBean</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="toc-number">8.1.</span> <span class="toc-text">主要功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%B1%9E%E6%80%A7"><span class="toc-number">8.2.</span> <span class="toc-text">核心属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-3"><span class="toc-number">8.3.</span> <span class="toc-text">示例代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E7%82%B9%E8%A7%A3%E9%87%8A"><span class="toc-number">8.4.</span> <span class="toc-text">关键点解释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-1"><span class="toc-number">8.5.</span> <span class="toc-text">使用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ShiroFilterChainDefinition"><span class="toc-number">9.</span> <span class="toc-text">ShiroFilterChainDefinition</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD-1"><span class="toc-number">9.1.</span> <span class="toc-text">主要功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8-ShiroFilterChainDefinition%EF%BC%9F"><span class="toc-number">9.2.</span> <span class="toc-text">为什么使用 ShiroFilterChainDefinition？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B"><span class="toc-number">9.3.</span> <span class="toc-text">实现示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E7%82%B9%E8%A7%A3%E9%87%8A-1"><span class="toc-number">9.4.</span> <span class="toc-text">关键点解释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">9.5.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%85%E9%A1%BB%E9%85%8D%E7%BD%AEShiroFilterFactoryBean%EF%BC%9F"><span class="toc-number">10.</span> <span class="toc-text">必须配置ShiroFilterFactoryBean？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Shiro-Starter-%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">10.1.</span> <span class="toc-text">使用 Shiro Starter 的情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">10.2.</span> <span class="toc-text">手动配置的情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AE-ShiroFilterFactoryBean"><span class="toc-number">10.3.</span> <span class="toc-text">示例：手动配置 ShiroFilterFactoryBean</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA"><span class="toc-number">10.4.</span> <span class="toc-text">结论</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Shiro-Starter-shiro-spring-boot-web-starter"><span class="toc-number">10.5.</span> <span class="toc-text">使用 Shiro Starter (shiro-spring-boot-web-starter)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="toc-number">10.5.1.</span> <span class="toc-text">步骤：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AE-Shiro-Spring-Boot-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">10.6.</span> <span class="toc-text">手动配置 Shiro + Spring Boot 自动配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%EF%BC%9A-1"><span class="toc-number">10.6.1.</span> <span class="toc-text">步骤：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-number">10.7.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9C%85-%E4%BD%A0%E7%9A%84%E5%81%9A%E6%B3%95%E6%98%AF%E5%AE%8C%E5%85%A8%E6%AD%A3%E7%A1%AE%E7%9A%84"><span class="toc-number">11.</span> <span class="toc-text">✅ 你的做法是完全正确的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A7%A0-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%AF%E4%BB%A5%E4%B8%8D%E7%94%A8-ShiroFilterFactoryBean%EF%BC%9F"><span class="toc-number">12.</span> <span class="toc-text">🧠 为什么可以不用 ShiroFilterFactoryBean？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Shiro-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E6%9C%BA%E5%88%B6"><span class="toc-number">12.1.</span> <span class="toc-text">1. Shiro 自动配置机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-ShiroFilterChainDefinition-%E6%98%AF%E6%9B%B4%E9%AB%98%E7%BA%A7%E5%88%AB%E7%9A%84%E6%8A%BD%E8%B1%A1"><span class="toc-number">12.2.</span> <span class="toc-text">2. ShiroFilterChainDefinition 是更高级别的抽象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA-ShiroFilterFactoryBean"><span class="toc-number">12.3.</span> <span class="toc-text">3. 自动创建 ShiroFilterFactoryBean</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9C%85-%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E9%9C%80%E8%A6%81%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AE-ShiroFilterFactoryBean%EF%BC%9F"><span class="toc-number">13.</span> <span class="toc-text">✅ 什么时候需要手动配置 ShiroFilterFactoryBean？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%81-%E6%80%BB%E7%BB%93%E5%AF%B9%E6%AF%94"><span class="toc-number">14.</span> <span class="toc-text">🔁 总结对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9C%85-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E5%BB%BA%E8%AE%AE"><span class="toc-number">15.</span> <span class="toc-text">✅ 最佳实践建议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8C-%E7%A4%BA%E4%BE%8B%EF%BC%9A%E4%B8%A4%E8%80%85%E7%BB%93%E5%90%88%E4%BD%BF%E7%94%A8"><span class="toc-number">16.</span> <span class="toc-text">📌 示例：两者结合使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">17.</span> <span class="toc-text">自定义过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">17.1.</span> <span class="toc-text">1. 创建自定义过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">17.1.1.</span> <span class="toc-text">示例：创建一个简单的自定义过滤器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%B3%A8%E5%86%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">17.2.</span> <span class="toc-text">2. 注册自定义过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A%E5%B0%86%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8%E6%B3%A8%E5%86%8C%E4%B8%BA-Bean-%E5%B9%B6%E6%B7%BB%E5%8A%A0%E5%88%B0%E8%BF%87%E6%BB%A4%E5%99%A8%E9%93%BE"><span class="toc-number">17.2.1.</span> <span class="toc-text">示例：将自定义过滤器注册为 Bean 并添加到过滤器链</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8%E8%BF%87%E6%BB%A4%E5%99%A8%E9%93%BE"><span class="toc-number">17.3.</span> <span class="toc-text">3. 使用过滤器链</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">17.4.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shiro%E4%B8%AD%E7%9A%84%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6"><span class="toc-number">18.</span> <span class="toc-text">Shiro中的缓存机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Java-%E9%85%8D%E7%BD%AE"><span class="toc-number">18.1.</span> <span class="toc-text">使用 Java 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="toc-number">18.1.1.</span> <span class="toc-text">1. 添加依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AE-CacheManager"><span class="toc-number">18.1.2.</span> <span class="toc-text">2. 配置 CacheManager</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-1"><span class="toc-number">18.2.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CacheManager"><span class="toc-number">19.</span> <span class="toc-text">CacheManager</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CacheManager-%E6%A6%82%E8%BF%B0"><span class="toc-number">19.1.</span> <span class="toc-text">CacheManager 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CacheManager-%E6%9E%B6%E6%9E%84%E8%AE%BE%E7%BD%AE"><span class="toc-number">19.2.</span> <span class="toc-text">CacheManager 架构设置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">19.2.1.</span> <span class="toc-text">核心组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%9E%B6%E6%9E%84"><span class="toc-number">19.2.2.</span> <span class="toc-text">配置架构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-number">19.3.</span> <span class="toc-text">常用实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E5%B8%B8%E7%94%A8-API"><span class="toc-number">19.4.</span> <span class="toc-text">开发中的常用 API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CacheManager-1"><span class="toc-number">19.4.1.</span> <span class="toc-text">CacheManager</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cache"><span class="toc-number">19.4.2.</span> <span class="toc-text">Cache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8-Realm-%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98"><span class="toc-number">19.4.3.</span> <span class="toc-text">在 Realm 中使用缓存</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E4%BC%9A%E8%AF%9D"><span class="toc-number">20.</span> <span class="toc-text">分布式会话</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Redis-%E5%AE%9E%E7%8E%B0-Shiro-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BC%9A%E8%AF%9D"><span class="toc-number">20.1.</span> <span class="toc-text">使用 Redis 实现 Shiro 分布式会话</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96-1"><span class="toc-number">20.1.1.</span> <span class="toc-text">1. 添加依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AE-RedisSessionDAO"><span class="toc-number">20.1.2.</span> <span class="toc-text">2. 配置 RedisSessionDAO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%85%8D%E7%BD%AE-SecurityManager"><span class="toc-number">20.1.3.</span> <span class="toc-text">3. 配置 SecurityManager</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E9%85%8D%E7%BD%AE-Shiro-Filter"><span class="toc-number">20.1.4.</span> <span class="toc-text">4. 配置 Shiro Filter</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-2"><span class="toc-number">20.2.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A7%B1-Shiro-%E4%B8%AD-AccessControlFilter-%E7%9A%84%E5%AE%8C%E6%95%B4%E7%BB%A7%E6%89%BF%E7%BB%93%E6%9E%84%EF%BC%88%E4%BB%8E%E4%B8%8A%E5%88%B0%E4%B8%8B%EF%BC%89"><span class="toc-number">21.</span> <span class="toc-text">🧱 Shiro 中 AccessControlFilter 的完整继承结构（从上到下）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A7%A9-%E5%90%84%E5%B1%82%E7%BA%A7%E7%B1%BB%E8%AF%B4%E6%98%8E"><span class="toc-number">22.</span> <span class="toc-text">🧩 各层级类说明</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-javax-servlet-Filter%EF%BC%88Java-EE-%E6%A0%87%E5%87%86%E6%8E%A5%E5%8F%A3%EF%BC%89"><span class="toc-number">22.1.</span> <span class="toc-text">1. javax.servlet.Filter（Java EE 标准接口）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-OncePerRequestFilter"><span class="toc-number">22.2.</span> <span class="toc-text">2. OncePerRequestFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-NameableFilter"><span class="toc-number">22.3.</span> <span class="toc-text">3. NameableFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-AdviceFilter"><span class="toc-number">22.4.</span> <span class="toc-text">4. AdviceFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-PathMatchingFilter"><span class="toc-number">22.5.</span> <span class="toc-text">5. PathMatchingFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-AccessControlFilter%EF%BC%88%E5%85%B3%E9%94%AE%E6%8A%BD%E8%B1%A1%E7%B1%BB%EF%BC%89"><span class="toc-number">22.6.</span> <span class="toc-text">6. AccessControlFilter（关键抽象类）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8C-%E5%B8%B8%E8%A7%81%E5%AD%90%E7%B1%BB%E8%AF%B4%E6%98%8E"><span class="toc-number">23.</span> <span class="toc-text">📌 常见子类说明</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-AuthenticatingFilter%EF%BC%88%E8%AE%A4%E8%AF%81%E7%9B%B8%E5%85%B3%EF%BC%89"><span class="toc-number">23.1.</span> <span class="toc-text">✅ AuthenticatingFilter（认证相关）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-AuthorizationFilter%EF%BC%88%E6%8E%88%E6%9D%83%E7%9B%B8%E5%85%B3%EF%BC%89"><span class="toc-number">23.2.</span> <span class="toc-text">✅ AuthorizationFilter（授权相关）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-ValidatingFilter%EF%BC%88%E9%AA%8C%E8%AF%81%E7%9B%B8%E5%85%B3%EF%BC%89"><span class="toc-number">23.3.</span> <span class="toc-text">✅ ValidatingFilter（验证相关）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-NoSessionCreationFilter"><span class="toc-number">23.4.</span> <span class="toc-text">✅ NoSessionCreationFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-SslFilter"><span class="toc-number">23.5.</span> <span class="toc-text">✅ SslFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-LogoutFilter"><span class="toc-number">23.6.</span> <span class="toc-text">✅ LogoutFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-UserAgentFilter"><span class="toc-number">23.7.</span> <span class="toc-text">✅ UserAgentFilter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A7%A0-%E5%B0%8F%E7%BB%93"><span class="toc-number">24.</span> <span class="toc-text">🧠 小结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/08/15/Memcached/" title="Memcached"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/08/10/mongo767c67668fc74417.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Memcached"/></a><div class="content"><a class="title" href="/2025/08/15/Memcached/" title="Memcached">Memcached</a><time datetime="2025-08-15T10:02:54.446Z" title="Created 2025-08-15 18:02:54">2025-08-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/15/MQ_%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E5%AF%B9%E6%AF%94/" title="RabbitMQ vs RocketMQ/Kafka 详细对比"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/08/15/kafkaeb19776526399ad4.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RabbitMQ vs RocketMQ/Kafka 详细对比"/></a><div class="content"><a class="title" href="/2025/08/15/MQ_%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E5%AF%B9%E6%AF%94/" title="RabbitMQ vs RocketMQ/Kafka 详细对比">RabbitMQ vs RocketMQ/Kafka 详细对比</a><time datetime="2025-08-15T09:44:28.382Z" title="Created 2025-08-15 17:44:28">2025-08-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/15/MQ_Kafka/" title="Kafka"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/08/15/kafkaeb19776526399ad4.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kafka"/></a><div class="content"><a class="title" href="/2025/08/15/MQ_Kafka/" title="Kafka">Kafka</a><time datetime="2025-08-15T08:44:43.271Z" title="Created 2025-08-15 16:44:43">2025-08-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/14/MQ_RocketMQ/" title="RocketMQ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/08/15/rocketmqb1fb9cf58dd9e568.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RocketMQ"/></a><div class="content"><a class="title" href="/2025/08/14/MQ_RocketMQ/" title="RocketMQ">RocketMQ</a><time datetime="2025-08-14T09:36:30.499Z" title="Created 2025-08-14 17:36:30">2025-08-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/14/Rpc_gRpc/" title="Rpc_gRpc"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://origin.picgo.net/2025/08/14/grpcd2c67c6b0d9161da.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Rpc_gRpc"/></a><div class="content"><a class="title" href="/2025/08/14/Rpc_gRpc/" title="Rpc_gRpc">Rpc_gRpc</a><time datetime="2025-08-14T06:30:57.984Z" title="Created 2025-08-14 14:30:57">2025-08-14</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><div id="runtimeTextTip"></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 By <a class="footer-bar-link" href="/" title="Joie" target="_blank">Joie</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = []
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">Articles</div><div class="length-num">67</div></a><a href="/tags/" title="tag"><div class="headline">Tags</div><div class="length-num">32</div></a><a href="/categories/" title="category"><div class="headline">Categories</div><div class="length-num">24</div></a></div><span class="sidebar-menu-item-title">Function</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="Display Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>Display Mode</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">个人主页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://benedicttom.github.io/home/" title="个人主页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="个人主页"/><span class="back-menu-item-text">个人主页</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AMQP/" style="font-size: 0.88rem;">AMQP<sup>1</sup></a><a href="/tags/CI-CD/" style="font-size: 0.88rem;">CI/CD<sup>1</sup></a><a href="/tags/ElasticSearch/" style="font-size: 0.88rem;">ElasticSearch<sup>3</sup></a><a href="/tags/Hexo/" style="font-size: 0.88rem;">Hexo<sup>1</sup></a><a href="/tags/Http/" style="font-size: 0.88rem;">Http<sup>2</sup></a><a href="/tags/Java/" style="font-size: 0.88rem;">Java<sup>6</sup></a><a href="/tags/MongoDB/" style="font-size: 0.88rem;">MongoDB<sup>1</sup></a><a href="/tags/Mysql/" style="font-size: 0.88rem;">Mysql<sup>2</sup></a><a href="/tags/ORM/" style="font-size: 0.88rem;">ORM<sup>2</sup></a><a href="/tags/Python/" style="font-size: 0.88rem;">Python<sup>3</sup></a><a href="/tags/Redis/" style="font-size: 0.88rem;">Redis<sup>5</sup></a><a href="/tags/Rpc/" style="font-size: 0.88rem;">Rpc<sup>2</sup></a><a href="/tags/Spring-Cloud/" style="font-size: 0.88rem;">Spring Cloud<sup>3</sup></a><a href="/tags/Spring-Data/" style="font-size: 0.88rem;">Spring Data<sup>5</sup></a><a href="/tags/Swagger/" style="font-size: 0.88rem;">Swagger<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 0.88rem;">云原生<sup>1</sup></a><a href="/tags/%E5%85%AB%E8%82%A1/" style="font-size: 0.88rem;">八股<sup>1</sup></a><a href="/tags/%E5%8A%9B%E6%89%A3/" style="font-size: 0.88rem;">力扣<sup>10</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 0.88rem;">多线程<sup>7</sup></a><a href="/tags/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/" style="font-size: 0.88rem;">定时任务<sup>3</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 0.88rem;">并发<sup>7</sup></a><a href="/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" style="font-size: 0.88rem;">开发工具<sup>2</sup></a><a href="/tags/%E6%8E%A8%E8%8D%90/" style="font-size: 0.88rem;">推荐<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 0.88rem;">数据结构<sup>4</sup></a><a href="/tags/%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C/" style="font-size: 0.88rem;">权限校验<sup>3</sup></a><a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 0.88rem;">架构<sup>1</sup></a><a href="/tags/%E6%A0%91/" style="font-size: 0.88rem;">树<sup>1</sup></a><a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 0.88rem;">消息队列<sup>4</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">算法<sup>1</sup></a><a href="/tags/%E7%BC%93%E5%AD%98/" style="font-size: 0.88rem;">缓存<sup>2</sup></a><a href="/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 0.88rem;">运维<sup>2</sup></a><a href="/tags/%E9%9B%86%E5%90%88/" style="font-size: 0.88rem;">集合<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2025 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2025 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Joie 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("04/01/2025 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "";
        img.title = "";
        img.alt = "";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>